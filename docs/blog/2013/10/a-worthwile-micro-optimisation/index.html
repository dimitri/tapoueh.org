

  
    
  


  




  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Hugo 0.101.0">
    <meta name="theme" content="Tranquilpeak 0.3.1-BETA">
    <title>A Worthwile Micro Optimisation</title>
    <meta name="author" content="Dimitri Fontaine">
    <meta name="keywords" content="">

    <link rel="icon" href="/favicon.ico">
    

    
    <meta name="description" content="In our previous article about
Loading Geolocation Data, we did load some
data into PostgreSQL and saw the quite noticable impact of a user
transformation. As it happens, the function that did the integer to IP
representation was so naive as to scratch the micro optimisation itch of
some Common Lisp hackers: thanks a lot guys, in particular
stassats who came
up with the solution we&rsquo;re seeing now.">
    <meta property="og:description" content="In our previous article about
Loading Geolocation Data, we did load some
data into PostgreSQL and saw the quite noticable impact of a user
transformation. As it happens, the function that did the integer to IP
representation was so naive as to scratch the micro optimisation itch of
some Common Lisp hackers: thanks a lot guys, in particular
stassats who came
up with the solution we&rsquo;re seeing now.">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="A Worthwile Micro Optimisation">
    <meta property="og:url" content="https://tapoueh.org/blog/2013/10/a-worthwile-micro-optimisation/">
    <meta property="og:site_name" content="The Art of PostgreSQL">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="A Worthwile Micro Optimisation">
    <meta name="twitter:description" content="In our previous article about
Loading Geolocation Data, we did load some
data into PostgreSQL and saw the quite noticable impact of a user
transformation. As it happens, the function that did the integer to IP
representation was so naive as to scratch the micro optimisation itch of
some Common Lisp hackers: thanks a lot guys, in particular
stassats who came
up with the solution we&rsquo;re seeing now.">
    
      <meta name="twitter:creator" content="@tapoueh">
    
    

    
    

    
      <meta property="og:image" content="//www.gravatar.com/avatar/7b615d104c506aa0a49e17151fa94d9f?s=640">
    

    
      <meta property="og:image" content="https://tapoueh.org/img/old/make-computer-faster.jpg">
    
    
      <meta property="og:image" content="https://tapoueh.org/img/old/make-computer-faster.jpg">
    
    

    

    
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.css" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" />
    
    
    <link rel="stylesheet" href="/css/style-jsjn0006wyhpyzivf6yceb31gvpjatbcs3qzjvlumobfnugccvobqwxnnaj8.min.css" />
    
    
      <link rel="stylesheet" href="https://tapoueh.org/css/dim.css">
    
      <link rel="stylesheet" href="https://tapoueh.org/css/nav.css">
    

    
      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-47059482-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="5">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="navbar-collapse collapse header-title" id="navigation">
    <ul class="nav navbar-nav navbar-right">
      
      <li class="dropdown">
        
        <a style="color: black;" href="/" alt="blog"><i class="sidebar-button-icon fa fa-lg fa-home"></i></a>
        
      </li>
      
      <li class="dropdown">
        
        <a style="color: black;" href="/conf/" alt="talks"><i class="sidebar-button-icon fa fa-lg fa-microphone"></i></a>
        
      </li>
      
      <li class="dropdown">
        
        <a style="color: black;" href="https://twitter.com/tapoueh" alt="Twitter"><i class="sidebar-button-icon fa fa-lg fa-twitter"></i></a>
        
      </li>
      
      <li class="dropdown">
        
        <a style="color: black;" href="http://theartofpostgresql.com" alt="The Art Of PostgreSQL"><i class="sidebar-button-icon fa fa-lg fa-book"></i></a>
        
      </li>
      
    </ul>
  </div>

  
    
      <a class="header-right-icon "
         href="https://theartofpostgresql.com/" target="_blank">
    
    
      <i class="fa fa-lg fa-book"></i>
    
    
    </a>
  
</header>

      <nav id="sidebar" data-behavior="5">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="/#about" aria-label="">
          <img class="sidebar-profile-picture" src="//www.gravatar.com/avatar/7b615d104c506aa0a49e17151fa94d9f?s=110" alt="" />
        </a>
        <h4 class="sidebar-profile-name">Dimitri Fontaine</h4>
        
          <h5 class="sidebar-profile-bio">PostgreSQL Major Contributor</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/" title="Blog">
    
      <i class="sidebar-button-icon fa fa-lg fa-pagelines"></i>
      
      <span class="sidebar-button-desc">Blog</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/about/" title="About">
    
      <i class="sidebar-button-icon fa fa-lg fa-beer"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/categories/yesql/" title="YeSQL">
    
      <i class="sidebar-button-icon fa fa-lg fa-database"></i>
      
      <span class="sidebar-button-desc">YeSQL</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://theartofpostgresql.com" target="_blank" rel="noopener" title="The Art of PostgreSQL">
    
      <i class="sidebar-button-icon fa fa-lg fa-book"></i>
      
      <span class="sidebar-button-desc">The Art of PostgreSQL</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/dimitri" target="_blank" rel="noopener" title="GitHub">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://twitter.com/tapoueh" target="_blank" rel="noopener" title="Twitter">
    
      <i class="sidebar-button-icon fa fa-lg fa-twitter"></i>
      
      <span class="sidebar-button-desc">Twitter</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/categories" title="Categories">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/index.xml" title="RSS">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      
  <div class="post-header-cover
              text-left
              post-header-cover--partial"
       style="background-image:url('/img/old/make-computer-faster.jpg')"
       data-behavior="5">
    
  </div>


      <div id="main" data-behavior="5"
        class="hasCover
               hasCoverMetaOut
               ">
        <article class="post" itemscope itemType="http://schema.org/BlogPosting">
          
          
            <div class="post-header main-content-wrap text-left">
  
    <h1 class="post-title">
      A Worthwile Micro Optimisation
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time itemprop="datePublished" datetime="2013-10-03T22:10:00&#43;02:00">
        <span style="float: left; width: 35%">
          <i class="fa fa-calendar"></i> 
  
  
  
  
    Thursday 03 Oct 2013
  

        </span>
      </time>
    
    <span style="float: right; width: 65%">
      <i class="fa fa-clock-o"></i> 4 mins read
      
    </span>
    <span style="float: left; width: 35%">
      <i class="fa fa-bookmark"></i> 
  
  
    <span></span>
    
      <a class="category-link" href="/categories/projects">Projects</a>, 
    
      <a class="category-link" href="/categories/pgloader">pgloader</a>
    
  

    </span>
    <div>
      <p>
        
        
        
        
        <a href="/tags/pgloader/">
          <i class="fa fa-tag"></i> pgloader
        </a>
        
        
        
        <a href="/tags/ip4r/">
          <i class="fa fa-tag"></i> ip4r
        </a>
        
        
        
        <a href="/tags/extensions/">
          <i class="fa fa-tag"></i> Extensions
        </a>
        
        
        
        <a href="/tags/common-lisp/">
          <i class="fa fa-tag"></i> Common-Lisp
        </a>
        
        
      </p>
    </div>
  </div>


</div>
          
          <div class="post-content markdown" itemprop="articleBody">
            <div class="main-content-wrap">
              <p>In our previous article about
<a href="/blog/2013/10/01-loading-geolocation-data">Loading Geolocation Data</a>, we did load some
data into PostgreSQL and saw the quite noticable impact of a user
transformation. As it happens, the function that did the integer to IP
representation was so naive as to scratch the micro optimisation itch of
some Common Lisp hackers: thanks a lot guys, in particular
<a href="https://github.com/stassats">stassats</a> who came
up with the solution we&rsquo;re seeing now.</p>
<p>The previous code was a straight rewrite of the provided documentation in
Common Lisp. See for yourself the docs as found at
<a href="http://dev.maxmind.com/geoip/legacy/csv/">http://dev.maxmind.com/geoip/legacy/csv/</a>:</p>
<pre tabindex="0"><code>integer_ip = 2921648058

o1 = int ( ipnum / 16777216 ) % 256;
o2 = int ( ipnum / 65536    ) % 256;
o3 = int ( ipnum / 256      ) % 256;
o4 = int ( ipnum            ) % 256;

address = ( o1, o2, o3, o4 ).join(&#39;.&#39;)
</code></pre><p>And the code I came up with:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lisp" data-lang="lisp"><span style="display:flex;"><span>(<span style="color:#0aa">defun</span> <span style="color:#a00">ip-range</span> (<span style="color:#a00">start-integer-string</span> <span style="color:#a00">end-integer-string</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#a50">&#34;Transform a couple of integers to an IP4R ip range notation.&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#00a">declare</span> (<span style="color:#00a">inline</span>)
</span></span><span style="display:flex;"><span>	   (<span style="color:#00a">optimize</span> <span style="color:#a00">speed</span>)
</span></span><span style="display:flex;"><span>	   (<span style="color:#00a">type</span> <span style="color:#0a0;text-decoration:underline">string</span> <span style="color:#a00">start-integer-string</span> <span style="color:#a00">end-integer-string</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#00a">flet</span> ((<span style="color:#a00">integer-to-ip-string</span> (<span style="color:#a00">int</span>)
</span></span><span style="display:flex;"><span>	   <span style="color:#a50">&#34;see http://dev.maxmind.com/geoip/legacy/csv/&#34;</span>
</span></span><span style="display:flex;"><span>	   (<span style="color:#00a">declare</span> (<span style="color:#00a">inline</span>) (<span style="color:#00a">optimize</span> <span style="color:#a00">speed</span>) (<span style="color:#00a">type</span> <span style="color:#0aa">fixnum</span> <span style="color:#a00">int</span>))
</span></span><span style="display:flex;"><span>	   (<span style="color:#0a0">format</span> <span style="color:#a00">nil</span> <span style="color:#a50">&#34;~a.~a.~a.~a&#34;</span>
</span></span><span style="display:flex;"><span>		   (<span style="color:#0a0">mod</span> (<span style="color:#0a0">truncate</span> <span style="color:#a00">int</span> #. (<span style="color:#0a0">expt</span> <span style="color:#099">2</span> <span style="color:#099">24</span>)) <span style="color:#099">256</span>)
</span></span><span style="display:flex;"><span>		   (<span style="color:#0a0">mod</span> (<span style="color:#0a0">truncate</span> <span style="color:#a00">int</span> #. (<span style="color:#0a0">expt</span> <span style="color:#099">2</span> <span style="color:#099">16</span>)) <span style="color:#099">256</span>)
</span></span><span style="display:flex;"><span>		   (<span style="color:#0a0">mod</span> (<span style="color:#0a0">truncate</span> <span style="color:#a00">int</span> #. (<span style="color:#0a0">expt</span> <span style="color:#099">2</span> <span style="color:#099">8</span>)) <span style="color:#099">256</span>)
</span></span><span style="display:flex;"><span>		   (<span style="color:#0a0">mod</span> <span style="color:#a00">int</span> <span style="color:#099">256</span>))))
</span></span><span style="display:flex;"><span>    (<span style="color:#00a">let</span> ((<span style="color:#a00">ip-start</span> (<span style="color:#a00">integer-to-ip-string</span> (<span style="color:#0a0">parse-integer</span> <span style="color:#a00">start-integer-string</span>)))
</span></span><span style="display:flex;"><span>	  (<span style="color:#a00">ip-end</span>   (<span style="color:#a00">integer-to-ip-string</span> (<span style="color:#0a0">parse-integer</span> <span style="color:#a00">end-integer-string</span>))))
</span></span><span style="display:flex;"><span>      (<span style="color:#0a0">format</span> <span style="color:#a00">nil</span> <span style="color:#a50">&#34;~a-~a&#34;</span> <span style="color:#a00">ip-start</span> <span style="color:#a00">ip-end</span>))))
</span></span></code></pre></div><p>Quite a direct naive implementation. Which is good to show what you can
expect in a kind of a worst case, and that worst case was using
<em>31.546
seconds</em> rather than
<em>17.425 seconds</em> when not doing any conversion. Well of
course the python code was spending
<em>78.979 seconds</em> for not doing any
conversion, but that&rsquo;s not the topic today.</p>
<center>


 
  
  
  
  
    
      
    
  
    
  
    
      
    
  

<div class="figure fig50 dim-margin" >
  
    <a class="fancybox" href="/img/old/ip-address.640.png" data-fancybox="">
  
    <img class="fig-img" src="/img/old/ip-address.640.png" >
  
    </a>
  
  
</div>

</center>
<p>Let&rsquo;s now see one of the micro optimised solution, the one I picked among a
list of 8 different proposal, each a little more crazy than the previous
one:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lisp" data-lang="lisp"><span style="display:flex;"><span>(<span style="color:#0aa">declaim</span> (<span style="color:#00a">inline</span> <span style="color:#a00">int-to-ip</span>))
</span></span><span style="display:flex;"><span>(<span style="color:#0aa">defun</span> <span style="color:#a00">int-to-ip</span> (<span style="color:#a00">int</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#a50">&#34;Transform an IP as integer into its dotted notation, optimised code from
</span></span></span><span style="display:flex;"><span><span style="color:#a50">   stassats.&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#00a">declare</span> (<span style="color:#00a">optimize</span> <span style="color:#a00">speed</span>)
</span></span><span style="display:flex;"><span>           (<span style="color:#00a">type</span> (<span style="color:#0aa">unsigned-byte</span> <span style="color:#099">32</span>) <span style="color:#a00">int</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#00a">let</span> ((<span style="color:#a00">table</span> (<span style="color:#00a">load-time-value</span>
</span></span><span style="display:flex;"><span>                (<span style="color:#00a">let</span> ((<span style="color:#a00">vec</span> (<span style="color:#0a0">make-array</span> (<span style="color:#0a0">+</span> <span style="color:#099">1</span> <span style="color:#099">#xFFFF</span>))))
</span></span><span style="display:flex;"><span>                  (<span style="color:#0aa">loop</span> <span style="color:#a00">for</span> <span style="color:#a00">i</span> <span style="color:#a00">to</span> <span style="color:#099">#xFFFF</span>
</span></span><span style="display:flex;"><span>		     <span style="color:#0aa">do</span> (<span style="color:#0aa">setf</span> (<span style="color:#0a0">aref</span> <span style="color:#a00">vec</span> <span style="color:#a00">i</span>)
</span></span><span style="display:flex;"><span>			      (<span style="color:#0a0">coerce</span> (<span style="color:#0a0">format</span> <span style="color:#a00">nil</span> <span style="color:#a50">&#34;~a.~a&#34;</span>
</span></span><span style="display:flex;"><span>					      (<span style="color:#0a0">ldb</span> (<span style="color:#0a0">byte</span> <span style="color:#099">8</span> <span style="color:#099">8</span>) <span style="color:#a00">i</span>)
</span></span><span style="display:flex;"><span>					      (<span style="color:#0a0">ldb</span> (<span style="color:#0a0">byte</span> <span style="color:#099">8</span> <span style="color:#099">0</span>) <span style="color:#a00">i</span>))
</span></span><span style="display:flex;"><span>				      <span style="color:#00a">&#39;simple-base-string</span>)))
</span></span><span style="display:flex;"><span>                  <span style="color:#a00">vec</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#a00">t</span>)))
</span></span><span style="display:flex;"><span>    (<span style="color:#00a">declare</span> (<span style="color:#00a">type</span> (<span style="color:#0aa">simple-array</span> <span style="color:#0aa">simple-base-string</span> (<span style="color:#0a0">*</span>)) <span style="color:#a00">table</span>))
</span></span><span style="display:flex;"><span>    (<span style="color:#0a0">concatenate</span> <span style="color:#00a">&#39;simple-base-string</span>
</span></span><span style="display:flex;"><span>		 (<span style="color:#0a0">aref</span> <span style="color:#a00">table</span> (<span style="color:#0a0">ldb</span> (<span style="color:#0a0">byte</span> <span style="color:#099">16</span> <span style="color:#099">16</span>) <span style="color:#a00">int</span>))
</span></span><span style="display:flex;"><span>		 <span style="color:#a50">&#34;.&#34;</span>
</span></span><span style="display:flex;"><span>		 (<span style="color:#0a0">aref</span> <span style="color:#a00">table</span> (<span style="color:#0a0">ldb</span> (<span style="color:#0a0">byte</span> <span style="color:#099">16</span> <span style="color:#099">0</span>) <span style="color:#a00">int</span>)))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#0aa">declaim</span> (<span style="color:#00a">inline</span> <span style="color:#a00">ip-range</span>))
</span></span><span style="display:flex;"><span>(<span style="color:#0aa">defun</span> <span style="color:#a00">ip-range</span> (<span style="color:#a00">start-integer-string</span> <span style="color:#a00">end-integer-string</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#a50">&#34;Transform a couple of integers to an IP4R ip range notation.&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#00a">declare</span> (<span style="color:#00a">optimize</span> <span style="color:#a00">speed</span>)
</span></span><span style="display:flex;"><span>	   (<span style="color:#00a">type</span> <span style="color:#0a0;text-decoration:underline">string</span> <span style="color:#a00">start-integer-string</span> <span style="color:#a00">end-integer-string</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#00a">let</span> ((<span style="color:#a00">ip-start</span> (<span style="color:#a00">int-to-ip</span> (<span style="color:#0a0">parse-integer</span> <span style="color:#a00">start-integer-string</span>)))
</span></span><span style="display:flex;"><span>	(<span style="color:#a00">ip-end</span>   (<span style="color:#a00">int-to-ip</span> (<span style="color:#0a0">parse-integer</span> <span style="color:#a00">end-integer-string</span>))))
</span></span><span style="display:flex;"><span>    (<span style="color:#0a0">concatenate</span> <span style="color:#00a">&#39;simple-base-string</span> <span style="color:#a00">ip-start</span> <span style="color:#a50">&#34;-&#34;</span> <span style="color:#a00">ip-end</span>)))
</span></span></code></pre></div><p>As usual the idea is to compute all you can in advance, here thanks to the
<a href="http://www.lispworks.com/documentation/HyperSpec/Body/s_ld_tim.htm">load-time-value</a> special operator that&rsquo;s part of the Common Lisp Standard. So
we compute a table of all the dotted representation for a pair of two bytes,
and we do that computation at
<em>load time</em>, which happens when you load the
<em>compiled code artifact</em> you generated from your sources. Then all we have to
do is take the upper and lower bytes, fetch their representation in our
table, and concatenate both with a middle dot.</p>
<p>The reason why we only keep 2 bytes in the table is so that we don&rsquo;t require
about
<em>64 GB</em> of memory to be able to transform ip addresses&hellip;</p>
<center>


 
  
  
  
  
    
      
    
  
    
  
    
      
    
  

<div class="figure fig50 dim-margin" >
  
    <a class="fancybox" href="/img/old/cpu-ram-disk.640.jpg" data-fancybox="">
  
    <img class="fig-img" src="/img/old/cpu-ram-disk.640.jpg" >
  
    </a>
  
  
</div>

</center>
<center>*Even after all those years, either compute again or store in memory.*</center>
<p>And what do we have now?</p>
<pre tabindex="0"><code>                    table name       read   imported     errors       time
------------------------------  ---------  ---------  ---------  ---------
                       extract          0          0          0       1.01
                   before load          0          0          0      0.077
------------------------------  ---------  ---------  ---------  ---------
              geolite.location     438386     438386          0     10.352
                geolite.blocks    1790461    1790461          0     18.045
------------------------------  ---------  ---------  ---------  ---------
                       finally          0          0          0     31.108
------------------------------  ---------  ---------  ---------  ---------
             Total import time    2228847    2228847          0   1m0.592s
</code></pre><p>Thanks to the optimisation, the
<em>two bigint as text to iprange as text</em>
transformation now has an added cost of
<code>620 ms</code> with our data set. The whole
file loading is now averaging to
<code>10.07841 µs</code> per row, or just a tad more
than
<em><strong>10 microseconds</strong></em> per row, transformation included this time.</p>
<p>Less than a second of added cost within a complete process taking around a
minute, that basically means that the transformation is now free.</p>
<p>Despite what you might have read elsewhere, my experience with the Common
Lisp Community so far really is great!</p>
              


            </div>
          </div>
          





<div style="margin-top: 1em;">
 <script async src="//tinder.thrivecart.com/embed/v1/thrivecart.js"></script>
 <a data-thrivecart-account="theartofpostgresql" data-thrivecart-tpl="v2" data-thrivecart-product="18" class="thrivecart-button ">
  <img src="https://spark.thrivecart.com/0x0/https%3A%2F%2Fthrivecart.s3.amazonaws.com%2Fuser_assets%2FNABJ5K7H%2Fproducts%2F18%2Ftaopg-cta-1661268188.jpg"
       style="width:90%; height: auto; margin-left: 5%"/>
 </a>
</div>

          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small"></span><br/>
                    
  <a class="tag tag--primary tag--small" href="/tags/postgresql/">PostgreSQL</a>

  <a class="tag tag--primary tag--small" href="/tags/pgloader/">pgloader</a>

  <a class="tag tag--primary tag--small" href="/tags/ip4r/">ip4r</a>

  <a class="tag tag--primary tag--small" href="/tags/extensions/">Extensions</a>

  <a class="tag tag--primary tag--small" href="/tags/common-lisp/">Common-Lisp</a>

                  </div>
                
              
            
            <div class="post-actions-wrap">
 <nav>
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="/blog/2013/10/open-world-forum-conference/" data-tooltip="Open World Forum Conference">
          
            <i class="fa fa-angle-left"></i>
            <span class="hide-xs hide-sm text-small icon-ml"></span>
          </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="/blog/2013/10/loading-geolocation-data/" data-tooltip="Loading Geolocation Data">
          
            <span class="hide-xs hide-sm text-small icon-mr"></span>
            <i class="fa fa-angle-right"></i>
          </a>
        </li>
      
    </ul>
  </nav>
  <ul class="post-actions post-action-share">
    
      <li class="post-action hide-lg hide-md hide-sm">
        <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
          <i class="fa fa-share-alt"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https%3a%2f%2ftapoueh.org%2fblog%2f2013%2f10%2fa-worthwile-micro-optimisation%2f">
          <i class="fa fa-google-plus"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ftapoueh.org%2fblog%2f2013%2f10%2fa-worthwile-micro-optimisation%2f">
          <i class="fa fa-facebook-official"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=A%20Worthwile%20Micro%20Optimisation with @tapoueh: https%3a%2f%2ftapoueh.org%2fblog%2f2013%2f10%2fa-worthwile-micro-optimisation%2f">
          <i class="fa fa-twitter"></i>
        </a>
      </li>
    
    
      <li class="post-action">
        <a class="post-action-btn btn btn--default" href="#disqus_thread">
          <i class="fa fa-comment-o"></i>
        </a>
      </li>
    
    <li class="post-action">
      
        <a class="post-action-btn btn btn--default" href="#">
      
        <i class="fa fa-list"></i>
      </a>
    </li>
  </ul>
</div>


            
              
                <div id="disqus_thread">
  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2022 Dimitri Fontaine. 
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
        <div class="post-actions-wrap">
 <nav>
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="/blog/2013/10/open-world-forum-conference/" data-tooltip="Open World Forum Conference">
          
            <i class="fa fa-angle-left"></i>
            <span class="hide-xs hide-sm text-small icon-ml"></span>
          </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="/blog/2013/10/loading-geolocation-data/" data-tooltip="Loading Geolocation Data">
          
            <span class="hide-xs hide-sm text-small icon-mr"></span>
            <i class="fa fa-angle-right"></i>
          </a>
        </li>
      
    </ul>
  </nav>
  <ul class="post-actions post-action-share">
    
      <li class="post-action hide-lg hide-md hide-sm">
        <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
          <i class="fa fa-share-alt"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https%3a%2f%2ftapoueh.org%2fblog%2f2013%2f10%2fa-worthwile-micro-optimisation%2f">
          <i class="fa fa-google-plus"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ftapoueh.org%2fblog%2f2013%2f10%2fa-worthwile-micro-optimisation%2f">
          <i class="fa fa-facebook-official"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=A%20Worthwile%20Micro%20Optimisation with @tapoueh: https%3a%2f%2ftapoueh.org%2fblog%2f2013%2f10%2fa-worthwile-micro-optimisation%2f">
          <i class="fa fa-twitter"></i>
        </a>
      </li>
    
    
      <li class="post-action">
        <a class="post-action-btn btn btn--default" href="#disqus_thread">
          <i class="fa fa-comment-o"></i>
        </a>
      </li>
    
    <li class="post-action">
      
        <a class="post-action-btn btn btn--default" href="#">
      
        <i class="fa fa-list"></i>
      </a>
    </li>
  </ul>
</div>


      </div>
      <div id="share-options-bar" class="share-options-bar" data-behavior="5">
  <ul class="share-options">
    <li class="share-option">
      <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=https%3a%2f%2ftapoueh.org%2fblog%2f2013%2f10%2fa-worthwile-micro-optimisation%2f">
        <i class="fa fa-google-plus"></i><span></span>
      </a>
    </li>
    <li class="share-option">
      <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ftapoueh.org%2fblog%2f2013%2f10%2fa-worthwile-micro-optimisation%2f">
        <i class="fa fa-facebook-official"></i><span></span>
      </a>
    </li>
    <li class="share-option">
      <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=A%20Worthwile%20Micro%20Optimisation with @tapoueh: https%3a%2f%2ftapoueh.org%2fblog%2f2013%2f10%2fa-worthwile-micro-optimisation%2f">
        <i class="fa fa-twitter"></i><span></span>
      </a>
    </li>
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>

    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-times"></i>
    </div>
    
      <img id="about-card-picture" src="//www.gravatar.com/avatar/7b615d104c506aa0a49e17151fa94d9f?s=110" alt="" />
    
    <h4 id="about-card-name">Dimitri Fontaine</h4>
    
      <div id="about-card-bio">PostgreSQL Major Contributor</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Open Source Software Engineer
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker-alt"></i>
        <br/>
        France
      </div>
    
  </div>
</div>

    

    
  
    
      
      <div id="cover" style="background-image:url('https://tapoueh.org/images/mayan-calendar.jpg');"></div>
    
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/highlight.min.js" integrity="sha512-z+/WWfyD5tccCukM4VvONpEtLmbAm5LDu7eKiyMQJ9m7OfPEDL7gENyDRL3Yfe8XAuGsS2fS4xSMnl6d30kqGQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha512-uURl+ZXMBrF4AwGaWmEetzrd+J5/8NRkWAvJx5sbPSSuOb0bZLqf+tOzniObO00BjHa/dD7gub9oCGMLPQHtQA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


<script src="https://tapoueh.org/js/script-yqzy9wdlzix4lbbwdnzvwx3egsne77earqmn73v9uno8aupuph8wfguccut.min.js"></script>



<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight > code, pre > code').each(function(i, block) {
    if (!$(this).hasClass('codeblock')) {
      $(this).addClass('codeblock');
    }
    hljs.highlightBlock(block);
  });
});
</script>




    
  </body>
</html>

