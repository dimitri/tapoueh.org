

  
    
  


  




  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Hugo 0.46">
    <meta name="theme" content="Tranquilpeak 0.3.1-BETA">
    <title>from MySQL to PostgreSQL</title>
    <meta name="author" content="Dimitri Fontaine">
    <meta name="keywords" content="">

    <link rel="icon" href="/favicon.ico">
    

    
    <meta name="description" content="Today
pgloader v3.4.1
is released and available! This new release comes with 110 commits as show
in
github compare view.

This release of pgloader is following the tradition of
simplifying things for users, or if you allow me to
quote Alan Kay, I believe that if
simple things should be simple, complex things should be possible.

">
    <meta property="og:description" content="Today
pgloader v3.4.1
is released and available! This new release comes with 110 commits as show
in
github compare view.

This release of pgloader is following the tradition of
simplifying things for users, or if you allow me to
quote Alan Kay, I believe that if
simple things should be simple, complex things should be possible.

">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="from MySQL to PostgreSQL">
    <meta property="og:url" content="/blog/2017/07/from-mysql-to-postgresql/">
    <meta property="og:site_name" content="The Art of PostgreSQL">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="from MySQL to PostgreSQL">
    <meta name="twitter:description" content="Today
pgloader v3.4.1
is released and available! This new release comes with 110 commits as show
in
github compare view.

This release of pgloader is following the tradition of
simplifying things for users, or if you allow me to
quote Alan Kay, I believe that if
simple things should be simple, complex things should be possible.

">
    
      <meta name="twitter:creator" content="@tapoueh">
    
    

    
    

    
      <meta property="og:image" content="//www.gravatar.com/avatar/7b615d104c506aa0a49e17151fa94d9f?s=640">
    

    
      <meta property="og:image" content="https://tapoueh.org/img/postgresql-elephant.png">
    
    
      <meta property="og:image" content="https://tapoueh.org/img/old/type-casting-machine.640.jpg">
    
    

    

    
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.css" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" />
    
    
    <link rel="stylesheet" href="/css/style-jsjn0006wyhpyzivf6yceb31gvpjatbcs3qzjvlumobfnugccvobqwxnnaj8.min.css" />
    
    
      <link rel="stylesheet" href="https://tapoueh.org/css/dim.css">
    
      <link rel="stylesheet" href="https://tapoueh.org/css/nav.css">
    

    
      
<script>
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-47059482-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="5">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="navbar-collapse collapse header-title" id="navigation">
    <ul class="nav navbar-nav navbar-right">
      
      <li class="dropdown">
        
        <a style="color: black;" href="/" alt="blog"><i class="sidebar-button-icon fa fa-lg fa-home"></i></a>
        
      </li>
      
      <li class="dropdown">
        
        <a style="color: black;" href="/conf/" alt="talks"><i class="sidebar-button-icon fa fa-lg fa-microphone"></i></a>
        
      </li>
      
      <li class="dropdown">
        
        <a style="color: black;" href="https://twitter.com/tapoueh" alt="Twitter"><i class="sidebar-button-icon fa fa-lg fa-twitter"></i></a>
        
      </li>
      
      <li class="dropdown">
        
        <a style="color: black;" href="http://masteringpostgresql.com/" alt="Mastering PostgreSQL"><i class="sidebar-button-icon fa fa-lg fa-book"></i></a>
        
      </li>
      
    </ul>
  </div>

  
    
      <a class="header-right-icon "
         href="http://masteringpostgresql.com" target="_blank">
    
    
      <i class="fa fa-lg fa-book"></i>
    
    
    </a>
  
</header>

      <nav id="sidebar" data-behavior="5">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="/#about">
          <img class="sidebar-profile-picture" src="//www.gravatar.com/avatar/7b615d104c506aa0a49e17151fa94d9f?s=110" alt="" />
        </a>
        <h4 class="sidebar-profile-name">Dimitri Fontaine</h4>
        
          <h5 class="sidebar-profile-bio">PostgreSQL Major Contributor</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/">
    
      <i class="sidebar-button-icon fa fa-lg fa-pagelines"></i>
      
      <span class="sidebar-button-desc">Blog</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/about/">
    
      <i class="sidebar-button-icon fa fa-lg fa-beer"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/categories/yesql/">
    
      <i class="sidebar-button-icon fa fa-lg fa-database"></i>
      
      <span class="sidebar-button-desc">YeSQL</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="http://masteringpostgresql.com" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-book"></i>
      
      <span class="sidebar-button-desc">Mastering PostgreSQL</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/dimitri" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://twitter.com/tapoueh" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-twitter"></i>
      
      <span class="sidebar-button-desc">Twitter</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/categories">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      
  <div class="post-header-cover
              text-left
              post-header-cover--partial"
       style="background-image:url('/img/old/type-casting-machine.640.jpg')"
       data-behavior="5">
    
  </div>


      <div id="main" data-behavior="5"
        class="hasCover
               hasCoverMetaOut
               ">
        <article class="post" itemscope itemType="http://schema.org/BlogPosting">
          
          
            <div class="post-header main-content-wrap text-left">
  
    <h1 class="post-title" itemprop="headline">
      from MySQL to PostgreSQL
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time itemprop="datePublished" datetime="2017-07-06T17:30:11&#43;02:00">
        <span style="float: left; width: 35%">
          <i class="fa fa-calendar"></i> 
  
  
  
  
    Thursday 06 Jul 2017
  

        </span>
      </time>
    
    <span style="float: right; width: 65%">
      <i class="fa fa-clock-o"></i> 11 mins read
      
    </span>
    <span style="float: left; width: 35%">
      <i class="fa fa-bookmark"></i> 
  
  
    <span></span>
    
      <a class="category-link" href="/categories/postgresql">PostgreSQL</a>, 
    
      <a class="category-link" href="/categories/pgloader">pgloader</a>
    
  

    </span>
    <div>
      <p>
        
        
        
        
        <a href="/tags/mysql/">
          <i class="fa fa-tag"></i> MySQL
        </a>
        
        
        
        <a href="/tags/pgloader/">
          <i class="fa fa-tag"></i> pgloader
        </a>
        
        
      </p>
    </div>
  </div>


</div>
          
          <div class="post-content markdown" itemprop="articleBody">
            <div class="main-content-wrap">
              <p>Today
<a href="https://github.com/dimitri/pgloader/releases/tag/v3.4.1">pgloader v3.4.1</a>
is released and available! This new release comes with 110 commits as show
in
<a href="https://github.com/dimitri/pgloader/compare/v3.3.2...v3.4.1">github compare view</a>.</p>

<p>This release of <a href="http://pgloader.io">pgloader</a> is following the tradition of
simplifying things for users, or if you allow me to
quote <a href="https://en.wikiquote.org/wiki/Alan_Kay">Alan Kay</a>, I believe that if
<em>simple things should be simple, complex things should be possible.</em></p>

<p></p>

<div class="alert info ">
  <p><p>This article mentions pgloader features that are new as of version 3.4.1,
check which version you&rsquo;re running with <code>pgloader --version</code>. It is easy
enough to build pgloader from sources, and pgloader is packaged in debian
and derivatives, and in RPM based distributions too.</p>

<p>Have a look at <a href="http://apt.postgresql.org">http://apt.postgresql.org</a> and <a href="https://yum.postgresql.org/">https://yum.postgresql.org/</a>
for up to date packaged options in your distribution of choice and your
PostgreSQL version of choice.</p>
</p>
</div>

 




<div class="table-of-contents toc bd-callout">
    
    <h4 class="text-muted">Table of Contents</h4>
    
        
        
            
                
                
                
                    <ul class="toc-h1">
                
                
                
                
                <li>
                  <a href="/blog/2017/07/from-mysql-to-postgresql/#migrate-from-mysql-to-postgresql">
                    Migrate from MySQL to PostgreSQL
                  </a>
                </li>
                
                
                    </ul>
                
            
        
    
        
        
            
                
                
                
                    <ul class="toc-h1">
                
                
                
                
                <li>
                  <a href="/blog/2017/07/from-mysql-to-postgresql/#mysql-spatial-indexes-over-geometry">
                    MySQL spatial indexes over geometry
                  </a>
                </li>
                
                
                    </ul>
                
            
        
    
        
        
            
                
                
                
                    <ul class="toc-h1">
                
                
                
                
                <li>
                  <a href="/blog/2017/07/from-mysql-to-postgresql/#migrate-from-sqlite-to-postgresql">
                    Migrate from SQLite to PostgreSQL
                  </a>
                </li>
                
                
                    </ul>
                
            
        
    
        
        
            
                
                
                
                    <ul class="toc-h1">
                
                
                
                
                <li>
                  <a href="/blog/2017/07/from-mysql-to-postgresql/#migrate-from-ms-sql-to-postgresql">
                    Migrate from MS SQL to PostgreSQL
                  </a>
                </li>
                
                
                    </ul>
                
            
        
    
        
        
            
                
                
                
                    <ul class="toc-h1">
                
                
                
                
                <li>
                  <a href="/blog/2017/07/from-mysql-to-postgresql/#load-csv-files">
                    Load CSV files
                  </a>
                </li>
                
                
                    </ul>
                
            
        
    
        
        
            
                
                
                
                    <ul class="toc-h1">
                
                
                
                
                <li>
                  <a href="/blog/2017/07/from-mysql-to-postgresql/#the-load-command-and-new-options">
                    The load command and new options
                  </a>
                </li>
                
                
                    </ul>
                
            
        
    
        
        
            
                
                
                
                    <ul class="toc-h1">
                
                
                
                
                <li>
                  <a href="/blog/2017/07/from-mysql-to-postgresql/#the-orm-case-migrating-to-an-existing-schema">
                    The ORM case: migrating to an existing schema
                  </a>
                </li>
                
                
                    </ul>
                
            
        
    
        
        
            
                
                
                
                    <ul class="toc-h1">
                
                
                
                
                <li>
                  <a href="/blog/2017/07/from-mysql-to-postgresql/#schema-mapping-options">
                    Schema mapping options
                  </a>
                </li>
                
                
                    </ul>
                
            
        
    
        
        
            
                
                
                
                    <ul class="toc-h1">
                
                
                
                
                <li>
                  <a href="/blog/2017/07/from-mysql-to-postgresql/#user-defined-casting">
                    User defined casting
                  </a>
                </li>
                
                
                    </ul>
                
            
        
    
        
        
            
                
                
                
                    <ul class="toc-h1">
                
                
                
                
                <li>
                  <a href="/blog/2017/07/from-mysql-to-postgresql/#mysql-multiple-readers-support">
                    MySQL multiple readers support
                  </a>
                </li>
                
                
                    </ul>
                
            
        
    
        
        
            
                
                
                
                    <ul class="toc-h1">
                
                
                
                
                <li>
                  <a href="/blog/2017/07/from-mysql-to-postgresql/#conclusion">
                    Conclusion
                  </a>
                </li>
                
                
                    </ul>
                
            
        
    
</div>



<h2 id="migrate-from-mysql-to-postgresql">Migrate from MySQL to PostgreSQL</h2>

<p>An example of pgloader simplicity is that you can migrate a whole MySQL
database, including its schema definition of tables and indexes, primary key
and foreign key constraints, comments and default values, even when they
require installing a trigger in PostgreSQL, all of that in a single command
line:</p>

<pre><code>$ pgloader mysql://root@localhost/f1db pgsql:///f1db
2017-07-06T17:57:04.679000+02:00 LOG report summary reset
               table name       read   imported     errors      total time
-------------------------  ---------  ---------  ---------  --------------
          fetch meta data         33         33          0          0.206s 
           Create Schemas          0          0          0          0.026s 
         Create SQL Types          0          0          0          0.007s 
            Create tables         26         26          0          0.057s 
           Set Table OIDs         13         13          0          0.005s 
-------------------------  ---------  ---------  ---------  --------------
            f1db.circuits         73         73          0          0.093s 
  f1db.constructorresults      11011      11011          0          0.139s 
        f1db.constructors        208        208          0          0.047s 
             f1db.drivers        841        841          0          0.073s 
f1db.constructorstandings      11766      11766          0          0.237s 
            f1db.laptimes     413578     413578          0          2.643s 
     f1db.driverstandings      31420      31420          0          0.392s 
            f1db.pitstops       5796       5796          0          0.132s 
               f1db.races        976        976          0          0.076s 
             f1db.seasons         68         68          0          0.053s 
          f1db.qualifying       7257       7257          0          0.091s 
             f1db.results      23514      23514          0          0.431s 
              f1db.status        133        133          0          0.137s 
-------------------------  ---------  ---------  ---------  --------------
  COPY Threads Completion          4          4          0          3.265s 
           Create Indexes         20         20          0          1.760s 
   Index Build Completion         20         20          0          0.715s 
          Reset Sequences         10         10          0          0.029s 
             Primary Keys         13         13          0          0.010s 
      Create Foreign Keys          0          0          0          0.000s 
          Create Triggers          0          0          0          0.000s 
         Install Comments          0          0          0          0.000s 
-------------------------  ---------  ---------  ---------  --------------
        Total import time     506641     506641          0          4.888s 
</code></pre>

<p>You can easily reproduce that at home with
the <a href="http://ergast.com/mrd/db/">Ergast database</a>, a historical record of
motor racing data for non-commercial purposes. Download the <em>f1db.sql.gz</em>
MySQL 5.1 database dump from there, install it in some MySQL instance and
then run the command above.</p>

<p>To be complete, let&rsquo;s mention that pgloader will not create the target
database, so you have to do that yourself. Also, currently pgloader doesn&rsquo;t
change the <em>search_path</em> of the target database, so you might want to do
that yourself. Which means you need the following 3 commands if we wanted to
be exhaustive (the migration itself only happens at the pgloader step):</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ createdb f1db
$ pgloader mysql://root@localhost/f1db pgsql:///f1db
$ psql -d f1db -c <span style="color:#a50">&#39;ALTER DATABASE f1db SET search_path TO f1db, public;&#39;</span></code></pre></div>
<p><a href="http://pgloader.io">pgloader</a> needs a live MySQL database to operate its
magic. It is less error prone to query system&rsquo;s catalogs than to learn how
to parse all those SQL dialects.</p>

<p>You might have seen that the automated migration targets a PostgreSQL schema
with the same name as the MySQL database. That&rsquo;s because in MySQL there&rsquo;s
not really a notion of SQL standard catalogs, which are called <em>databases</em>
by most of the industry. What MySQL names a <em>database</em> actually is what the
standard (and PostgreSQL) refers to as a <em>schema</em>.</p>

<h2 id="mysql-spatial-indexes-over-geometry">MySQL spatial indexes over geometry</h2>

<p>Starting in this new release of pgloader, MySQL spatial keys are
automatically converted to PostgreSQL GiST indexes. In previous versions of
pgloader, when playing with
the <a href="https://dev.mysql.com/doc/sakila/en/">Sakila Sample Database</a> you would
have the following error:</p>

<pre><code>ERROR PostgreSQL Database error 42704: data type point has no default operator class for access method &quot;btree&quot;
HINT: You must specify an operator class for the index or define a default operator class for the data type.
QUERY: CREATE INDEX idx_188012_idx_location ON pagila.address (location);
</code></pre>

<p>In that case what we should do is issue to PostgreSQL the following <em>CREATE
INDEX</em> command instead:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#00a">CREATE</span> <span style="color:#00a">INDEX</span> idx_188012_idx_location <span style="color:#00a">ON</span> pagila.address <span style="color:#00a">USING</span> gist(<span style="color:#00a">location</span>);</code></pre></div>
<p>And guess what? yes of course this is a paste from a run of current
pgloader&rsquo;s version, where this is implemented in a transparent way for the
users. Also, rather than hardcoding which PostgreSQL types need a special
treatment here, pgloader runs the following SQL query against the PostgreSQL
catalogs, as found in the source tree
at
<a href="https://github.com/dimitri/pgloader/blob/master/src/pgsql/sql/list-typenames-without-btree-support.sql">src/pgsql/sql/list-typenames-without-btree-support.sql</a>:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#00a">select</span> typname,
       array_agg(amname <span style="color:#00a">order</span> <span style="color:#00a">by</span> amname &lt;&gt; <span style="color:#a50">&#39;gist&#39;</span>, amname &lt;&gt; <span style="color:#a50">&#39;gin&#39;</span>)
  <span style="color:#00a">from</span> pg_type
       <span style="color:#00a">join</span> pg_opclass <span style="color:#00a">on</span> pg_opclass.opcintype = pg_type.oid
       <span style="color:#00a">join</span> pg_am <span style="color:#00a">on</span> pg_am.oid = pg_opclass.opcmethod
 <span style="color:#00a">where</span> <span style="color:#00a">substring</span>(typname <span style="color:#00a">from</span> <span style="color:#099">1</span> <span style="color:#00a">for</span> <span style="color:#099">1</span>) &lt;&gt; <span style="color:#a50">&#39;_&#39;</span>
       <span style="color:#00a">and</span> <span style="color:#00a">not</span> <span style="color:#00a">exists</span>
       (
         <span style="color:#00a">select</span> amname
           <span style="color:#00a">from</span> pg_am am
                <span style="color:#00a">join</span> pg_opclass <span style="color:#00a">c</span> <span style="color:#00a">on</span> am.oid = <span style="color:#00a">c</span>.opcmethod
                <span style="color:#00a">join</span> pg_type t <span style="color:#00a">on</span> <span style="color:#00a">c</span>.opcintype = t.oid
          <span style="color:#00a">where</span> amname = <span style="color:#a50">&#39;btree&#39;</span> <span style="color:#00a">and</span> t.oid = pg_type.oid
       )
<span style="color:#00a">group</span> <span style="color:#00a">by</span> typname;</code></pre></div>
<p>The typical result of the query is following. The important part of
discovering data types without btree support at run time is that pgloader
then will support locally installed extensions it knows nothing about, and
that you can target in the user-defined casting rules (see below).</p>

<pre><code>  typname   │      array_agg       
════════════╪══════════════════════
 aclitem    │ {hash}
 box        │ {gist,brin,spgist}
 cid        │ {hash}
 circle     │ {gist}
 int2vector │ {hash}
 point      │ {gist,spgist,spgist}
 polygon    │ {gist}
 xid        │ {hash}
(8 rows)
</code></pre>

<p>In version 3.4.1 of pgloader this feature is limited to single column
indexes. If you need to support multiple-columns indexes, let me know by
<a href="https://github.com/dimitri/pgloader/issues">opening an issue</a>.</p>

<h2 id="migrate-from-sqlite-to-postgresql">Migrate from SQLite to PostgreSQL</h2>

<p>In much the same vein it is possible to migrate a full SQLite database into
PostgreSQL in a single command line. This time, as SQLite databases can be
distributed in a single file, we can even have pgloader download a file over
HTTP for us. Here&rsquo;s a full example using
the <a href="https://github.com/lerocha/chinook-database">chinook database</a>, where
again pgloader takes care of the schema definition, indexes, primary keys,
foreign keys, default values, comments&hellip; the whole thing:</p>

<pre><code>$ pgloader https://github.com/lerocha/chinook-database/raw/master/ChinookDatabase/DataSources/Chinook_Sqlite_AutoIncrementPKs.sqlite pgsql:///chinook
2017-07-06T18:16:52.256000+02:00 LOG Fetching 'https://github.com/lerocha/chinook-database/raw/master/ChinookDatabase/DataSources/Chinook_Sqlite_AutoIncrementPKs.sqlite'
2017-07-06T18:16:54.118000+02:00 ERROR PostgreSQL Database error 42P16: multiple primary keys for table &quot;playlisttrack&quot; are not allowed
QUERY: ALTER TABLE playlisttrack ADD PRIMARY KEY USING INDEX idx_189226_sqlite_autoindex_playlisttrack_1;
2017-07-06T18:16:54.119000+02:00 LOG report summary reset
             table name       read   imported     errors      total time
-----------------------  ---------  ---------  ---------  --------------
                  fetch          0          0          0          1.305s 
        fetch meta data         33         33          0          0.034s 
         Create Schemas          0          0          0          0.001s 
       Create SQL Types          0          0          0          0.006s 
          Create tables         22         22          0          0.096s 
         Set Table OIDs         11         11          0          0.007s 
-----------------------  ---------  ---------  ---------  --------------
                  album        347        347          0          0.020s 
                 artist        275        275          0          0.017s 
               customer         59         59          0          0.024s 
                  genre         25         25          0          0.024s 
            invoiceline       2240       2240          0          0.049s 
               employee          8          8          0          0.018s 
                invoice        412        412          0          0.032s 
               playlist         18         18          0          0.026s 
              mediatype          5          5          0          0.030s 
          playlisttrack       8715       8715          0          0.064s 
                  track       3503       3503          0          0.131s 
-----------------------  ---------  ---------  ---------  --------------
COPY Threads Completion          4          4          0          0.188s 
         Create Indexes         22         22          0          0.168s 
 Index Build Completion         22         22          0          0.066s 
        Reset Sequences          0          0          0          0.029s 
           Primary Keys         12         11          1          0.013s 
    Create Foreign Keys         11         11          0          0.042s 
        Create Triggers          0          0          0          0.001s 
       Install Comments          0          0          0          0.000s 
-----------------------  ---------  ---------  ---------  --------------
      Total import time      15607      15607          0          2.123s 
</code></pre>

<p>The SQLite catalog inspection isn&rsquo;t as straightforward as one would want to,
and it&rsquo;s been difficult to understand when exactly is an index a primary key
index. The documentation
of
<a href="http://www.sqlite.org/lang_createtable.html#rowid">ROWIDs and the INTEGER PRIMARY KEY</a> did
sched some light on the issues and we&rsquo;re good now, it seems. Well I&rsquo;m not
too sure about the error you see above, complaining that <em>multiple primary
keys for table &ldquo;playlisttrack&rdquo; are not allowed</em>. We might still have some
SQLite catalogs introspection hacking to do to be all good.</p>

<h2 id="migrate-from-ms-sql-to-postgresql">Migrate from MS SQL to PostgreSQL</h2>

<p>The new release of pgloader also comes with lots of small improvements to
the MS SQL support, where it now mostly just works. That&rsquo;s thanks to users
who did provide me with a test case to reproduce then fix the bugs. That
really is a life changer, in particular with proprietay software, where I
can&rsquo;t have a local copy running for my tests.</p>

<h2 id="load-csv-files">Load CSV files</h2>

<p>At the beginning, <a href="http://pgloader.io/howto/quickstart.html">pgloader</a> was
meant to load data from CSV files into PostgreSQL. For a large and flexible
definition of CSV. Now we include support for the COPY file format, fixed
width files, dBase files and IXF files.</p>

<h2 id="the-load-command-and-new-options">The load command and new options</h2>

<p>As mentioned earlier simple things are simple, and sometimes you need to do
more complex things, and the advanced use cases are handled by the pgloader
command language. This is
a <a href="https://en.wikipedia.org/wiki/Domain-specific_language">DSL</a> compiled to
binary at pgloader&rsquo;s run time.</p>

<h2 id="the-orm-case-migrating-to-an-existing-schema">The ORM case: migrating to an existing schema</h2>

<p>A classic complex case is when you&rsquo;re using an ORM that handles your
database schema for your application. It usually makes migrating easier, and
every thing else more difficult, so I don&rsquo;t recommend using ORMs. See
my <a href="/blog/2017/06/anonsql/">How to write SQL</a> article in this blog for more
details. And maybe the old and
good
<a href="http://blogs.tedneward.com/post/the-vietnam-of-computer-science/">The Vietnam of Computer Science</a> too,
if you haven&rsquo;t already.</p>

<p>Anyway, disliking ORMs is not reason enough to leave users out in the cold.
Of course pgloader supports your use case, and with the <em>data</em> only option
you can have it run a migration by discovering both the source and target
schemas and then working on a <em>merge</em> with the data from the source.</p>

<p>New in this release is the ability to target a pre-existing schema and still
benefit from the pgloader indexes processing, which is a very nice boost.
When loading lots of data into PostgreSQL it&rsquo;s best to:</p>

<ol>
<li>remove existing indexes, thus foreign keys that depend on them,</li>
<li>load data,</li>
<li>create indexes again, all at once in parallel,</li>
<li>upgrade unique indexes into primary keys with <em>ALTER TABLE</em>,</li>
<li>reinstall foreign key constraints with indexes in place.</li>
</ol>

<p>And of couse, as it&rsquo;s the best way to do things, that&rsquo;s exactly what
pgloader is doing. Now, even when the indexes are pre-defined in the target
schema, provided that you use the <em>drop indexes</em> option to the <em>WITH</em> clause.</p>

<p>Note that you can still use it on the command line, without a command file,
as in this example:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ pgloader --with <span style="color:#a50">&#34;data only&#34;</span>          <span style="color:#a50">\
</span><span style="color:#a50"></span>           --with truncate             <span style="color:#a50">\
</span><span style="color:#a50"></span>           --with <span style="color:#a50">&#34;drop indexes&#34;</span>       <span style="color:#a50">\
</span><span style="color:#a50"></span>           --verbose                   <span style="color:#a50">\
</span><span style="color:#a50"></span>           mysql://root@localhost/f1db <span style="color:#a50">\
</span><span style="color:#a50"></span>           pgsql:///f1db</code></pre></div>
<p>For this command to work, the f1db PostgreSQL target database must have been
defined before, with the right set of SQL objects of course. Which is
exactly what ORMs are doing for you, I&rsquo;ve been told.</p>

<h2 id="schema-mapping-options">Schema mapping options</h2>

<p>In the command language it is possible to map schema names and table names
from your source to your target database, and to add options to the load
scenario, as in the following example:</p>

<pre><code>load database
     from      mysql://root@localhost/sakila
     into postgresql:///sakila

 ALTER TABLE NAMES MATCHING 'sales_by_store' RENAME TO 'sales_by_store_list'
 ALTER TABLE NAMES MATCHING 'film' RENAME TO 'films'
 ALTER TABLE NAMES MATCHING ~/./ SET (fillfactor='40')

 ALTER SCHEMA 'sakila' RENAME TO 'pagila'
</code></pre>

<p>Here the <em>ALTER</em> commands are not executed in any database, neither the
source not the target. They are used as a mapping specifications from the
source to the target, so that we create tables found in the <em>sakila</em> schema
in the source into the <em>pagila</em> schema in the target.</p>

<p>Also you can see that we change
the
<a href="https://www.postgresql.org/docs/current/static/sql-createtable.html#SQL-CREATETABLE-STORAGE-PARAMETERS">fillfactor</a> for
all tables in the target. The <em>ALTER</em> clauses in the pgloader command are
realized over the internal pgloader catalogs, so that the actual
implementation is done at <em>CREATE TABLE</em> time in PostgreSQL.</p>

<h2 id="user-defined-casting">User defined casting</h2>

<p>The new version is not adding things to the capability of pgloader to allow
for user defined type casting from the source to the target database. Some
default cast rules have been improved, and you can
read
<a href="http://pgloader.io/howto/pgloader.1.html">pgloader reference documentation</a>
for details.</p>

<h2 id="mysql-multiple-readers-support">MySQL multiple readers support</h2>

<p>An experimental feature made it to this release of pgloader, and it&rsquo;s
currently only available for MySQL source type. It is now possible for
pgloader to have several concurrent readers working on the same source
table.</p>

<p>The idea is that they split the reading by using <em>WHERE</em> clauses, each over
a range of the data. That allows for MySQL Index Range Scan as documented at
their
<a href="https://dev.mysql.com/doc/refman/5.7/en/range-optimization.html">Range Optimization</a> documentation page.</p>

<p>In my testing I didn&rsquo;t have access to a machine with enough CPUs to make
this optimisation worthwile, but it might still be useful. Have a try if you
need it, and tell me if it helped!</p>

<p>Here&rsquo;s an example of a setup that uses the <em>multiple readers per thread</em>
feature, new in pgloader v3.4.1:</p>

<pre><code>load database
     from      mysql://root@localhost/sakila
     into postgresql:///sakila

 WITH concurrency = 2, workers = 6,
      prefetch rows = 25000,
      multiple readers per thread, rows per range = 50000;
</code></pre>

<h2 id="conclusion">Conclusion</h2>




<div class="figure fig25 right dim-margin" >
  
    <img class="fig-img" src="/img/old/sql-logo.png"  alt="PostgreSQL is YeSQL">
  
   
    <span class="caption">PostgreSQL is YeSQL</span>
  
</div>


<p>Now that you&rsquo;re using PostgreSQL, enjoy a powerful SQL dialect with plenty
of advanced functions to process your data exactly the way you need it!</p>

<p>You might be interested
into <a href="/blog/2017/06/exploring-a-data-set/">Exploring a Data Set in SQL</a> if
you&rsquo;re new to PostgreSQL or the database you&rsquo;ve just migrated.</p>

<p>Also if it makes sense for your business to contribute financially to
pgloader&rsquo;s development, consider buying
a <a href="http://pgloader.io/pgloader-moral-license.html">pgloader Moral License</a>.
Cases when it makes sense include successful migrations on a low budget and
within the time constraints thanks to using pgloader! You may then (at your
choice) join the <a href="http://pgloader.io/sponsors.html">pgloader sponsors page</a>!</p>
              
            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small"></span><br/>
                    
  <a class="tag tag--primary tag--small" href="/tags/postgresql/">PostgreSQL</a>

  <a class="tag tag--primary tag--small" href="/tags/mysql/">MySQL</a>

  <a class="tag tag--primary tag--small" href="/tags/pgloader/">pgloader</a>

                  </div>
                
              
            
            <div class="post-actions-wrap">
  <div class="post-footer-tags">
    
    
    <script async id="_ck_218061" src="https://forms.convertkit.com/218061?v=6"></script>
    
    
  </div>
  <nav>
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="/blog/2017/08/sql-regression-tests/" data-tooltip="SQL Regression Tests">
          
            <i class="fa fa-angle-left"></i>
            <span class="hide-xs hide-sm text-small icon-ml"></span>
          </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="/blog/2017/07/playing-with-unicode/" data-tooltip="Playing with Unicode">
          
            <span class="hide-xs hide-sm text-small icon-mr"></span>
            <i class="fa fa-angle-right"></i>
          </a>
        </li>
      
    </ul>
  </nav>
  <ul class="post-actions post-action-share">
    
      <li class="post-action hide-lg hide-md hide-sm">
        <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
          <i class="fa fa-share-alt"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https%3a%2f%2ftapoueh.org%2fblog%2f2017%2f07%2ffrom-mysql-to-postgresql%2f">
          <i class="fa fa-google-plus"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ftapoueh.org%2fblog%2f2017%2f07%2ffrom-mysql-to-postgresql%2f">
          <i class="fa fa-facebook-official"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=from%20MySQL%20to%20PostgreSQL with @tapoueh: https%3a%2f%2ftapoueh.org%2fblog%2f2017%2f07%2ffrom-mysql-to-postgresql%2f">
          <i class="fa fa-twitter"></i>
        </a>
      </li>
    
    
      <li class="post-action">
        <a class="post-action-btn btn btn--default" href="#disqus_thread">
          <i class="fa fa-comment-o"></i>
        </a>
      </li>
    
    <li class="post-action">
      
        <a class="post-action-btn btn btn--default" href="#table-of-contents">
      
        <i class="fa fa-list"></i>
      </a>
    </li>
  </ul>
</div>


            
              
                <div id="disqus_thread">
  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2018 Dimitri Fontaine. 
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
        <div class="post-actions-wrap">
  <div class="post-footer-tags">
    
    
    <script async id="_ck_218061" src="https://forms.convertkit.com/218061?v=6"></script>
    
    
  </div>
  <nav>
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="/blog/2017/08/sql-regression-tests/" data-tooltip="SQL Regression Tests">
          
            <i class="fa fa-angle-left"></i>
            <span class="hide-xs hide-sm text-small icon-ml"></span>
          </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="/blog/2017/07/playing-with-unicode/" data-tooltip="Playing with Unicode">
          
            <span class="hide-xs hide-sm text-small icon-mr"></span>
            <i class="fa fa-angle-right"></i>
          </a>
        </li>
      
    </ul>
  </nav>
  <ul class="post-actions post-action-share">
    
      <li class="post-action hide-lg hide-md hide-sm">
        <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
          <i class="fa fa-share-alt"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https%3a%2f%2ftapoueh.org%2fblog%2f2017%2f07%2ffrom-mysql-to-postgresql%2f">
          <i class="fa fa-google-plus"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ftapoueh.org%2fblog%2f2017%2f07%2ffrom-mysql-to-postgresql%2f">
          <i class="fa fa-facebook-official"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=from%20MySQL%20to%20PostgreSQL with @tapoueh: https%3a%2f%2ftapoueh.org%2fblog%2f2017%2f07%2ffrom-mysql-to-postgresql%2f">
          <i class="fa fa-twitter"></i>
        </a>
      </li>
    
    
      <li class="post-action">
        <a class="post-action-btn btn btn--default" href="#disqus_thread">
          <i class="fa fa-comment-o"></i>
        </a>
      </li>
    
    <li class="post-action">
      
        <a class="post-action-btn btn btn--default" href="#table-of-contents">
      
        <i class="fa fa-list"></i>
      </a>
    </li>
  </ul>
</div>


      </div>
      <div id="share-options-bar" class="share-options-bar" data-behavior="5">
  <ul class="share-options">
    <li class="share-option">
      <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=https%3a%2f%2ftapoueh.org%2fblog%2f2017%2f07%2ffrom-mysql-to-postgresql%2f">
        <i class="fa fa-google-plus"></i><span></span>
      </a>
    </li>
    <li class="share-option">
      <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ftapoueh.org%2fblog%2f2017%2f07%2ffrom-mysql-to-postgresql%2f">
        <i class="fa fa-facebook-official"></i><span></span>
      </a>
    </li>
    <li class="share-option">
      <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=from%20MySQL%20to%20PostgreSQL with @tapoueh: https%3a%2f%2ftapoueh.org%2fblog%2f2017%2f07%2ffrom-mysql-to-postgresql%2f">
        <i class="fa fa-twitter"></i><span></span>
      </a>
    </li>
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>

    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="//www.gravatar.com/avatar/7b615d104c506aa0a49e17151fa94d9f?s=110" alt="" />
    
    <h4 id="about-card-name">Dimitri Fontaine</h4>
    
      <div id="about-card-bio">PostgreSQL Major Contributor</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Open Source Software Engineer
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        France
      </div>
    
  </div>
</div>

    <div id="algolia-search-modal" class="modal-container">
  <div class="modal">
    <div class="modal-header">
      <span class="close-button"><i class="fa fa-close"></i></span>
      <a href="https://algolia.com" target="_blank" rel="noopener" class="searchby-algolia text-color-light link-unstyled">
        <span class="searchby-algolia-text text-color-light text-small">by</span>
        <img class="searchby-algolia-logo" src="https://www.algolia.com/static_assets/images/press/downloads/algolia-light.svg">
      </a>
      <i class="search-icon fa fa-search"></i>
      <form id="algolia-search-form">
        <input type="text" id="algolia-search-input" name="search"
          class="form-control input--large search-input" placeholder="" />
      </form>
    </div>
    <div class="modal-body">
      <div class="no-result text-color-light text-center"></div>
      <div class="results">
        
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://tapoueh.org/blog/2018/08/postgresql-concurrency-an-article-series/">
                <h3 class="media-heading">PostgreSQL Concurrency: an Article Series</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Aug 8, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p><a href="https://www.postgresql.org">PostgreSQL</a> is a relational database management
system. It&rsquo;s even the world&rsquo;s most advanced open source one of them. As
such, as its core, Postgres solves concurrent access to a set of data and
maintains consistency while allowing concurrent operations.</p>

<p>In the <a href="/tags/concurrency/">PostgreSQL Concurrency</a> series of articles here
we did see several aspects of how to handle concurrent use cases of your
application design with PostgreSQL. The main thing to remember is that a
Database Management System first task is to handle concurrency access to the
data for you.</p>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://tapoueh.org/blog/2018/08/scheduled-data-processing-how-to-use-cron/">
                <h3 class="media-heading">Scheduled Data Processing: How to use cron?</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Aug 8, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>A previous article in the <a href="/tags/concurrency">PostgreSQL Concurrency</a> series
covered how to manage concurrent retweets in an efficient way: in <a href="/blog/2018/07/computing-and-caching/">Computing
and Caching</a>, we learnt how to
maintain a cache right in your PostgreSQL database, using MATERIALIZED
VIEWS. We also had a look at how to take care of <a href="/blog/2018/07/batch-updates-and-concurrency/">Batch Updates and
Concurrency</a>.</p>

<p>While in the first case we are providing a solution to a technical problem
where we want to solve performance issues while keeping the same semantics,
in the second case we are actually implementing a part of the application&rsquo;s
<a href="/blog/2017/06/sql-and-business-logic/">Business Logic</a> as a scheduled job.</p>

<p>Today&rsquo;s article shows a modern technique to handle the scheduling of those
business oriented activities that are not tied to any user activity. When
thinking about it this way, you certainly don&rsquo;t want to implement the
backbone of your business logic in a <em>shell script</em> that&rsquo;s directly
maintained in the production environment, do you?</p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://tapoueh.org/blog/2018/07/batch-updates-and-concurrency/">
                <h3 class="media-heading">Batch Updates and Concurrency</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jul 7, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>This article fits in the <a href="/tags/concurrency">PostgreSQL Concurrency</a> series,
where we installed a tweeter like application schema and had all the
characters from Shakespeare&rsquo;s <em>A Midsummer Night&rsquo;s Dream</em> tweet their own
lines in our database in <a href="/blog/2018/06/PostgreSQL-DML.md">PostgreSQL Concurrency: Data Modification
Language</a>.</p>

<p>A previous article in the series covered how to manage concurrent retweets
in an efficient way: <a href="/blog/2018/07/computing-and-caching/">Computing and
Caching</a>, where we learn how to
maintain a cache right in your PostgreSQL database, thanks for materialized
views. We even went as far as maintaining an <em>external</em> cache in another
application layer using PostgreSQL
<a href="https://www.postgresql.org/docs/current/static/sql-listen.html">LISTEN</a> and
<a href="https://www.postgresql.org/docs/current/static/sql-notify.html">NOTIFY</a>
features and a Golang application.</p>

<p>Today&rsquo;s article is going to address concurrency in the context of updating
data in a batch. This activity is quite common, as soon as your system is
connected to other systems either internally or with external providers.
While it&rsquo;s pretty easy to ingest new data, and easy enough to update data
from an external source when nothing happens in your database, doing the
operation safely with concurrent activity is more complex. Once more though,
PostgreSQL comes with all the tooling you need to handle that situation.</p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://tapoueh.org/blog/2018/07/postgresql-listen/notify/">
                <h3 class="media-heading">PostgreSQL LISTEN/NOTIFY</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jul 7, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>This article fits in the <a href="/tags/concurrency">PostgreSQL Concurrency</a> series,
where we installed a tweeter like application schema and had all the
characters from Shakespeare&rsquo;s <em>A Midsummer Night&rsquo;s Dream</em> tweet their own
lines in our database in <a href="/blog/2018/06/PostgreSQL-DML.md">PostgreSQL Concurrency: Data Modification
Language</a>.</p>

<p>A previous article in the series covered how to manage concurrent retweets
in an efficient way: <a href="/blog/2018/07/computing-and-caching/">Computing and
Caching</a>, where we learn how to
maintain a cache right in your PostgreSQL database, thanks for materialized
views.</p>

<p>Today&rsquo;s article shows how to maintain an <em>external</em> cache in another
application layer. In this article we are going to maintain an in-memory
cache in a Golang service, using PostgreSQL
<a href="https://www.postgresql.org/docs/current/static/sql-listen.html">LISTEN</a> and
<a href="https://www.postgresql.org/docs/current/static/sql-notify.html">NOTIFY</a>
features.</p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://tapoueh.org/blog/2018/07/postgresql-event-based-processing/">
                <h3 class="media-heading">PostgreSQL Event Based Processing</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jul 7, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>In the previous article of the series <a href="/blog/2018/07/modeling-for-concurrency/">Modeling for
Concurrency</a>, we saw how to model
your application for highly concurrent activity. It was a follow-up to the
article entitled <a href="/blog/2018/07/postgresql-concurrency-isolation-and-locking/">PostgreSQL Concurrency: Isolation and
Locking</a>, which
was a primer on PostgreSQL isolation and locking properties and behaviors.</p>

<p>Today&rsquo;s article takes us a step further and builds on what we did in the
previous articles in our series. After having had all the characters from
Shakespeare&rsquo;s <em>A Midsummer Night&rsquo;s Dream</em> tweet their own lines in our
database in <a href="/blog/2018/06/PostgreSQL-DML.md">PostgreSQL Concurrency: Data Modification
Language</a>, and having had them like and
retweet a lot in <a href="/blog/2018/07/postgresql-concurrency-isolation-and-locking/">PostgreSQL Concurrency: Isolation and
Locking</a>, we
saw how to manage concurrent retweets in an efficient way in <a href="/blog/2018/07/computing-and-caching/">Computing and
Caching</a>.</p>

<p>What we did implement in the previous article is a <em>cache</em> system, all with
its necessary <strong>cache invalidation policy</strong>. Sometimes though, the
processing of an <em>event</em> needs to happen within the same transaction where
the event is registered in your system. PostgreSQL makes it possible to
maintain a summary table transactionally thanks to its
<a href="https://www.postgresql.org/docs/current/static/sql-createtrigger.html">trigger</a>
support. Today, we&rsquo;re going to dive in how to maintain a summary table with
triggers, and its impact on concurrency.</p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://tapoueh.org/blog/2018/07/computing-and-caching/">
                <h3 class="media-heading">Computing and Caching</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jul 7, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>Let&rsquo;s continue to dive in PostgreSQL Concurrency. In the previous article of
the series, <a href="/blog/2018/07/modeling-for-concurrency/">Modeling for
Concurrency</a>, we saw how to model
your application for highly concurrent activity. It was a follow-up to the
article entitled <a href="/blog/2018/07/postgresql-concurrency-isolation-and-locking/">PostgreSQL Concurrency: Isolation and
Locking</a>, which
was a primer on PostgreSQL isolation and locking properties and behaviors.</p>

<p>Today&rsquo;s article takes us a step further and builds on what we did in the
previous articles in our series. After having had all the characters from
Shakespeare&rsquo;s <em>A Midsummer Night&rsquo;s Dream</em> tweet their own lines in our
database in <a href="/blog/2018/06/PostgreSQL-DML.md">PostgreSQL Concurrency: Data Modification
Language</a>, and having had them like a
retweet a lot in <a href="/blog/2018/07/postgresql-concurrency-isolation-and-locking/">PostgreSQL Concurrency: Isolation and
Locking</a>, it&rsquo;s
time to think about how to display our counters in an efficient way.</p>

<p>In this article, we&rsquo;re going to think about when we should compute results
and when we should cache them for instant retrieval, all within the SQL
tooling. The SQL tooling for handling cache is a <a href="https://www.postgresql.org/docs/current/static/sql-creatematerializedview.html">MATERIALIZED
VIEW</a>,
and it comes with <strong>cache invalidation</strong> routines, of course.</p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://tapoueh.org/blog/2018/07/modeling-for-concurrency/">
                <h3 class="media-heading">Modeling for Concurrency</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jul 7, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>Let&rsquo;s continue to dive in PostgreSQL Concurrency. Last week&rsquo;s article
<a href="/blog/2018/07/postgresql-concurrency-isolation-and-locking/">PostgreSQL Concurrency: Isolation and
Locking</a> was a
primer on PostgreSQL isolation and locking properties and behaviors.</p>

<p>Today&rsquo;s article takes us a step further and builds on what we did last week,
in particular the database modeling for a <em>tweet</em> like application. After
having had all the characters from Shakespeare&rsquo;s <em>A Midsummer Night&rsquo;s Dream</em>
tweet their own lines in our database in <a href="/blog/2018/06/PostgreSQL-DML.md">PostgreSQL Concurrency: Data
Modification Language</a>, it&rsquo;s time for them
to do some actions on the tweets: likes and retweet.</p>

<p>Of course, we&rsquo;re going to put concurrency to the test, so we&rsquo;re going to
have to handle very very popular tweets from the play!</p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://tapoueh.org/blog/2018/07/postgresql-concurrency-isolation-and-locking/">
                <h3 class="media-heading">PostgreSQL Concurrency: Isolation and Locking</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jul 7, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p><a href="https://www.postgresql.org">PostgreSQL</a> is a relational database management
system. It&rsquo;s even the world&rsquo;s most advanced open source one of them. As
such, as its core, Postgres solves concurrent access to a set of data and
maintains consistency while allowing concurrent operations.</p>

<p>This article is a primer on PostgreSQL Isolation and Locking properties and
behaviors. You might be interested into the previous article in the series:
<a href="/blog/2018/06/postgresql-concurrency-data-modification-language/">PostgreSQL Concurrency: Data Modification
Language</a>.</p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://tapoueh.org/blog/2018/06/postgresql-concurrency-data-modification-language/">
                <h3 class="media-heading">PostgreSQL Concurrency: Data Modification Language</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jun 6, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">PostgreSQL is a relational database management system. It&rsquo;s even the world&rsquo;s most advanced open source one of them. As such, as its core, Postgres solves concurrent access to a set of data and maintains consistency while allowing concurrent operations.
Postgres exposes its concurrency APIs in the SQL language, in particular in the DML parts of it: you can read the Data Manipulation Language chapter of the PostgreSQL docs for all the details.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://tapoueh.org/blog/2018/05/postgresql-data-types/">
                <h3 class="media-heading">PostgreSQL Data Types</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  May 5, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>Today it&rsquo;s time to conclude our series of <a href="/tags/data-types/">PostgreSQL Data
Types</a> articles with a recap. The series cover lots of
core PostgreSQL data types and shows how to benefit from the PostgreSQL
concept of a data type: more than input validation, a PostgreSQL data type
also implements expected behaviors and processing functions.</p>

<p>This allows an application developer to rely on PostgreSQL for more complex
queries, having the processing happen where the data is, for instance when
implementing advanced JOIN operations, then retrieving only the data set
that is interesting for the application.</p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
      </div>
    </div>
    <div class="modal-footer">
      <p class="results-count text-medium"
         data-message-zero=""
         data-message-one=""
         data-message-other="">
         282 posts found
      </p>
    </div>
  </div>
</div>
    
  
    
    <div id="cover" style="background-image:url('https://tapoueh.org/images/mayan-calendar.jpg');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.7/js/jquery.fancybox.min.js" integrity="sha256-GEAnjcTqVP+vBp3SSc8bEDQqvWAZMiHyUSIorrWwH50=" crossorigin="anonymous"></script>


<script src="/js/script-qi9wbxp2ya2j6p7wx1i6tgavftewndznf4v0hy2gvivk1rxgc3lm7njqb6bz.min.js"></script>



<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight > code, pre > code').each(function(i, block) {
    if (!$(this).hasClass('codeblock')) {
      $(this).addClass('codeblock');
    }
    hljs.highlightBlock(block);
  });
});
</script>


  
    
      <script>
        var disqus_config = function () {
          this.page.url = 'https:\/\/tapoueh.org\/blog\/2017\/07\/from-mysql-to-postgresql\/';
          
            this.page.identifier = '\/blog\/2017\/07\/from-mysql-to-postgresql\/'
          
        };
        (function() {
          
          
          if (window.location.hostname == "localhost") {
            return;
          }
          var d = document, s = d.createElement('script');
          var disqus_shortname = 'tapoueh';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    
  



    
  </body>
</html>

