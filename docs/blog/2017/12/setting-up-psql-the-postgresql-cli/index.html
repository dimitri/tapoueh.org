

  
    
  


  




  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Hugo 0.50">
    <meta name="theme" content="Tranquilpeak 0.3.1-BETA">
    <title>Setting up psql, the PostgreSQL CLI</title>
    <meta name="author" content="Dimitri Fontaine">
    <meta name="keywords" content="">

    <link rel="icon" href="/favicon.ico">
    

    
    <meta name="description" content="PostgreSQL ships with an interactive console with the command line tool
named psql.
It can be used both for scripting and interactive usage and is moreover
quite a powerful tool. Interactive features includes autocompletion,
readline support (history searches, modern keyboard movements, etc), input
and output redirection, formatted output, and more.

">
    <meta property="og:description" content="PostgreSQL ships with an interactive console with the command line tool
named psql.
It can be used both for scripting and interactive usage and is moreover
quite a powerful tool. Interactive features includes autocompletion,
readline support (history searches, modern keyboard movements, etc), input
and output redirection, formatted output, and more.

">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Setting up psql, the PostgreSQL CLI">
    <meta property="og:url" content="/blog/2017/12/setting-up-psql-the-postgresql-cli/">
    <meta property="og:site_name" content="The Art of PostgreSQL">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Setting up psql, the PostgreSQL CLI">
    <meta name="twitter:description" content="PostgreSQL ships with an interactive console with the command line tool
named psql.
It can be used both for scripting and interactive usage and is moreover
quite a powerful tool. Interactive features includes autocompletion,
readline support (history searches, modern keyboard movements, etc), input
and output redirection, formatted output, and more.

">
    
      <meta name="twitter:creator" content="@tapoueh">
    
    

    
    

    
      <meta property="og:image" content="//www.gravatar.com/avatar/7b615d104c506aa0a49e17151fa94d9f?s=640">
    

    
      <meta property="og:image" content="https://tapoueh.org/img/icon-cli.png">
    
    
      <meta property="og:image" content="https://tapoueh.org/img/terminal-bg.jpg">
    
    

    

    
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.css" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" />
    
    
    <link rel="stylesheet" href="/css/style-jsjn0006wyhpyzivf6yceb31gvpjatbcs3qzjvlumobfnugccvobqwxnnaj8.min.css" />
    
    
      <link rel="stylesheet" href="https://tapoueh.org/css/dim.css">
    
      <link rel="stylesheet" href="https://tapoueh.org/css/nav.css">
    

    
      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-47059482-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="5">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="navbar-collapse collapse header-title" id="navigation">
    <ul class="nav navbar-nav navbar-right">
      
      <li class="dropdown">
        
        <a style="color: black;" href="/" alt="blog"><i class="sidebar-button-icon fa fa-lg fa-home"></i></a>
        
      </li>
      
      <li class="dropdown">
        
        <a style="color: black;" href="/conf/" alt="talks"><i class="sidebar-button-icon fa fa-lg fa-microphone"></i></a>
        
      </li>
      
      <li class="dropdown">
        
        <a style="color: black;" href="https://twitter.com/tapoueh" alt="Twitter"><i class="sidebar-button-icon fa fa-lg fa-twitter"></i></a>
        
      </li>
      
      <li class="dropdown">
        
        <a style="color: black;" href="https://masteringpostgresql.com/" alt="Mastering PostgreSQL"><i class="sidebar-button-icon fa fa-lg fa-book"></i></a>
        
      </li>
      
      <li class="dropdown">
        
        <a style="color: black;" href="http://theartofpostgresql.com" alt="The Art Of PostgreSQL"><i class="sidebar-button-icon fa fa-lg fa-edit"></i></a>
        
      </li>
      
    </ul>
  </div>

  
    
      <a class="header-right-icon "
         href="http://masteringpostgresql.com" target="_blank">
    
    
      <i class="fa fa-lg fa-book"></i>
    
    
    </a>
  
</header>

      <nav id="sidebar" data-behavior="5">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="/#about">
          <img class="sidebar-profile-picture" src="//www.gravatar.com/avatar/7b615d104c506aa0a49e17151fa94d9f?s=110" alt="" />
        </a>
        <h4 class="sidebar-profile-name">Dimitri Fontaine</h4>
        
          <h5 class="sidebar-profile-bio">PostgreSQL Major Contributor</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/">
    
      <i class="sidebar-button-icon fa fa-lg fa-pagelines"></i>
      
      <span class="sidebar-button-desc">Blog</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/about/">
    
      <i class="sidebar-button-icon fa fa-lg fa-beer"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/categories/yesql/">
    
      <i class="sidebar-button-icon fa fa-lg fa-database"></i>
      
      <span class="sidebar-button-desc">YeSQL</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="http://masteringpostgresql.com" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-book"></i>
      
      <span class="sidebar-button-desc">Mastering PostgreSQL</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/dimitri" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://twitter.com/tapoueh" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-twitter"></i>
      
      <span class="sidebar-button-desc">Twitter</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/categories">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      
  <div class="post-header-cover
              text-left
              post-header-cover--partial"
       style="background-image:url('/img/terminal-bg.jpg')"
       data-behavior="5">
    
      <div class="post-header main-content-wrap text-left">
  
    <h1 class="post-title" itemprop="headline">
      Setting up psql, the PostgreSQL CLI
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time itemprop="datePublished" datetime="2017-12-22T15:23:43&#43;01:00">
        <span style="float: left; width: 35%">
          <i class="fa fa-calendar"></i> 
  
  
  
  
    Friday 22 Dec 2017
  

        </span>
      </time>
    
    <span style="float: right; width: 65%">
      <i class="fa fa-clock-o"></i> 10 mins read
      
    </span>
    <span style="float: left; width: 35%">
      <i class="fa fa-bookmark"></i> 
  
  
    <span></span>
    
      <a class="category-link" href="/categories/postgresql">PostgreSQL</a>, 
    
      <a class="category-link" href="/categories/yesql">YeSQL</a>
    
  

    </span>
    <div>
      <p>
        
        
        
        
        
        
        <a href="/tags/psql/">
          <i class="fa fa-tag"></i> psql
        </a>
        
        
        
        <a href="/tags/setup/">
          <i class="fa fa-tag"></i> setup
        </a>
        
        
      </p>
    </div>
  </div>


</div>
    
  </div>


      <div id="main" data-behavior="5"
        class="hasCover
               hasCoverMetaIn
               ">
        <article class="post" itemscope itemType="http://schema.org/BlogPosting">
          
          
          <div class="post-content markdown" itemprop="articleBody">
            <div class="main-content-wrap">
              <p>PostgreSQL ships with an interactive console with the command line tool
named <a href="https://www.postgresql.org/docs/current/static/app-psql.html">psql</a>.
It can be used both for scripting and interactive usage and is moreover
quite a powerful tool. Interactive features includes <em>autocompletion</em>,
<em>readline</em> support (history searches, modern keyboard movements, etc), input
and output redirection, formatted output, and more.</p>

<p></p>

<figure class="right"><a href="http://masteringpostgresql.com">
    <img src="/img/MasteringPostgreSQLinAppDev-Cover-th.png"/> </a>
</figure>


<blockquote>
<p><em>This article is extracted from my book <a href="https://masteringpostgresql.com">Mastering PostgreSQL in
Application Development</a>. If you like
what you read here, you might enjoy a full book of SQL learning material!</em></p>
</blockquote>

 






<p>New users of PostgreSQL often want to find an advanced visual query editing
tool and are confused when <em>psql</em> is the answer. Most PostgreSQL advanced
users and experts don&rsquo;t even think about it and use <em>psql</em>. In this chapter,
you will learn how to fully appreciate that little command line tool.</p>

<h1 id="intro-to-psql">Intro to psql</h1>

<p><em>psql</em> implements a REPL: the famous read-eval-print loop. It&rsquo;s one of the
best ways to interact with the computer when you&rsquo;re just learning and trying
things out. In the case of PostgreSQL you might be discovering a schema, a
data set, or just working on a query.</p>

<p>We often see the SQL query when it&rsquo;s fully formed, and rarely get to see the
steps that led us there. It&rsquo;s the same with code, most often what you get to
see is its final form, not the intermediary steps where the author tries
things and refine their understanding of the problem at hand, or the
environment in which to solve it.</p>

<p>The process to follow to get to a complete and efficient SQL query is the
same as when writing code: iterating from a very simple angle towards a full
solution to the problem at hand. Having a <em>REPL</em> environment offers an easy
way to build up on what you just had before.</p>

<h1 id="the-psqlrc-setup">The psqlrc Setup</h1>

<p>Here we begin with a full setup of <em>psql</em> and in the rest of the chapter, we
are going to get back to each important point separately. Doing so allows
you to have a fully working environment from the get-go and play around in
your PostgreSQL console while reading the book.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-psql" data-lang="psql">\set PROMPT1 &#39;%~%#%x &#39;
\x auto
\set ON_ERROR_STOP on
\set ON_ERROR_ROLLBACK interactive
\set HISTFILE ~/.psql_history-:DBNAME

\set VERBOSITY verbose

-- \pset null &#39;⦱&#39;
\pset null &#39;¤&#39;
\pset linestyle &#39;unicode&#39;

\pset unicode_border_linestyle single
\pset unicode_column_linestyle single
\pset unicode_header_linestyle double

set intervalstyle to &#39;postgres_verbose&#39;;

\setenv LESS &#39;-iMFXSx4R&#39;
\setenv EDITOR &#39;/Applications/Emacs.app/Contents/MacOS/bin/emacsclient -nw&#39;</code></pre></div>
<p>Save that setup in the <code>~/.psqlrc</code> file, which is read at startup by the
<em>psql</em> application. As you&rsquo;ve already read in the PostgreSQL documentation
for <em>psql</em>, we have three different settings to play with here:</p>

<ul>
<li><p><code>\set [ name [ value [ ... ] ] ]</code></p>

<p>This sets the psql variable name to value, or if more than one value is
given, to the concatenation of all of them. If only one argument is
given, the variable is set with an empty value. To unset a variable, use
the <code>\unset</code> command.</p></li>

<li><p><code>\setenv name [ value ]</code></p>

<p>This sets the environment variable name to value, or if the value is not
supplied, unsets the environment variable.</p>

<p>Here we use this facility to setup specific environment variables we
need from within <code>psql</code>, such as the <em>LESS</em> setup. It allows invoking
the <em>pager</em> for each result set but having it take the control of the
screen only when necessary.</p></li>

<li><p><code>\pset [ option [ value ] ]</code></p>

<p>This command sets options affecting the output of query result tables.
<em>option</em> indicates which option is to be set. The semantics of <em>value</em>
vary depending on the selected option. For some options, omitting
<em>value</em> causes the option to be toggled or unset, as described under the
particular option. If no such behavior is mentioned, then omitting
<em>value</em> just results in the current setting being displayed.</p></li>
</ul>

<p>Note that you will need to adapt the <code>EDITOR</code> setting to match your
preference in both editor and Operating System.</p>

<h1 id="transactions-and-psql-behavior">Transactions and psql Behavior</h1>

<p>In our case we set several psql variables that change its behavior:</p>

<ul>
<li><p><code>\set ON_ERROR_STOP on</code></p>

<p>The name is quite a good description of the option. It allows <em>psql</em> to
know that it is not to continue trying to execute all your commands when
a previous one is throwing an error. It&rsquo;s primarily practical for
scripts and can be also set using the command line. As we&rsquo;ll see later,
we can easily invoke scripts interactively within our session with the
<code>\i</code> and <code>\ir</code> commands, so the option is still useful to us now.</p></li>

<li><p><code>\set ON_ERROR_ROLLBACK interactive</code></p>

<p>This setting changes how <em>psql</em> behaves with respect to transactions. It
is a very good interactive setup, and must be avoided in batch scripts.</p>

<p>From the documentation: When set to on, if a statement in a transaction
block generates an error, the error is ignored and the transaction
continues. When set to interactive, such errors are only ignored in
interactive sessions, and not when reading script files. When unset or
set to off, a statement in a transaction block that generates an error
aborts the entire transaction. The error rollback mode works by issuing
an implicit SAVEPOINT for you, just before each command that is in a
transaction block, and then rolling back to the savepoint if the command
fails.</p></li>
</ul>

<p>With the <code>\set PROMPT1 '%~%x%# '</code> that we are using, <em>psql</em> displays a
little star in the prompt when there&rsquo;s a transaction in flight, so you know
you need to finish the transaction. More importantly, when you want to type
in anything that will have a side effect on your database (modifying the
data set or the database schema), then without the star you know you need to
first type in <code>BEGIN</code>.</p>

<p>Let&rsquo;s see an example output with <em>ON_ERROR_ROLLBACK</em> set to off. Here&rsquo;s its
default value:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-psql" data-lang="psql">f1db# begin;
BEGIN
f1db#* select 1/0;
ERROR:  division by zero
f1db#! select 1+1;
ERROR:  current transaction is aborted, commands ignored until end of transaction block
f1db#! rollback;
ROLLBACK</code></pre></div>
<p>We have an error in our transaction, and we notice that the star prompt is
now a flag. The SQL transaction is marked invalid, and the only thing
PostgreSQL will now accept from us is to finish the transaction, with either
a <em>commit</em> or a <em>rollback</em> command. Both will result in the same result from
the server: <code>ROLLBACK</code>.</p>

<p>Now, let&rsquo;s do the same SQL transaction again, this time with
<em>ON_ERROR_ROLLBACK</em> being set to <em>interactive</em>. Now, before each command we
send to the server, <em>psql</em> sends a
<a href="https://www.postgresql.org/docs/current/static/sql-savepoint.html">savepoint</a>
command, which allows it to then issue a <a href="https://www.postgresql.org/docs/current/static/sql-rollback-to.html">rollback to
savepoint</a>
command in case of an error. This <em>rollback to savepoint</em> is also sent
automatically:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-psql" data-lang="psql">f1db# begin;
BEGIN
f1db#* select 1/0;
ERROR:  division by zero
f1db#* select 1+1;
 ?column? 
══════════
        2
(1 row)

f1db#* commit;
COMMIT</code></pre></div>
<p>Notice how this time not only do we get to send successful commands after
the error, while still being in a transaction — also we get to be able to
<em>COMMIT</em> our work to the server.</p>

<h1 id="a-reporting-tool">A Reporting Tool</h1>

<p>Getting familiar with <em>psql</em> is a very good productivity enhancer, so my
advice is to spend some quality time with the documentation of the tool and
get used to it. In this chapter, we are going to simplify things and help
you to get started.</p>

<p>There are mainly two use cases for <em>psql</em>, either as an interactive tool or
as a scripting and reporting tool. In the first case, the idea is that you
have plenty of commands to help you get your work done, and you can type in
SQL right in your terminal and see the result of the query.</p>

<p>In the scripting and reporting use case, you have advanced formatting
commands: it is possible to run a query and fetch its result directly in
either <em>asciidoc</em> or <em>HTML</em> for example, given <code>\pset format</code>. Say we have a
query that reports the N bests known results for a given driver surname. We
can use <em>psql</em> to set dynamic variables, display tuples only and format the
result in a convenient HTML output:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">~ psql --tuples-only      <span style="color:#a50">\
</span><span style="color:#a50"></span>       --set <span style="color:#a00">n</span>=<span style="color:#099">1</span>          <span style="color:#a50">\
</span><span style="color:#a50"></span>       --set <span style="color:#a00">name</span>=Alesi   <span style="color:#a50">\
</span><span style="color:#a50"></span>       --no-psqlrc        <span style="color:#a50">\
</span><span style="color:#a50"></span>       -P <span style="color:#a00">format</span>=html     <span style="color:#a50">\
</span><span style="color:#a50"></span>       -d f1db            <span style="color:#a50">\
</span><span style="color:#a50"></span>       -f report.sql</code></pre></div><div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#1e90ff;font-weight:bold">table</span> <span style="color:#1e90ff">border</span>=<span style="color:#a50">&#34;1&#34;</span>&gt;
  &lt;<span style="color:#1e90ff;font-weight:bold">tr</span> <span style="color:#1e90ff">valign</span>=<span style="color:#a50">&#34;top&#34;</span>&gt;
    &lt;<span style="color:#1e90ff;font-weight:bold">td</span> <span style="color:#1e90ff">align</span>=<span style="color:#a50">&#34;left&#34;</span>&gt;Alesi&lt;/<span style="color:#1e90ff;font-weight:bold">td</span>&gt;
    &lt;<span style="color:#1e90ff;font-weight:bold">td</span> <span style="color:#1e90ff">align</span>=<span style="color:#a50">&#34;left&#34;</span>&gt;Canadian Grand Prix&lt;/<span style="color:#1e90ff;font-weight:bold">td</span>&gt;
    &lt;<span style="color:#1e90ff;font-weight:bold">td</span> <span style="color:#1e90ff">align</span>=<span style="color:#a50">&#34;right&#34;</span>&gt;1995&lt;/<span style="color:#1e90ff;font-weight:bold">td</span>&gt;
    &lt;<span style="color:#1e90ff;font-weight:bold">td</span> <span style="color:#1e90ff">align</span>=<span style="color:#a50">&#34;right&#34;</span>&gt;1&lt;/<span style="color:#1e90ff;font-weight:bold">td</span>&gt;
  &lt;/<span style="color:#1e90ff;font-weight:bold">tr</span>&gt;
&lt;/<span style="color:#1e90ff;font-weight:bold">table</span>&gt;</code></pre></div>
<p>It is also possible to set the connection parameters as environment
variables, or to use the same connection strings as in your application&rsquo;s
code, so you can test them with copy/paste easily, there&rsquo;s no need to
transform them into the <code>-d dbname -h hostname -p port -U username</code> syntax:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">~ psql -d postgresql://dim@localhost:5432/f1db
f1db# 

~ psql -d <span style="color:#a50">&#34;user=dim host=localhost port=5432 dbname=f1db&#34;</span>
f1db#</code></pre></div>
<p>The query in the <code>report.sql</code> file uses the <code>:'name'</code> variable syntax. Using
<code>:name</code> would be missing the quotes around the literal value injected, and
<code>:''</code> allows one to remedy this even with values containing spaces. <em>psql</em>
also supports <code>:&quot;variable&quot;</code> notation for double-quoting values, which is
used for dynamic SQL when identifiers are a parameter (column name or table
names).</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">  <span style="color:#00a">select</span> surname, races.name, races.<span style="color:#00a">year</span>, results.<span style="color:#00a">position</span>
    <span style="color:#00a">from</span> results
         <span style="color:#00a">join</span> drivers <span style="color:#00a">using</span>(driverid)
         <span style="color:#00a">join</span> races <span style="color:#00a">using</span>(raceid)
   <span style="color:#00a">where</span> drivers.surname = :<span style="color:#a50">&#39;name&#39;</span>
         <span style="color:#00a">and</span> <span style="color:#00a">position</span> <span style="color:#00a">between</span> <span style="color:#099">1</span> <span style="color:#00a">and</span> <span style="color:#099">3</span>
<span style="color:#00a">order</span> <span style="color:#00a">by</span> <span style="color:#00a">position</span>
   <span style="color:#00a">limit</span> :n;</code></pre></div>
<p>When running <em>psql</em> for reports, it might be good to have a specific setup.
In this example, you can see I&rsquo;ve been using the <code>--no-psqlrc</code> switch to be
sure we&rsquo;re not loading my usual interactive setup all with all the UTF-8
bells and whistles, and with <em>ON_ERROR_ROLLBACK</em>. Usually, you don&rsquo;t want to
have that set for a reporting or a batch script.</p>

<p>You might want to set <em>ON_ERROR_STOP</em> though, and maybe some other options.</p>

<h1 id="unicode-borders">Unicode Borders</h1>

<p>The <code>.psqlrc</code> file sets <em>linestyle</em> to <em>unicode</em> and some more parameters
related to the output style, so that we get the following output in our
console:</p>

<pre><code> surname │        name         │ year │ position 
═════════╪═════════════════════╪══════╪══════════
 Alesi   │ Canadian Grand Prix │ 1995 │        1
(1 row)
</code></pre>

<p>A useful trick when copy and pasting SQL result sets from the console to a
document, report, bug report or such is to limit the line length of the
results. You can achieve that with the following:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-psql" data-lang="psql">\pset format wrapped
\pset columns 70</code></pre></div>
<h1 id="discovering-a-schema">Discovering a Schema</h1>

<p>Let&rsquo;s get back to the interactive features of <em>psql</em>. The tool&rsquo;s main task
is to send SQL statements to the database server and display the result of
the query, and also server notifications and error messages. On top of that
<em>psql</em> provides a set of client-side commands all beginning with a
<em>backslash</em> character.</p>

<p>Most of the provided commands are useful for discovering a database schema.
All of them are implemented by doing one or several <em>catalog queries</em>
against the server. Again, it&rsquo;s sending a SQL statement to the server, and
it is possible for you to learn how to query the PostgreSQL catalogs by
reviewing those queries.</p>

<p>As an example, say you want to report the size of your databases but you
don&rsquo;t know where to look for that information. Reading the <a href="https://www.postgresql.org/docs/current/static/app-psql.html">psql
documentation</a>
you find that the <code>\l+</code> command can do that, and now you want to see the SQL
behind it:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-psql" data-lang="psql">~# \set ECHO_HIDDEN true
~# \l+
********* QUERY **********
SELECT d.datname as &#34;Name&#34;,
       pg_catalog.pg_get_userbyid(d.datdba) as &#34;Owner&#34;,
       pg_catalog.pg_encoding_to_char(d.encoding) as &#34;Encoding&#34;,
       d.datcollate as &#34;Collate&#34;,
       d.datctype as &#34;Ctype&#34;,
       pg_catalog.array_to_string(d.datacl, E&#39;\n&#39;) AS &#34;Access privileges&#34;,
       CASE WHEN pg_catalog.has_database_privilege(d.datname, &#39;CONNECT&#39;)
            THEN pg_catalog.pg_size_pretty(pg_catalog.pg_database_size(d.datname))
            ELSE &#39;No Access&#39;
       END as &#34;Size&#34;,
       t.spcname as &#34;Tablespace&#34;,
       pg_catalog.shobj_description(d.oid, &#39;pg_database&#39;) as &#34;Description&#34;
FROM pg_catalog.pg_database d
  JOIN pg_catalog.pg_tablespace t on d.dattablespace = t.oid
ORDER BY 1;
**************************

List of databases
...
~# \set ECHO_HIDDEN false</code></pre></div>
<p>So now if you only want to have the database name and its on-disk size in
bytes, it is as easy as running the following query:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">  <span style="color:#00a">SELECT</span> datname,
         pg_database_size(datname) <span style="color:#00a">as</span> bytes
    <span style="color:#00a">FROM</span> pg_database
<span style="color:#00a">ORDER</span> <span style="color:#00a">BY</span> bytes <span style="color:#00a">desc</span>;</code></pre></div>
<p>There&rsquo;s not much point in this book including the publicly available
documentation of all the commands available in <em>psql</em>, so go read the whole
manual page to find gems you didn&rsquo;t know about — there are plenty of them!</p>

<h1 id="interactive-query-editor">Interactive Query Editor</h1>

<p>You might have noticed that we did set the <em>EDITOR</em> environment variable
early in this section. This is the command used by <em>psql</em> each time you use
visual editing commands such as <code>\e</code>. This command launches your <em>EDITOR</em> on
the last edited query (or an empty one) in a temporary file, and will
execute the query once you end the editing session.</p>

<p>If you&rsquo;re using <em>emacs</em> or <em>vim</em> typing with a full-blown editor from within
a terminal, it is something you will be very happy to do. In other cases, it
is, of course, possible to set <em>EDITOR</em> to invoke your favorite IDE if your
<em>psql</em> client runs locally.</p>
              
            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small"></span><br/>
                    
  <a class="tag tag--primary tag--small" href="/tags/postgresql/">PostgreSQL</a>

  <a class="tag tag--primary tag--small" href="/tags/yesql/">YeSQL</a>

  <a class="tag tag--primary tag--small" href="/tags/psql/">psql</a>

  <a class="tag tag--primary tag--small" href="/tags/setup/">setup</a>

                  </div>
                
              
            
            <div class="post-actions-wrap">
  <div class="post-footer-tags">
    
    <script async id="_ck_252762" src="https://forms.convertkit.com/252762?v=6"></script>
    
  </div>
  <nav>
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="/blog/2017/12/submit-a-talk-to-pgday-paris-today/" data-tooltip="Submit a Talk to pgDay Paris Today!">
          
            <i class="fa fa-angle-left"></i>
            <span class="hide-xs hide-sm text-small icon-ml"></span>
          </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="/blog/2017/12/mastering-postgresql-a-readers-interview/" data-tooltip="Mastering PostgreSQL: a reader&#39;s interview">
          
            <span class="hide-xs hide-sm text-small icon-mr"></span>
            <i class="fa fa-angle-right"></i>
          </a>
        </li>
      
    </ul>
  </nav>
  <ul class="post-actions post-action-share">
    
      <li class="post-action hide-lg hide-md hide-sm">
        <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
          <i class="fa fa-share-alt"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https%3a%2f%2ftapoueh.org%2fblog%2f2017%2f12%2fsetting-up-psql-the-postgresql-cli%2f">
          <i class="fa fa-google-plus"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ftapoueh.org%2fblog%2f2017%2f12%2fsetting-up-psql-the-postgresql-cli%2f">
          <i class="fa fa-facebook-official"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Setting%20up%20psql%2c%20the%20PostgreSQL%20CLI with @tapoueh: https%3a%2f%2ftapoueh.org%2fblog%2f2017%2f12%2fsetting-up-psql-the-postgresql-cli%2f">
          <i class="fa fa-twitter"></i>
        </a>
      </li>
    
    
      <li class="post-action">
        <a class="post-action-btn btn btn--default" href="#disqus_thread">
          <i class="fa fa-comment-o"></i>
        </a>
      </li>
    
    <li class="post-action">
      
        <a class="post-action-btn btn btn--default" href="#table-of-contents">
      
        <i class="fa fa-list"></i>
      </a>
    </li>
  </ul>
</div>


            
              
                <div id="disqus_thread">
  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2018 Dimitri Fontaine. 
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
        <div class="post-actions-wrap">
  <div class="post-footer-tags">
    
    <script async id="_ck_252762" src="https://forms.convertkit.com/252762?v=6"></script>
    
  </div>
  <nav>
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="/blog/2017/12/submit-a-talk-to-pgday-paris-today/" data-tooltip="Submit a Talk to pgDay Paris Today!">
          
            <i class="fa fa-angle-left"></i>
            <span class="hide-xs hide-sm text-small icon-ml"></span>
          </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="/blog/2017/12/mastering-postgresql-a-readers-interview/" data-tooltip="Mastering PostgreSQL: a reader&#39;s interview">
          
            <span class="hide-xs hide-sm text-small icon-mr"></span>
            <i class="fa fa-angle-right"></i>
          </a>
        </li>
      
    </ul>
  </nav>
  <ul class="post-actions post-action-share">
    
      <li class="post-action hide-lg hide-md hide-sm">
        <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
          <i class="fa fa-share-alt"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https%3a%2f%2ftapoueh.org%2fblog%2f2017%2f12%2fsetting-up-psql-the-postgresql-cli%2f">
          <i class="fa fa-google-plus"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ftapoueh.org%2fblog%2f2017%2f12%2fsetting-up-psql-the-postgresql-cli%2f">
          <i class="fa fa-facebook-official"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Setting%20up%20psql%2c%20the%20PostgreSQL%20CLI with @tapoueh: https%3a%2f%2ftapoueh.org%2fblog%2f2017%2f12%2fsetting-up-psql-the-postgresql-cli%2f">
          <i class="fa fa-twitter"></i>
        </a>
      </li>
    
    
      <li class="post-action">
        <a class="post-action-btn btn btn--default" href="#disqus_thread">
          <i class="fa fa-comment-o"></i>
        </a>
      </li>
    
    <li class="post-action">
      
        <a class="post-action-btn btn btn--default" href="#table-of-contents">
      
        <i class="fa fa-list"></i>
      </a>
    </li>
  </ul>
</div>


      </div>
      <div id="share-options-bar" class="share-options-bar" data-behavior="5">
  <ul class="share-options">
    <li class="share-option">
      <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=https%3a%2f%2ftapoueh.org%2fblog%2f2017%2f12%2fsetting-up-psql-the-postgresql-cli%2f">
        <i class="fa fa-google-plus"></i><span></span>
      </a>
    </li>
    <li class="share-option">
      <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ftapoueh.org%2fblog%2f2017%2f12%2fsetting-up-psql-the-postgresql-cli%2f">
        <i class="fa fa-facebook-official"></i><span></span>
      </a>
    </li>
    <li class="share-option">
      <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=Setting%20up%20psql%2c%20the%20PostgreSQL%20CLI with @tapoueh: https%3a%2f%2ftapoueh.org%2fblog%2f2017%2f12%2fsetting-up-psql-the-postgresql-cli%2f">
        <i class="fa fa-twitter"></i><span></span>
      </a>
    </li>
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>

    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="//www.gravatar.com/avatar/7b615d104c506aa0a49e17151fa94d9f?s=110" alt="" />
    
    <h4 id="about-card-name">Dimitri Fontaine</h4>
    
      <div id="about-card-bio">PostgreSQL Major Contributor</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Open Source Software Engineer
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        France
      </div>
    
  </div>
</div>

    <div id="algolia-search-modal" class="modal-container">
  <div class="modal">
    <div class="modal-header">
      <span class="close-button"><i class="fa fa-close"></i></span>
      <a href="https://algolia.com" target="_blank" rel="noopener" class="searchby-algolia text-color-light link-unstyled">
        <span class="searchby-algolia-text text-color-light text-small">by</span>
        <img class="searchby-algolia-logo" src="https://www.algolia.com/static_assets/images/press/downloads/algolia-light.svg">
      </a>
      <i class="search-icon fa fa-search"></i>
      <form id="algolia-search-form">
        <input type="text" id="algolia-search-input" name="search"
          class="form-control input--large search-input" placeholder="" />
      </form>
    </div>
    <div class="modal-body">
      <div class="no-result text-color-light text-center"></div>
      <div class="results">
        
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://tapoueh.org/blog/2018/08/preventing-sql-injections/">
                <h3 class="media-heading">Preventing SQL Injections</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Aug 8, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>An <em>SQL Injection</em> is a security breach, one made famous by the <a href="https://xkcd.com/327/">Exploits of
a Mom</a> <code>xkcd</code> comic episode in which we read about
<em>little Bobby Tables</em>:</p>

<figure class="center"><a href="https://xkcd.com/327/">
    <img src="/img/exploits_of_a_mom.png"/> </a>
</figure>


<p>PostgreSQL implements a protocol level facility to send the static SQL query
text separately from its dynamic arguments. An SQL injection happens when
the database server is mistakenly led to consider a dynamic argument of a
query as part of the query text. Sending those parts as separate entities
over the protocol means that SQL injection is no longer possible.</p>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://tapoueh.org/blog/2018/08/geolocation-with-postgresql/">
                <h3 class="media-heading">Geolocation with PostgreSQL</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Aug 8, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>We have loaded Open Street Map points of interests in the article <a href="/blog/2013/08/the-most-popular-pub-names/">The Most
Popular Pub Names</a> — which
compares PostgreSQL with MongoDB for simple geographical queries, and is
part of our <a href="/tags/extensions/">PostgreSQL Extensions</a> article series. In
today&rsquo;s article, look at how to geolocalize an IP address and locate the
nearest pub, all within a single SQL query!</p>

<p>For that, we are going to use the awesome
<a href="https://github.com/RhodiumToad/ip4r">ip4r</a> extension from
<a href="http://blog.rhodiumtoad.org.uk/">RhodiumToad</a>.</p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://tapoueh.org/blog/2018/08/postgresql-concurrency-an-article-series/">
                <h3 class="media-heading">PostgreSQL Concurrency: an Article Series</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Aug 8, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p><a href="https://www.postgresql.org">PostgreSQL</a> is a relational database management
system. It&rsquo;s even the world&rsquo;s most advanced open source one of them. As
such, as its core, Postgres solves concurrent access to a set of data and
maintains consistency while allowing concurrent operations.</p>

<p>In the <a href="/tags/concurrency/">PostgreSQL Concurrency</a> series of articles here
we did see several aspects of how to handle concurrent use cases of your
application design with PostgreSQL. The main thing to remember is that a
Database Management System first task is to handle concurrency access to the
data for you.</p>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://tapoueh.org/blog/2018/08/scheduled-data-processing-how-to-use-cron/">
                <h3 class="media-heading">Scheduled Data Processing: How to use cron?</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Aug 8, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>A previous article in the <a href="/tags/concurrency">PostgreSQL Concurrency</a> series
covered how to manage concurrent retweets in an efficient way: in <a href="/blog/2018/07/computing-and-caching/">Computing
and Caching</a>, we learnt how to
maintain a cache right in your PostgreSQL database, using MATERIALIZED
VIEWS. We also had a look at how to take care of <a href="/blog/2018/07/batch-updates-and-concurrency/">Batch Updates and
Concurrency</a>.</p>

<p>While in the first case we are providing a solution to a technical problem
where we want to solve performance issues while keeping the same semantics,
in the second case we are actually implementing a part of the application&rsquo;s
<a href="/blog/2017/06/sql-and-business-logic/">Business Logic</a> as a scheduled job.</p>

<p>Today&rsquo;s article shows a modern technique to handle the scheduling of those
business oriented activities that are not tied to any user activity. When
thinking about it this way, you certainly don&rsquo;t want to implement the
backbone of your business logic in a <em>shell script</em> that&rsquo;s directly
maintained in the production environment, do you?</p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://tapoueh.org/blog/2018/07/batch-updates-and-concurrency/">
                <h3 class="media-heading">Batch Updates and Concurrency</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jul 7, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>This article fits in the <a href="/tags/concurrency">PostgreSQL Concurrency</a> series,
where we installed a tweeter like application schema and had all the
characters from Shakespeare&rsquo;s <em>A Midsummer Night&rsquo;s Dream</em> tweet their own
lines in our database in <a href="/blog/2018/06/PostgreSQL-DML.md">PostgreSQL Concurrency: Data Modification
Language</a>.</p>

<p>A previous article in the series covered how to manage concurrent retweets
in an efficient way: <a href="/blog/2018/07/computing-and-caching/">Computing and
Caching</a>, where we learn how to
maintain a cache right in your PostgreSQL database, thanks for materialized
views. We even went as far as maintaining an <em>external</em> cache in another
application layer using PostgreSQL
<a href="https://www.postgresql.org/docs/current/static/sql-listen.html">LISTEN</a> and
<a href="https://www.postgresql.org/docs/current/static/sql-notify.html">NOTIFY</a>
features and a Golang application.</p>

<p>Today&rsquo;s article is going to address concurrency in the context of updating
data in a batch. This activity is quite common, as soon as your system is
connected to other systems either internally or with external providers.
While it&rsquo;s pretty easy to ingest new data, and easy enough to update data
from an external source when nothing happens in your database, doing the
operation safely with concurrent activity is more complex. Once more though,
PostgreSQL comes with all the tooling you need to handle that situation.</p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://tapoueh.org/blog/2018/07/postgresql-listen-notify/">
                <h3 class="media-heading">PostgreSQL LISTEN/NOTIFY</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jul 7, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>This article fits in the <a href="/tags/concurrency">PostgreSQL Concurrency</a> series,
where we installed a tweeter like application schema and had all the
characters from Shakespeare&rsquo;s <em>A Midsummer Night&rsquo;s Dream</em> tweet their own
lines in our database in <a href="/blog/2018/06/PostgreSQL-DML.md">PostgreSQL Concurrency: Data Modification
Language</a>.</p>

<p>A previous article in the series covered how to manage concurrent retweets
in an efficient way: <a href="/blog/2018/07/computing-and-caching/">Computing and
Caching</a>, where we learn how to
maintain a cache right in your PostgreSQL database, thanks for materialized
views.</p>

<p>Today&rsquo;s article shows how to maintain an <em>external</em> cache in another
application layer. In this article we are going to maintain an in-memory
cache in a Golang service, using PostgreSQL
<a href="https://www.postgresql.org/docs/current/static/sql-listen.html">LISTEN</a> and
<a href="https://www.postgresql.org/docs/current/static/sql-notify.html">NOTIFY</a>
features.</p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://tapoueh.org/blog/2018/07/postgresql-event-based-processing/">
                <h3 class="media-heading">PostgreSQL Event Based Processing</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jul 7, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>In the previous article of the series <a href="/blog/2018/07/modeling-for-concurrency/">Modeling for
Concurrency</a>, we saw how to model
your application for highly concurrent activity. It was a follow-up to the
article entitled <a href="/blog/2018/07/postgresql-concurrency-isolation-and-locking/">PostgreSQL Concurrency: Isolation and
Locking</a>, which
was a primer on PostgreSQL isolation and locking properties and behaviors.</p>

<p>Today&rsquo;s article takes us a step further and builds on what we did in the
previous articles in our series. After having had all the characters from
Shakespeare&rsquo;s <em>A Midsummer Night&rsquo;s Dream</em> tweet their own lines in our
database in <a href="/blog/2018/06/PostgreSQL-DML.md">PostgreSQL Concurrency: Data Modification
Language</a>, and having had them like and
retweet a lot in <a href="/blog/2018/07/postgresql-concurrency-isolation-and-locking/">PostgreSQL Concurrency: Isolation and
Locking</a>, we
saw how to manage concurrent retweets in an efficient way in <a href="/blog/2018/07/computing-and-caching/">Computing and
Caching</a>.</p>

<p>What we did implement in the previous article is a <em>cache</em> system, all with
its necessary <strong>cache invalidation policy</strong>. Sometimes though, the
processing of an <em>event</em> needs to happen within the same transaction where
the event is registered in your system. PostgreSQL makes it possible to
maintain a summary table transactionally thanks to its
<a href="https://www.postgresql.org/docs/current/static/sql-createtrigger.html">trigger</a>
support. Today, we&rsquo;re going to dive in how to maintain a summary table with
triggers, and its impact on concurrency.</p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://tapoueh.org/blog/2018/07/computing-and-caching/">
                <h3 class="media-heading">Computing and Caching</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jul 7, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>Let&rsquo;s continue to dive in PostgreSQL Concurrency. In the previous article of
the series, <a href="/blog/2018/07/modeling-for-concurrency/">Modeling for
Concurrency</a>, we saw how to model
your application for highly concurrent activity. It was a follow-up to the
article entitled <a href="/blog/2018/07/postgresql-concurrency-isolation-and-locking/">PostgreSQL Concurrency: Isolation and
Locking</a>, which
was a primer on PostgreSQL isolation and locking properties and behaviors.</p>

<p>Today&rsquo;s article takes us a step further and builds on what we did in the
previous articles in our series. After having had all the characters from
Shakespeare&rsquo;s <em>A Midsummer Night&rsquo;s Dream</em> tweet their own lines in our
database in <a href="/blog/2018/06/PostgreSQL-DML.md">PostgreSQL Concurrency: Data Modification
Language</a>, and having had them like a
retweet a lot in <a href="/blog/2018/07/postgresql-concurrency-isolation-and-locking/">PostgreSQL Concurrency: Isolation and
Locking</a>, it&rsquo;s
time to think about how to display our counters in an efficient way.</p>

<p>In this article, we&rsquo;re going to think about when we should compute results
and when we should cache them for instant retrieval, all within the SQL
tooling. The SQL tooling for handling cache is a <a href="https://www.postgresql.org/docs/current/static/sql-creatematerializedview.html">MATERIALIZED
VIEW</a>,
and it comes with <strong>cache invalidation</strong> routines, of course.</p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://tapoueh.org/blog/2018/07/modeling-for-concurrency/">
                <h3 class="media-heading">Modeling for Concurrency</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jul 7, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>Let&rsquo;s continue to dive in PostgreSQL Concurrency. Last week&rsquo;s article
<a href="/blog/2018/07/postgresql-concurrency-isolation-and-locking/">PostgreSQL Concurrency: Isolation and
Locking</a> was a
primer on PostgreSQL isolation and locking properties and behaviors.</p>

<p>Today&rsquo;s article takes us a step further and builds on what we did last week,
in particular the database modeling for a <em>tweet</em> like application. After
having had all the characters from Shakespeare&rsquo;s <em>A Midsummer Night&rsquo;s Dream</em>
tweet their own lines in our database in <a href="/blog/2018/06/PostgreSQL-DML.md">PostgreSQL Concurrency: Data
Modification Language</a>, it&rsquo;s time for them
to do some actions on the tweets: likes and retweet.</p>

<p>Of course, we&rsquo;re going to put concurrency to the test, so we&rsquo;re going to
have to handle very very popular tweets from the play!</p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://tapoueh.org/blog/2018/07/postgresql-concurrency-isolation-and-locking/">
                <h3 class="media-heading">PostgreSQL Concurrency: Isolation and Locking</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jul 7, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p><a href="https://www.postgresql.org">PostgreSQL</a> is a relational database management
system. It&rsquo;s even the world&rsquo;s most advanced open source one of them. As
such, as its core, Postgres solves concurrent access to a set of data and
maintains consistency while allowing concurrent operations.</p>

<p>This article is a primer on PostgreSQL Isolation and Locking properties and
behaviors. You might be interested into the previous article in the series:
<a href="/blog/2018/06/postgresql-concurrency-data-modification-language/">PostgreSQL Concurrency: Data Modification
Language</a>.</p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
      </div>
    </div>
    <div class="modal-footer">
      <p class="results-count text-medium"
         data-message-zero=""
         data-message-one=""
         data-message-other="">
         283 posts found
      </p>
    </div>
  </div>
</div>
    
  
    
    <div id="cover" style="background-image:url('https://tapoueh.org/images/mayan-calendar.jpg');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.7/js/jquery.fancybox.min.js" integrity="sha256-GEAnjcTqVP+vBp3SSc8bEDQqvWAZMiHyUSIorrWwH50=" crossorigin="anonymous"></script>


<script src="/js/script-qi9wbxp2ya2j6p7wx1i6tgavftewndznf4v0hy2gvivk1rxgc3lm7njqb6bz.min.js"></script>



<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight > code, pre > code').each(function(i, block) {
    if (!$(this).hasClass('codeblock')) {
      $(this).addClass('codeblock');
    }
    hljs.highlightBlock(block);
  });
});
</script>


  
    
      <script>
        var disqus_config = function () {
          this.page.url = 'https:\/\/tapoueh.org\/blog\/2017\/12\/setting-up-psql-the-postgresql-cli\/';
          
            this.page.identifier = '\/blog\/2017\/12\/setting-up-psql-the-postgresql-cli\/'
          
        };
        (function() {
          
          
          if (window.location.hostname == "localhost") {
            return;
          }
          var d = document, s = d.createElement('script');
          var disqus_shortname = 'tapoueh';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    
  



    
  </body>
</html>

