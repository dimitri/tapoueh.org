

  
    
  


  




  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Hugo 0.20.7">
    <meta name="theme" content="Tranquilpeak 0.3.1-BETA">
    <title>Aggregating NBA data, PostgreSQL vs MongoDB</title>
    <meta name="author" content="Dimitri Fontaine">
    <meta name="keywords" content="">

    <link rel="icon" href="/favicon.ico">
    

    
    <meta name="description" content="When reading the article
Crunching 30 Years of NBA Data with MongoDB Aggregation I coulnd&rsquo;t help but
think that we&rsquo;ve been enjoying
aggregates in SQL for 3 or 4 decades already.
When using
PostgreSQL it&rsquo;s even easy to actually add your own aggregates
given the SQL command
create aggregate.

">
    <meta property="og:description" content="When reading the article
Crunching 30 Years of NBA Data with MongoDB Aggregation I coulnd&rsquo;t help but
think that we&rsquo;ve been enjoying
aggregates in SQL for 3 or 4 decades already.
When using
PostgreSQL it&rsquo;s even easy to actually add your own aggregates
given the SQL command
create aggregate.

">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Aggregating NBA data, PostgreSQL vs MongoDB">
    <meta property="og:url" content="/blog/2014/02/aggregating-nba-data-postgresql-vs-mongodb/">
    <meta property="og:site_name" content="Dimitri Fontaine, PostgreSQL Expert">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Dimitri Fontaine, PostgreSQL Expert">
    <meta name="twitter:description" content="When reading the article
Crunching 30 Years of NBA Data with MongoDB Aggregation I coulnd&rsquo;t help but
think that we&rsquo;ve been enjoying
aggregates in SQL for 3 or 4 decades already.
When using
PostgreSQL it&rsquo;s even easy to actually add your own aggregates
given the SQL command
create aggregate.

">
    
      <meta name="twitter:creator" content="@tapoueh">
    
    

    
    

    
      <meta property="og:image" content="//www.gravatar.com/avatar/7b615d104c506aa0a49e17151fa94d9f?s=640">
    

    
      <meta property="og:image" content="http://tapoueh.org/img/old/postgresql-mongodb.jpg">
    
    
      <meta property="og:image" content="http://tapoueh.org/img/old/postgresql-mongodb.jpg">
    
    

    

    
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.css" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" />
    
    
    <link rel="stylesheet" href="/css/style-u6mk0ojoywresbx8iepslrmmhl4stuhrsxuwhkpwrkrx7mryjcaimasnk4pi.min.css" />
    
    
      <link rel="stylesheet" href="http://tapoueh.org//css/dim.css">
    

    
      
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-47059482-1', 'auto');
ga('send', 'pageview');
</script>

    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="2">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="/">Dimitri Fontaine, PostgreSQL Expert</a>
  </div>
  
</header>

      <nav id="sidebar" data-behavior="2">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="/#about">
          <img class="sidebar-profile-picture" src="//www.gravatar.com/avatar/7b615d104c506aa0a49e17151fa94d9f?s=110" alt="" />
        </a>
        <h4 class="sidebar-profile-name">Dimitri Fontaine</h4>
        
          <h5 class="sidebar-profile-bio">PostgreSQL Major Contributor</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/">
    
      <i class="sidebar-button-icon fa fa-lg fa-pagelines"></i>
      
      <span class="sidebar-button-desc">Blog</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/about/">
    
      <i class="sidebar-button-icon fa fa-lg fa-beer"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="http://masteringpostgresql.com" target="_blank">
    
      <i class="sidebar-button-icon fa fa-lg fa-book"></i>
      
      <span class="sidebar-button-desc">Mastering PostgreSQL</span>
    </a>
  </li>

    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/dimitri" target="_blank">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://twitter.com/tapoueh" target="_blank">
    
      <i class="sidebar-button-icon fa fa-lg fa-twitter"></i>
      
      <span class="sidebar-button-desc">Twitter</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/categories">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>

    </ul>
  </div>
</nav>

      
  <div class="post-header-cover
              text-left
              post-header-cover--partial"
       style="background-image:url('/img/old/postgresql-mongodb.jpg')"
       data-behavior="2">
    
      <div class="post-header main-content-wrap text-left">
  
    <h1 class="post-title" itemprop="headline">
      Aggregating NBA data, PostgreSQL vs MongoDB
    </h1>
  
  <div class="postShorten-meta post-meta">
  
    <time itemprop="datePublished" datetime="2014-02-17T23:40:00&#43;01:00">
      
  
  
  
  
    Monday 17 Feb 2014
  

    </time>
  
  
  
  
    <span></span>
    
      <a class="category-link" href="/categories/postgresql">PostgreSQL</a>, 
    
      <a class="category-link" href="/categories/yesql">YeSQL</a>
    
  


</div>

</div>
    
  </div>


      <div id="main" data-behavior="2"
        class="hasCover
               hasCoverMetaIn
               ">
        <article class="post" itemscope itemType="http://schema.org/BlogPosting">
          
          
          <div class="post-content markdown" itemprop="articleBody">
            <div class="main-content-wrap">
              <p>When reading the article
<a href="http://thecodebarbarian.wordpress.com/2014/02/14/crunching-30-years-of-nba-data-with-mongodb-aggregation/">Crunching 30 Years of NBA Data with MongoDB Aggregation</a> I coulnd&rsquo;t help but
think that we&rsquo;ve been enjoying
<a href="http://www.postgresql.org/docs/current/static/tutorial-agg.html">aggregates</a> in SQL for 3 or 4 decades already.
When using
<a href="http://www.postgresql.org/">PostgreSQL</a> it&rsquo;s even easy to actually add your own aggregates
given the SQL command
<a href="http://www.postgresql.org/docs/current/static/sql-createaggregate.html">create aggregate</a>.</p>

<p></p>

<p><center><em>Photo Credit: <a href="https://www.flickr.com/photos/57426425@N07/6005436411/sizes/z/">Copyright All rights reserved by Segward Graupner</a></em></center></p>

<p>The next step after thinking how obvious the queries written in the
mentionned article would be to express in SQL was to actually load the data
into PostgreSQL and write the aggregate queries, of course.</p>

<h1 id="table-of-contents"></h1><nav id="TableOfContents">
<ul>
<li><a href="#loading-the-data">Loading the data</a></li>
<li><a href="#running-the-aggregates">Running the Aggregates</a></li>
<li><a href="#correlating-stats-with-wins">Correlating stats with wins</a></li>
<li><a href="#defensive-rebounds-and-total-rebounds-versus-win-percentage">Defensive Rebounds and Total Rebounds Versus Win Percentage</a></li>
<li><a href="#interesting-factoid">Interesting factoid</a></li>
<li><a href="#total-rebounds-and-wins">Total rebounds and wins</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
</nav>

<h1 id="loading-the-data">Loading the data</h1>

<p>With the help of a little bit of
<em>Common Lisp</em> code and using the
<a href="https://github.com/archimag/mongo-cl-driver">mongo-cl-driver</a> it was easy enough to parse the given
<a href="http://bsonspec.org/">BSON</a> file. What was
more complex was to actually understand enough of the data model to produce
a relational design out of it, avoiding data redundancy as much as possible.</p>

<p>We call that step
<em>normalization</em> in old-style relational databases, and the
goal of that process is to avoid
<em>functional dependency</em> so that the data is
easier to understand, verify and process the data once loaded.</p>

<p>For instance, rather than have both scores from each team and a column
<code>won</code>
per team, which would be a boolean but is a number in the given
<em>BSON</em> file,
we store only the scores. Here&rsquo;s the main table definition of the stats we
are going to be playing with, the
<code>game</code> table:</p>

<pre><code class="language-sql">create table nba.game (
  id          serial primary key,
  date        timestamptz,
  host        int references nba.team(id),
  guest       int references nba.team(id),
  host_score  int,
  guest_score int
);
</code></pre>

<p>As much of the aggregates in the referenced article are playing with
statistics from teams who actually
<em>won</em> the game, let&rsquo;s create a view to
simplify our SQL queries thereafter:</p>

<pre><code class="language-sql">create view winners as
  select id,
         date,
         case when host_score &gt; guest_score
              then host
              else guest
          end as winner
    from game;
</code></pre>

<p>If you&rsquo;re not doing much SQL, remember that creating such a view is common
practice in the relational world.</p>

<h1 id="running-the-aggregates">Running the Aggregates</h1>

<p>Now that we have the extra useful view, it&rsquo;s possible to implement the first
<a href="http://www.mongodb.org/">MongoDB</a> query in SQL. First, let&rsquo;s have a look at the MongoDB query:</p>

<pre><code class="language-js">db.games.aggregate([
  {
    $match : {
      date : {
        $gt : ISODate(&quot;1999-08-01T00:00:00Z&quot;),
        $lt : ISODate(&quot;2000-08-01T00:00:00Z&quot;)
      }
    }
  },
  {
    $unwind : '$teams'
  },
  {
    $match : {
      'teams.won' : 1
    }
  },
  {
    $group : {
      _id : '$teams.name',
      wins : { $sum : 1 }
    }
  },
  {
    $sort : { wins : -1 }
  },
  {
    $limit : 5
  }
]);
</code></pre>

<p>I don&rsquo;t know about you, but I have quite a hard time deciphering what that
query is actually doing, and when the explanation text talks about
<em>using a
6-stage pipeline</em> my understanding is that the application developper has
been writing the
<em>execution plan</em> of the query here. Let&rsquo;s ignore the query
format itself, as it&rsquo;s obviously meant to be generated by a tool rather than
typed by a human being.</p>

<p>Here&rsquo;s the same query in SQL, with the result this time:</p>

<pre><code class="language-sql">  SELECT abbrev, name, count(*)
    FROM winners JOIN team ON team.id = winners.winner
   WHERE     date &gt; '1999-08-01T00:00:00Z'
         AND date &lt; '2000-08-01T00:00:00Z'
GROUP BY winner, abbrev, name
ORDER BY count(*) DESC
   LIMIT 5;

 abbrev |          name          | count 
--------+------------------------+-------
 LAL    | Los Angeles Lakers     |    67
 POR    | Portland Trail Blazers |    59
 IND    | Indiana Pacers         |    56
 UTA    | Utah Jazz              |    55
 SAS    | San Antonio Spurs      |    53
(5 rows)

Time: 8.101 ms
</code></pre>

<p>What we have here is a pretty basic query using a
<em>join</em>, a
<em>where</em> clause to
restrict the data set we are playing with, a
<em>group by</em> clause to define which
data to compute the aggregates against, with an
<em>order by</em> and a
<em>limit</em> clause
for presenting the result. To be realistic, if you&rsquo;ve ever done any SQL at
all, then you know how to read that query because you&rsquo;ve been writing dozens
of similar ones.</p>

<p>Here&rsquo;s, as in the original article, the same query against a much larger
data set this time, with all games of the 2000s decade:</p>

<pre><code class="language-sql">   SELECT abbrev, name, count(*)
     FROM winners join team on team.id = winners.winner
    WHERE     date &gt; '2000-08-01T00:00:00Z'
          AND date &lt; '2010-08-01T00:00:00Z'
 GROUP BY winner, abbrev, name
 ORDER BY count(*) DESC
    LIMIT 5;

 abbrev |        name        | count 
--------+--------------------+-------
 SAS    | San Antonio Spurs  |   579
 DAL    | Dallas Mavericks   |   568
 LAL    | Los Angeles Lakers |   524
 PHO    | Phoenix Suns       |   495
 DET    | Detroit Pistons    |   489
(5 rows)

Time: 24.713 ms
</code></pre>

<h1 id="correlating-stats-with-wins">Correlating stats with wins</h1>

<p>The goal here is to compute how often a team wins when they record more
defensive rebounds than their opponent across the entire data set.</p>

<p>To be able to compute the percentage, we have to have a count of all
registered games, of course. Then we are going to count how many times the
winner team registered a greater
<em>team_stats.drb</em> than the loser, and
<em>count
how many times</em> in SQL is usually written as a
<code>sum(case when &lt;condition&gt; then
1 else 0 end)</code>, which is what we&rsquo;re doing here:</p>

<pre><code class="language-sql">select count(*) as games,
       sum(case when ws.drb &gt; ls.drb then 1 else 0 end) as drb,
       sum(case when ws.drb &gt; ls.drb then 1 else 0 end)::float / count(*) * 100 as pct
  from winlose wl
       join team w on wl.winner = w.id
       join team l on wl.loser = l.id
       join team_stats ws on ws.game = wl.id and ws.team = wl.winner
       join team_stats ls on ls.game = wl.id and ls.team = wl.loser;

 games |  drb  |       pct        
-------+-------+------------------
 31686 | 22292 | 70.3528372151739
(1 row)

Time: 276.669 ms
</code></pre>

<p>We note here than in the original MongoDB article the aggregation query is
short of computing the
<em>percentage</em> directly, apparently it&rsquo;s been done in the
client tool, maybe using a
<em>spreadsheet</em> application or something.</p>

<h1 id="defensive-rebounds-and-total-rebounds-versus-win-percentage">Defensive Rebounds and Total Rebounds Versus Win Percentage</h1>




<div class="figure fig25 right dim-margin" >
  
    <img class="fig-img" src="/img/old/DReboundsVandy.320.png" >
  
  
</div>


<p>Next, still following on our inspirational article
<a href="http://thecodebarbarian.wordpress.com/2014/02/14/crunching-30-years-of-nba-data-with-mongodb-aggregation/">Crunching 30 Years of NBA Data with MongoDB Aggregation</a>, we’re going to
compute what percentage of the time a team wins as a function of the number
of defensive rebounds they recorded.</p>

<p>I&rsquo;m not sure I understand what they achieve with averaging ones when a team
wins and zero when a team loses, so I couldn&rsquo;t quite reproduce their result.
Here&rsquo;s an approaching query tho:</p>

<pre><code class="language-sql">with game_stats as (
    select t.id, count(*)
      from team t join game on game.host = t.id or game.guest = t.id
   group by t.id
)
select ts.team, round(avg(drb), 2) as drb,
       round(count(*) / gs.count::numeric * 100, 2) as winpct,
       count(*) as wins, gs.count as games
  from team_stats ts
       join game on game.id = ts.game
                and game.host = ts.team
                and game.host_score &gt; game.guest_score
       join game_stats gs on gs.id = ts.team
group by ts.team, gs.count;

 team |  drb  | winpct | wins | games 
------+-------+--------+------+-------
    4 | 31.59 |  31.46 |  710 |  2257
    7 | 32.55 |  31.89 |  720 |  2258
   16 | 31.70 |  37.62 |  849 |  2257
</code></pre>

<p>I only pasted the first few lines of the result because I&rsquo;m not sure how to
make sense of it, really.</p>

<h1 id="interesting-factoid">Interesting factoid</h1>

<p>What I find most interesting in the following
<em>factoid</em> proposed in the
MongoDB article is the complete lack of the query you need to run in order
to grab the matching data:</p>

<blockquote>
<p>An interesting factoid: the team that recorded the fewest defensive rebounds
in a win was the 1995-96 Toronto Raptors, who beat the Milwaukee Bucks 93-87
on 12/26/1995 despite recording only 14 defensive rebounds.</p>
</blockquote>

<p>When doing the necessary query in SQL, using a
<a href="http://www.postgresql.org/docs/current/static/queries-with.html">Common Table Expression</a> (the
<code>WITH</code> syntax) and a
<a href="http://www.postgresql.org/docs/9.3/static/tutorial-window.html">Window Function</a> for good measure, we get actually 4
different games with the minimum defensive rebounds in our history of NBA
games, 14:</p>

<pre><code class="language-sql">with stats(game, team, drb, min) as (
    select ts.game, ts.team, drb, min(drb) over ()
      from team_stats ts
           join winners w on w.id = ts.game and w.winner = ts.team
)
select game.date::date,
       host.name || ' -- ' || host_score as host,
       guest.name || ' -- ' || guest_score as guest,
       stats.drb as winner_drb
  from stats
       join game on game.id = stats.game
       join team host on host.id = game.host
       join team guest on guest.id = game.guest
 where drb = min;

-[ RECORD 1 ]----------------------------
date       | 1995-12-26
host       | Toronto Raptors -- 93
guest      | Milwaukee Bucks -- 87
winner_drb | 14
-[ RECORD 2 ]----------------------------
date       | 1996-02-02
host       | Golden State Warriors -- 114
guest      | Toronto Raptors -- 111
winner_drb | 14
-[ RECORD 3 ]----------------------------
date       | 1998-03-31
host       | Vancouver Grizzlies -- 101
guest      | Dallas Mavericks -- 104
winner_drb | 14
-[ RECORD 4 ]----------------------------
date       | 2009-01-14
host       | New York Knicks -- 128
guest      | Washington Wizards -- 122
winner_drb | 14

Time: 126.276 ms
</code></pre>

<p>To understand all there&rsquo;s to know about
<em>window functions</em>, have a look at my
article on the topic:
<a href="/blog/2013/08/20-Window-Functions">Understanding Window Functions</a>.</p>

<h1 id="total-rebounds-and-wins">Total rebounds and wins</h1>

<p>The next interesting aside is the following:</p>

<blockquote>
<p>As an aside, the Cleveland Cavaliers beat the New York Knicks 101-97 on
April 11, 1996, despite recording only 21 total rebounds. Inversely, the San
Antonio Spurs lost to the Houston Rockets, 112-110, on January 4, 1992
despite recording 75 total rebounds.</p>
</blockquote>

<p>Which we translate in SQL as the following query:</p>

<pre><code class="language-sql">with stats as (
    select ts.game, ts.team, trb,
           min(trb) over () as min,
           max(trb) over () as max
      from team_stats ts
           join winners w on w.id = ts.game and w.winner = ts.team
)
select game.date::date,
       host.name || ' -- ' || host_score as host,
       guest.name || ' -- ' || guest_score as guest,
       stats.trb as winner_trb
  from stats
       join game on game.id = stats.game
       join team host on host.id = game.host
       join team guest on guest.id = game.guest
 where trb = min or trb = max;

-[ RECORD 1 ]--------------------------
date       | 1995-12-28
host       | Dallas Mavericks -- 103
guest      | Vancouver Grizzlies -- 101
winner_trb | 76
-[ RECORD 2 ]--------------------------
date       | 1996-04-11
host       | New York Knicks -- 97
guest      | Cleveland Cavaliers -- 101
winner_trb | 21
-[ RECORD 3 ]--------------------------
date       | 2007-01-29
host       | Utah Jazz -- 115
guest      | New Jersey Nets -- 116
winner_trb | 21

Time: 127.771 ms
</code></pre>

<p>Again it&rsquo;s easy enough in SQL to have more details about the
<em>aside</em> presented
in our source article, and we get a slightly different story.</p>

<h1 id="conclusion">Conclusion</h1>

<p>It&rsquo;s quite hard for me to appreciate the work done in the
<em>MongoDB
aggregation framework</em> really, when we&rsquo;ve been enjoying advanced aggregation
and statistics in
<a href="http://www.postgresql.org/">PostgreSQL</a> for a very long time. With the addition of
<a href="http://www.postgresql.org/docs/9.3/static/tutorial-window.html">Window Functions</a> and
<a href="http://www.postgresql.org/docs/9.3/static/functions-aggregate.html#FUNCTIONS-AGGREGATE-STATISTICS-TABLE">Aggregate Functions for Statistics</a> it&rsquo;s possible to
implement advanced analysis right into your SQL queries.</p>




<div class="figure fig25 right dim-margin" >
  
    <img class="fig-img" src="/img/old/sql-logo.png"  alt="PostgreSQL is YeSQL">
  
   
    <span class="caption">PostgreSQL is YeSQL</span>
  
</div>


<p>In next PostgreSQL release the set of analytical functions is going to
expand again with the addition of both
<a href="http://www.postgresql.org/docs/devel/static/functions-aggregate.html#FUNCTIONS-ORDEREDSET-TABLE">Ordered-Set Aggregate Functions</a> (also
known as
<em>inverse distribution</em> functions) and
<a href="http://www.postgresql.org/docs/devel/static/functions-aggregate.html#FUNCTIONS-HYPOTHETICAL-TABLE">Hypothetical-Set Aggregate Functions</a> (also known as
<code>WITHIN GROUP</code>).</p>

<p>When the problem you have to solve involves analyzing data, one of the more
advanced tooling you can find around certainly is the SQL language, in
particular its implementation in PostgreSQL!</p>
              
            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small"></span><br/>
                    
  <a class="tag tag--primary tag--small" href="http://tapoueh.org//tags/postgresql/">PostgreSQL</a>

  <a class="tag tag--primary tag--small" href="http://tapoueh.org//tags/mongodb/">MongoDB</a>

  <a class="tag tag--primary tag--small" href="http://tapoueh.org//tags/yesql/">YeSQL</a>

                  </div>
                
              
            
            <div class="post-actions-wrap">
  <div class="post-footer-tags">
    <script async id="_ck_218061" src="https://forms.convertkit.com/218061?v=6"></script>
  </div>
  <nav>
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="/blog/2014/02/postgresql-aggregates-and-histograms/" data-tooltip="PostgreSQL, Aggregates and Histograms">
          
            <i class="fa fa-angle-left"></i>
            <span class="hide-xs hide-sm text-small icon-ml"></span>
          </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="/blog/2014/02/postgresql-fosdem-conference/" data-tooltip="PostgreSQL FOSDEM Conference">
          
            <span class="hide-xs hide-sm text-small icon-mr"></span>
            <i class="fa fa-angle-right"></i>
          </a>
        </li>
      
    </ul>
  </nav>
  <ul class="post-actions post-action-share">
    
      <li class="post-action hide-lg hide-md hide-sm">
        <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
          <i class="fa fa-share-alt"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=http%3a%2f%2ftapoueh.org%2fblog%2f2014%2f02%2faggregating-nba-data-postgresql-vs-mongodb%2f">
          <i class="fa fa-google-plus"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2ftapoueh.org%2fblog%2f2014%2f02%2faggregating-nba-data-postgresql-vs-mongodb%2f">
          <i class="fa fa-facebook-official"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Aggregating%20NBA%20data%2c%20PostgreSQL%20vs%20MongoDB with @tapoueh: http%3a%2f%2ftapoueh.org%2fblog%2f2014%2f02%2faggregating-nba-data-postgresql-vs-mongodb%2f">
          <i class="fa fa-twitter"></i>
        </a>
      </li>
    
    
      <li class="post-action">
        <a class="post-action-btn btn btn--default" href="#disqus_thread">
          <i class="fa fa-comment-o"></i>
        </a>
      </li>
    
    <li class="post-action">
      
        <a class="post-action-btn btn btn--default" href="#table-of-contents">
      
        <i class="fa fa-list"></i>
      </a>
    </li>
  </ul>
</div>


            
              
                <div id="disqus_thread">
  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2017 Dimitri Fontaine. 
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="2">
        <div class="post-actions-wrap">
  <div class="post-footer-tags">
    <script async id="_ck_218061" src="https://forms.convertkit.com/218061?v=6"></script>
  </div>
  <nav>
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="/blog/2014/02/postgresql-aggregates-and-histograms/" data-tooltip="PostgreSQL, Aggregates and Histograms">
          
            <i class="fa fa-angle-left"></i>
            <span class="hide-xs hide-sm text-small icon-ml"></span>
          </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="/blog/2014/02/postgresql-fosdem-conference/" data-tooltip="PostgreSQL FOSDEM Conference">
          
            <span class="hide-xs hide-sm text-small icon-mr"></span>
            <i class="fa fa-angle-right"></i>
          </a>
        </li>
      
    </ul>
  </nav>
  <ul class="post-actions post-action-share">
    
      <li class="post-action hide-lg hide-md hide-sm">
        <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
          <i class="fa fa-share-alt"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=http%3a%2f%2ftapoueh.org%2fblog%2f2014%2f02%2faggregating-nba-data-postgresql-vs-mongodb%2f">
          <i class="fa fa-google-plus"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2ftapoueh.org%2fblog%2f2014%2f02%2faggregating-nba-data-postgresql-vs-mongodb%2f">
          <i class="fa fa-facebook-official"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Aggregating%20NBA%20data%2c%20PostgreSQL%20vs%20MongoDB with @tapoueh: http%3a%2f%2ftapoueh.org%2fblog%2f2014%2f02%2faggregating-nba-data-postgresql-vs-mongodb%2f">
          <i class="fa fa-twitter"></i>
        </a>
      </li>
    
    
      <li class="post-action">
        <a class="post-action-btn btn btn--default" href="#disqus_thread">
          <i class="fa fa-comment-o"></i>
        </a>
      </li>
    
    <li class="post-action">
      
        <a class="post-action-btn btn btn--default" href="#table-of-contents">
      
        <i class="fa fa-list"></i>
      </a>
    </li>
  </ul>
</div>


      </div>
      <div id="share-options-bar" class="share-options-bar" data-behavior="2">
  <ul class="share-options">
    <li class="share-option">
      <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=http%3a%2f%2ftapoueh.org%2fblog%2f2014%2f02%2faggregating-nba-data-postgresql-vs-mongodb%2f">
        <i class="fa fa-google-plus"></i><span></span>
      </a>
    </li>
    <li class="share-option">
      <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2ftapoueh.org%2fblog%2f2014%2f02%2faggregating-nba-data-postgresql-vs-mongodb%2f">
        <i class="fa fa-facebook-official"></i><span></span>
      </a>
    </li>
    <li class="share-option">
      <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=Aggregating%20NBA%20data%2c%20PostgreSQL%20vs%20MongoDB with @tapoueh: http%3a%2f%2ftapoueh.org%2fblog%2f2014%2f02%2faggregating-nba-data-postgresql-vs-mongodb%2f">
        <i class="fa fa-twitter"></i><span></span>
      </a>
    </li>
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>

    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="//www.gravatar.com/avatar/7b615d104c506aa0a49e17151fa94d9f?s=110" alt="" />
    
    <h4 id="about-card-name">Dimitri Fontaine</h4>
    
      <div id="about-card-bio">PostgreSQL Major Contributor</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Open Source Software Engineer
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        France
      </div>
    
  </div>
</div>

    <div id="algolia-search-modal" class="modal-container">
  <div class="modal">
    <div class="modal-header">
      <span class="close-button"><i class="fa fa-close"></i></span>
      <a href="https://algolia.com" target="_blank" class="searchby-algolia text-color-light link-unstyled">
        <span class="searchby-algolia-text text-color-light text-small">by</span>
        <img class="searchby-algolia-logo" src="https://www.algolia.com/static_assets/images/press/downloads/algolia-light.svg">
      </a>
      <i class="search-icon fa fa-search"></i>
      <form id="algolia-search-form">
        <input type="text" id="algolia-search-input" name="search"
          class="form-control input--large search-input" placeholder="" />
      </form>
    </div>
    <div class="modal-body">
      <div class="no-result text-color-light text-center"></div>
      <div class="results">
        
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="http://tapoueh.org/blog/2016/04/pgconf-us-2016/">
                <h3 class="media-heading">PGConf US 2016</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Apr 4, 2016
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p><a href="https://www.pgconf.us/conferences/2016">PostgreSQL Conference US</a> took
place in New York City and I had the pleasure to be a speaker there. I
presented there a talk about why <em>You’d Better Have Tested Backups</em>. The
important bit is that backups are not interesting, recoveries are. Also the
only way to make sure a backup is successful is to be able to use it for
recovery.</p>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="http://tapoueh.org/blog/2015/11/all-your-base-conference-2015/">
                <h3 class="media-heading">All Your Base Conference 2015</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Nov 11, 2015
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>I had the pleasure to be invited to speak at
<a href="http://allyourbaseconf.com/2015/speakers#dimitri-fontaine">All Your Base Conference 2015</a>
about
<a href="http://www.postgresql.org">PostgreSQL</a> (of course). The conference gathers together lots of user
experience around data management and database products, either in the now
classic meaning of the word (I mean
<em>relational database management systems
here</em>) or the newer set of trade-offs represented by the NoSQL set of tools.</p>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="http://tapoueh.org/blog/2015/05/postgresql-au-jug-de-montpellier/">
                <h3 class="media-heading">PostgreSQL au JUG de Montpellier</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  May 5, 2015
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>J&rsquo;ai eu le plaisir de présenter PostgreSQL au
<a href="http://www.jug-montpellier.org/">Java User Group de Montpellier</a>
le 20 mai dernier dans le cadre d&rsquo;une soirée
<a href="http://www.jug-montpellier.org/event/36">PostgreSQL is YeSQL</a>. L&rsquo;accueil
réservé par le
<em>JUG</em> a été parfait et je tiens à les remercier pour une très
bonne soirée de partage et d&rsquo;échanges autour de PostgreSQL.</p>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="http://tapoueh.org/blog/2015/05/quicklisp-and-debian/">
                <h3 class="media-heading">Quicklisp and debian</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  May 5, 2015
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>Common Lisp users are very happy to use
<a href="https://www.quicklisp.org/beta/">Quicklisp</a> when it comes to
downloading and maintaining dependencies between their own code and the
<a href="http://quickdocs.org/">librairies</a> it is using.</p>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="http://tapoueh.org/blog/2015/04/pgday-paris/">
                <h3 class="media-heading">pgDay Paris</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Apr 4, 2015
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>Le 21 avril prochain se tient le premier
<a href="http://pgday.paris/">pgDay Paris</a>: une conférence
<a href="http://www.postgresql.org/">PostgreSQL</a> d&rsquo;une journée complète. Il s&rsquo;agit de 8 conférences sur votre base
de données préférée par des conférencers internationaux, incluant des
retours d&rsquo;expérience et une analyse de l&rsquo;utilisation des derniers
développements en cours dans notre projet de base de données préféré.</p>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="http://tapoueh.org/blog/2015/03/a-pgday-in-paris/">
                <h3 class="media-heading">a pgDay in Paris!</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Mar 3, 2015
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>I was lucky to participate as a speaker to the
<a href="http://2015.nordicpgday.org/">Nordic PostgreSQL Day 2015</a>
and it&rsquo;s been another awesome edition of the conference. Really smooth,
everything has been running as it should, with about one hundred people at
the conference.</p>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="http://tapoueh.org/blog/2015/02/back-from-fosdem-2015/">
                <h3 class="media-heading">Back From FOSDEM 2015</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Feb 2, 2015
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>The
<a href="https://fosdem.org/2015/">FOSDEM 2015</a> edition has been awesome this year, the usual mix of meeting
with old friends, talking about interesting topics, seeing tremendous
activity in all Open Source domains, and having Belgium beers in the
evenings.</p>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="http://tapoueh.org/blog/2015/01/my-first-slashdot-effect/">
                <h3 class="media-heading">My First Slashdot Effect</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jan 1, 2015
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>Thanks to the
<a href="http://postgresweekly.com/issues/89">Postgres Weekly issue #89</a> and a post to
<a href="https://news.ycombinator.com/news">Hacker News</a> front page
(see
<a href="https://news.ycombinator.com/item?id=8924270">Pgloader: A High-speed PostgreSQL Swiss Army Knife, Written in Lisp</a> it
well seems that I just had my first
<a href="http://en.wikipedia.org/wiki/Slashdot_effect">Slashdot effect</a>&hellip;</p>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="http://tapoueh.org/blog/2015/01/new-release-pgloader-3.2/">
                <h3 class="media-heading">New release: pgloader 3.2</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jan 1, 2015
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>PostgreSQL comes with an awesome bulk copy protocol and tooling best known
as the
<a href="http://www.postgresql.org/docs/current/static/sql-copy.html">COPY</a> and
<code>\copy</code> commands. Being a transactional system, PostgreSQL
COPY implementation will
<code>ROLLBACK</code> any work done if a single error is found
in the data set you&rsquo;re importing. That&rsquo;s the reason why
<a href="http://pgloader.io/">pgloader</a> got
started: it provides with error handling for the
<a href="http://www.postgresql.org/docs/9.3/static/protocol-flow.html#PROTOCOL-COPY">COPY protocol</a>.</p>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="http://tapoueh.org/blog/2014/10/meetup-postgresql-%C3%A0-paris/">
                <h3 class="media-heading">Meetup PostgreSQL à Paris</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Oct 10, 2014
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>Mercredi 8 octobre se tiendra le prochain
<a href="http://www.meetup.com/PostgreSQL-User-Group-Paris/events/209650432/">Meetup PostgreSQL à Paris</a> dans les
locaux de
<a href="https://www.mozilla.org/en-US/contact/spaces/paris/">Mozilla Europe</a>, dont la capacité est de 90 personnes ! Venez
nombreux !</p>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
      </div>
    </div>
    <div class="modal-footer">
      <p class="results-count text-medium"
         data-message-zero=""
         data-message-one=""
         data-message-other="">
         230 posts found
      </p>
    </div>
  </div>
</div>
    
  
    
    <div id="cover" style="background-image:url('http://tapoueh.org/images/Tree_Of_Light_by_lowapproach.jpg');"></div>
  


    
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.js"></script>


<script src="/js/script-wl33z0n6ocaypepiqrazthtivfrliqijej4rq8ek8gvrv1awftmgjuv8k4zc.min.js"></script>

<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight').each(function(i, block) {
    var code = "";
    hljs.highlightAuto(block.innerText).value.split(/\r\n|\r|\n/).forEach(function(line) {
      code += "<span class=\"line\">" + line + "</span><br>";
    });
    if (code.length > 0) {
      block.innerHTML = code;  
    }
  });
  $('pre > code').each(function(i, block) {
    $(this).addClass('codeblock');
    hljs.highlightBlock(block);
  });
});
</script>

  
    
      <script>
        var disqus_config = function () {
          this.page.url = 'http:\/\/tapoueh.org\/blog\/2014\/02\/aggregating-nba-data-postgresql-vs-mongodb\/';
          
            this.page.identifier = '\/blog\/2014\/02\/aggregating-nba-data-postgresql-vs-mongodb\/'
          
        };
        (function() {
          
          
          if (window.location.hostname == "localhost") {
            return;
          }
          var d = document, s = d.createElement('script');
          var disqus_shortname = 'tapoueh';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    
  





    
  </body>
</html>

