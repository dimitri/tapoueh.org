

  
    
  


  




  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Hugo 0.101.0">
    <meta name="theme" content="Tranquilpeak 0.3.1-BETA">
    <title>Aggregating NBA data, PostgreSQL vs MongoDB</title>
    <meta name="author" content="Dimitri Fontaine">
    <meta name="keywords" content="">

    <link rel="icon" href="/favicon.ico">
    

    
    <meta name="description" content="When reading the article
Crunching 30 Years of NBA Data with MongoDB Aggregation I coulnd&rsquo;t help but
think that we&rsquo;ve been enjoying
aggregates in SQL for 3 or 4 decades already.
When using
PostgreSQL it&rsquo;s even easy to actually add your own aggregates
given the SQL command
create aggregate.">
    <meta property="og:description" content="When reading the article
Crunching 30 Years of NBA Data with MongoDB Aggregation I coulnd&rsquo;t help but
think that we&rsquo;ve been enjoying
aggregates in SQL for 3 or 4 decades already.
When using
PostgreSQL it&rsquo;s even easy to actually add your own aggregates
given the SQL command
create aggregate.">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Aggregating NBA data, PostgreSQL vs MongoDB">
    <meta property="og:url" content="https://tapoueh.org/blog/2014/02/aggregating-nba-data-postgresql-vs-mongodb/">
    <meta property="og:site_name" content="The Art of PostgreSQL">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Aggregating NBA data, PostgreSQL vs MongoDB">
    <meta name="twitter:description" content="When reading the article
Crunching 30 Years of NBA Data with MongoDB Aggregation I coulnd&rsquo;t help but
think that we&rsquo;ve been enjoying
aggregates in SQL for 3 or 4 decades already.
When using
PostgreSQL it&rsquo;s even easy to actually add your own aggregates
given the SQL command
create aggregate.">
    
      <meta name="twitter:creator" content="@tapoueh">
    
    

    
    

    
      <meta property="og:image" content="//www.gravatar.com/avatar/7b615d104c506aa0a49e17151fa94d9f?s=640">
    

    
      <meta property="og:image" content="https://tapoueh.org/img/old/postgresql-mongodb.jpg">
    
    
      <meta property="og:image" content="https://tapoueh.org/img/old/postgresql-mongodb.jpg">
    
    

    

    
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.css" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" />
    
    
    <link rel="stylesheet" href="/css/style-jsjn0006wyhpyzivf6yceb31gvpjatbcs3qzjvlumobfnugccvobqwxnnaj8.min.css" />
    
    
      <link rel="stylesheet" href="https://tapoueh.org/css/dim.css">
    
      <link rel="stylesheet" href="https://tapoueh.org/css/nav.css">
    

    
      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-47059482-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="5">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="navbar-collapse collapse header-title" id="navigation">
    <ul class="nav navbar-nav navbar-right">
      
      <li class="dropdown">
        
        <a style="color: black;" href="/" alt="blog"><i class="sidebar-button-icon fa fa-lg fa-home"></i></a>
        
      </li>
      
      <li class="dropdown">
        
        <a style="color: black;" href="/conf/" alt="talks"><i class="sidebar-button-icon fa fa-lg fa-microphone"></i></a>
        
      </li>
      
      <li class="dropdown">
        
        <a style="color: black;" href="https://twitter.com/tapoueh" alt="Twitter"><i class="sidebar-button-icon fa fa-lg fa-twitter"></i></a>
        
      </li>
      
      <li class="dropdown">
        
        <a style="color: black;" href="http://theartofpostgresql.com" alt="The Art Of PostgreSQL"><i class="sidebar-button-icon fa fa-lg fa-book"></i></a>
        
      </li>
      
    </ul>
  </div>

  
    
      <a class="header-right-icon "
         href="https://theartofpostgresql.com/" target="_blank">
    
    
      <i class="fa fa-lg fa-book"></i>
    
    
    </a>
  
</header>

      <nav id="sidebar" data-behavior="5">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="/#about" aria-label="">
          <img class="sidebar-profile-picture" src="//www.gravatar.com/avatar/7b615d104c506aa0a49e17151fa94d9f?s=110" alt="" />
        </a>
        <h4 class="sidebar-profile-name">Dimitri Fontaine</h4>
        
          <h5 class="sidebar-profile-bio">PostgreSQL Major Contributor</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/" title="Blog">
    
      <i class="sidebar-button-icon fa fa-lg fa-pagelines"></i>
      
      <span class="sidebar-button-desc">Blog</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/about/" title="About">
    
      <i class="sidebar-button-icon fa fa-lg fa-beer"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/categories/yesql/" title="YeSQL">
    
      <i class="sidebar-button-icon fa fa-lg fa-database"></i>
      
      <span class="sidebar-button-desc">YeSQL</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://theartofpostgresql.com" target="_blank" rel="noopener" title="The Art of PostgreSQL">
    
      <i class="sidebar-button-icon fa fa-lg fa-book"></i>
      
      <span class="sidebar-button-desc">The Art of PostgreSQL</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/dimitri" target="_blank" rel="noopener" title="GitHub">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://twitter.com/tapoueh" target="_blank" rel="noopener" title="Twitter">
    
      <i class="sidebar-button-icon fa fa-lg fa-twitter"></i>
      
      <span class="sidebar-button-desc">Twitter</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/categories" title="Categories">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/index.xml" title="RSS">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      
  <div class="post-header-cover
              text-left
              post-header-cover--partial"
       style="background-image:url('/img/old/postgresql-mongodb.jpg')"
       data-behavior="5">
    
      <div class="post-header main-content-wrap text-left">
  
    <h1 class="post-title">
      Aggregating NBA data, PostgreSQL vs MongoDB
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time itemprop="datePublished" datetime="2014-02-17T23:40:00&#43;01:00">
        <span style="float: left; width: 35%">
          <i class="fa fa-calendar"></i> 
  
  
  
  
    Monday 17 Feb 2014
  

        </span>
      </time>
    
    <span style="float: right; width: 65%">
      <i class="fa fa-clock-o"></i> 9 mins read
      
    </span>
    <span style="float: left; width: 35%">
      <i class="fa fa-bookmark"></i> 
  
  
    <span></span>
    
      <a class="category-link" href="/categories/postgresql">PostgreSQL</a>, 
    
      <a class="category-link" href="/categories/yesql">YeSQL</a>
    
  

    </span>
    <div>
      <p>
        
        
        
        
        <a href="/tags/mongodb/">
          <i class="fa fa-tag"></i> MongoDB
        </a>
        
        
        
        
        
        <a href="/tags/statistics/">
          <i class="fa fa-tag"></i> Statistics
        </a>
        
        
      </p>
    </div>
  </div>


</div>
    
  </div>


      <div id="main" data-behavior="5"
        class="hasCover
               hasCoverMetaIn
               ">
        <article class="post" itemscope itemType="http://schema.org/BlogPosting">
          
          
          <div class="post-content markdown" itemprop="articleBody">
            <div class="main-content-wrap">
              <p>When reading the article
<a href="http://thecodebarbarian.wordpress.com/2014/02/14/crunching-30-years-of-nba-data-with-mongodb-aggregation/">Crunching 30 Years of NBA Data with MongoDB Aggregation</a> I coulnd&rsquo;t help but
think that we&rsquo;ve been enjoying
<a href="http://www.postgresql.org/docs/current/static/tutorial-agg.html">aggregates</a> in SQL for 3 or 4 decades already.
When using
<a href="http://www.postgresql.org/">PostgreSQL</a> it&rsquo;s even easy to actually add your own aggregates
given the SQL command
<a href="http://www.postgresql.org/docs/current/static/sql-createaggregate.html">create aggregate</a>.</p>
<center>*Photo Credit: [Copyright All rights reserved by Segward Graupner](https://www.flickr.com/photos/57426425@N07/6005436411/sizes/z/)*</center>
<p>The next step after thinking how obvious the queries written in the
mentionned article would be to express in SQL was to actually load the data
into PostgreSQL and write the aggregate queries, of course.</p>
 




<div class="table-of-contents toc bd-callout">
    
    <h4 class="text-muted">Table of Contents</h4>
    
        
        
            
                
                
                
                    <ul class="toc-h1">
                
                
                
                
                <li>
                  <a href="/blog/2014/02/aggregating-nba-data-postgresql-vs-mongodb/#loading-the-data">
                    Loading the data
                  </a>
                </li>
                
                
                    </ul>
                
            
        
    
        
        
            
                
                
                
                    <ul class="toc-h1">
                
                
                
                
                <li>
                  <a href="/blog/2014/02/aggregating-nba-data-postgresql-vs-mongodb/#running-the-aggregates">
                    Running the Aggregates
                  </a>
                </li>
                
                
                    </ul>
                
            
        
    
        
        
            
                
                
                
                    <ul class="toc-h1">
                
                
                
                
                <li>
                  <a href="/blog/2014/02/aggregating-nba-data-postgresql-vs-mongodb/#correlating-stats-with-wins">
                    Correlating stats with wins
                  </a>
                </li>
                
                
                    </ul>
                
            
        
    
        
        
            
                
                
                
                    <ul class="toc-h1">
                
                
                
                
                <li>
                  <a href="/blog/2014/02/aggregating-nba-data-postgresql-vs-mongodb/#defensive-rebounds-and-total-rebounds-versus-win-percentage">
                    Defensive Rebounds and Total Rebounds Versus Win Percentage
                  </a>
                </li>
                
                
                    </ul>
                
            
        
    
        
        
            
                
                
                
                    <ul class="toc-h1">
                
                
                
                
                <li>
                  <a href="/blog/2014/02/aggregating-nba-data-postgresql-vs-mongodb/#interesting-factoid">
                    Interesting factoid
                  </a>
                </li>
                
                
                    </ul>
                
            
        
    
        
        
            
                
                
                
                    <ul class="toc-h1">
                
                
                
                
                <li>
                  <a href="/blog/2014/02/aggregating-nba-data-postgresql-vs-mongodb/#total-rebounds-and-wins">
                    Total rebounds and wins
                  </a>
                </li>
                
                
                    </ul>
                
            
        
    
        
        
            
                
                
                
                    <ul class="toc-h1">
                
                
                
                
                <li>
                  <a href="/blog/2014/02/aggregating-nba-data-postgresql-vs-mongodb/#conclusion">
                    Conclusion
                  </a>
                </li>
                
                
                    </ul>
                
            
        
    
</div>


<h2 id="loading-the-data">Loading the data</h2>
<p>With the help of a little bit of
<em>Common Lisp</em> code and using the
<a href="https://github.com/archimag/mongo-cl-driver">mongo-cl-driver</a> it was easy enough to parse the given
<a href="http://bsonspec.org/">BSON</a> file. What was
more complex was to actually understand enough of the data model to produce
a relational design out of it, avoiding data redundancy as much as possible.</p>
<p>We call that step
<em>normalization</em> in old-style relational databases, and the
goal of that process is to avoid
<em>functional dependency</em> so that the data is
easier to understand, verify and process the data once loaded.</p>
<p>For instance, rather than have both scores from each team and a column
<code>won</code>
per team, which would be a boolean but is a number in the given
<em>BSON</em> file,
we store only the scores. Here&rsquo;s the main table definition of the stats we
are going to be playing with, the
<code>game</code> table:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#00a">create</span><span style="color:#bbb"> </span><span style="color:#00a">table</span><span style="color:#bbb"> </span>nba.game<span style="color:#bbb"> </span>(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>id<span style="color:#bbb">          </span><span style="color:#0aa">serial</span><span style="color:#bbb"> </span><span style="color:#00a">primary</span><span style="color:#bbb"> </span><span style="color:#00a">key</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#0aa">date</span><span style="color:#bbb">        </span>timestamptz,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#00a">host</span><span style="color:#bbb">        </span><span style="color:#0aa">int</span><span style="color:#bbb"> </span><span style="color:#00a">references</span><span style="color:#bbb"> </span>nba.team(id),<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>guest<span style="color:#bbb">       </span><span style="color:#0aa">int</span><span style="color:#bbb"> </span><span style="color:#00a">references</span><span style="color:#bbb"> </span>nba.team(id),<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>host_score<span style="color:#bbb">  </span><span style="color:#0aa">int</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>guest_score<span style="color:#bbb"> </span><span style="color:#0aa">int</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>);<span style="color:#bbb">
</span></span></span></code></pre></div><p>As much of the aggregates in the referenced article are playing with
statistics from teams who actually
<em>won</em> the game, let&rsquo;s create a view to
simplify our SQL queries thereafter:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#00a">create</span><span style="color:#bbb"> </span><span style="color:#00a">view</span><span style="color:#bbb"> </span>winners<span style="color:#bbb"> </span><span style="color:#00a">as</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#00a">select</span><span style="color:#bbb"> </span>id,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span><span style="color:#0aa">date</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span><span style="color:#00a">case</span><span style="color:#bbb"> </span><span style="color:#00a">when</span><span style="color:#bbb"> </span>host_score<span style="color:#bbb"> </span>&gt;<span style="color:#bbb"> </span>guest_score<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span><span style="color:#00a">then</span><span style="color:#bbb"> </span><span style="color:#00a">host</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span><span style="color:#00a">else</span><span style="color:#bbb"> </span>guest<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#00a">end</span><span style="color:#bbb"> </span><span style="color:#00a">as</span><span style="color:#bbb"> </span>winner<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#00a">from</span><span style="color:#bbb"> </span>game;<span style="color:#bbb">
</span></span></span></code></pre></div><p>If you&rsquo;re not doing much SQL, remember that creating such a view is common
practice in the relational world.</p>
<h2 id="running-the-aggregates">Running the Aggregates</h2>
<p>Now that we have the extra useful view, it&rsquo;s possible to implement the first
<a href="http://www.mongodb.org/">MongoDB</a> query in SQL. First, let&rsquo;s have a look at the MongoDB query:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>db.games.aggregate([
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    $match : {
</span></span><span style="display:flex;"><span>      date : {
</span></span><span style="display:flex;"><span>        $gt : ISODate(<span style="color:#a50">&#34;1999-08-01T00:00:00Z&#34;</span>),
</span></span><span style="display:flex;"><span>        $lt : ISODate(<span style="color:#a50">&#34;2000-08-01T00:00:00Z&#34;</span>)
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    $unwind : <span style="color:#a50">&#39;$teams&#39;</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    $match : {
</span></span><span style="display:flex;"><span>      <span style="color:#a50">&#39;teams.won&#39;</span> : <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    $group : {
</span></span><span style="display:flex;"><span>      _id : <span style="color:#a50">&#39;$teams.name&#39;</span>,
</span></span><span style="display:flex;"><span>      wins : { $sum : <span style="color:#099">1</span> }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    $sort : { wins : -<span style="color:#099">1</span> }
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    $limit : <span style="color:#099">5</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>]);
</span></span></code></pre></div><p>I don&rsquo;t know about you, but I have quite a hard time deciphering what that
query is actually doing, and when the explanation text talks about
<em>using a
6-stage pipeline</em> my understanding is that the application developper has
been writing the
<em>execution plan</em> of the query here. Let&rsquo;s ignore the query
format itself, as it&rsquo;s obviously meant to be generated by a tool rather than
typed by a human being.</p>
<p>Here&rsquo;s the same query in SQL, with the result this time:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#00a">SELECT</span><span style="color:#bbb"> </span>abbrev,<span style="color:#bbb"> </span>name,<span style="color:#bbb"> </span><span style="color:#00a">count</span>(*)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#00a">FROM</span><span style="color:#bbb"> </span>winners<span style="color:#bbb"> </span><span style="color:#00a">JOIN</span><span style="color:#bbb"> </span>team<span style="color:#bbb"> </span><span style="color:#00a">ON</span><span style="color:#bbb"> </span>team.id<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>winners.winner<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">   </span><span style="color:#00a">WHERE</span><span style="color:#bbb">     </span><span style="color:#0aa">date</span><span style="color:#bbb"> </span>&gt;<span style="color:#bbb"> </span><span style="color:#a50">&#39;1999-08-01T00:00:00Z&#39;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span><span style="color:#00a">AND</span><span style="color:#bbb"> </span><span style="color:#0aa">date</span><span style="color:#bbb"> </span>&lt;<span style="color:#bbb"> </span><span style="color:#a50">&#39;2000-08-01T00:00:00Z&#39;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#00a">GROUP</span><span style="color:#bbb"> </span><span style="color:#00a">BY</span><span style="color:#bbb"> </span>winner,<span style="color:#bbb"> </span>abbrev,<span style="color:#bbb"> </span>name<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#00a">ORDER</span><span style="color:#bbb"> </span><span style="color:#00a">BY</span><span style="color:#bbb"> </span><span style="color:#00a">count</span>(*)<span style="color:#bbb"> </span><span style="color:#00a">DESC</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">   </span><span style="color:#00a">LIMIT</span><span style="color:#bbb"> </span><span style="color:#099">5</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span>abbrev<span style="color:#bbb"> </span>|<span style="color:#bbb">          </span>name<span style="color:#bbb">          </span>|<span style="color:#bbb"> </span><span style="color:#00a">count</span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#aaa;font-style:italic">--------+------------------------+-------
</span></span></span><span style="display:flex;"><span><span style="color:#aaa;font-style:italic"></span><span style="color:#bbb"> </span>LAL<span style="color:#bbb">    </span>|<span style="color:#bbb"> </span>Los<span style="color:#bbb"> </span>Angeles<span style="color:#bbb"> </span>Lakers<span style="color:#bbb">     </span>|<span style="color:#bbb">    </span><span style="color:#099">67</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span>POR<span style="color:#bbb">    </span>|<span style="color:#bbb"> </span>Portland<span style="color:#bbb"> </span>Trail<span style="color:#bbb"> </span>Blazers<span style="color:#bbb"> </span>|<span style="color:#bbb">    </span><span style="color:#099">59</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span>IND<span style="color:#bbb">    </span>|<span style="color:#bbb"> </span>Indiana<span style="color:#bbb"> </span>Pacers<span style="color:#bbb">         </span>|<span style="color:#bbb">    </span><span style="color:#099">56</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span>UTA<span style="color:#bbb">    </span>|<span style="color:#bbb"> </span>Utah<span style="color:#bbb"> </span>Jazz<span style="color:#bbb">              </span>|<span style="color:#bbb">    </span><span style="color:#099">55</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span>SAS<span style="color:#bbb">    </span>|<span style="color:#bbb"> </span>San<span style="color:#bbb"> </span>Antonio<span style="color:#bbb"> </span>Spurs<span style="color:#bbb">      </span>|<span style="color:#bbb">    </span><span style="color:#099">53</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>(<span style="color:#099">5</span><span style="color:#bbb"> </span><span style="color:#00a">rows</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>Time:<span style="color:#bbb"> </span><span style="color:#099">8</span>.<span style="color:#099">101</span><span style="color:#bbb"> </span>ms<span style="color:#bbb">
</span></span></span></code></pre></div><p>What we have here is a pretty basic query using a
<em>join</em>, a
<em>where</em> clause to
restrict the data set we are playing with, a
<em>group by</em> clause to define which
data to compute the aggregates against, with an
<em>order by</em> and a
<em>limit</em> clause
for presenting the result. To be realistic, if you&rsquo;ve ever done any SQL at
all, then you know how to read that query because you&rsquo;ve been writing dozens
of similar ones.</p>
<p>Here&rsquo;s, as in the original article, the same query against a much larger
data set this time, with all games of the 2000s decade:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#bbb">   </span><span style="color:#00a">SELECT</span><span style="color:#bbb"> </span>abbrev,<span style="color:#bbb"> </span>name,<span style="color:#bbb"> </span><span style="color:#00a">count</span>(*)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">     </span><span style="color:#00a">FROM</span><span style="color:#bbb"> </span>winners<span style="color:#bbb"> </span><span style="color:#00a">join</span><span style="color:#bbb"> </span>team<span style="color:#bbb"> </span><span style="color:#00a">on</span><span style="color:#bbb"> </span>team.id<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>winners.winner<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#00a">WHERE</span><span style="color:#bbb">     </span><span style="color:#0aa">date</span><span style="color:#bbb"> </span>&gt;<span style="color:#bbb"> </span><span style="color:#a50">&#39;2000-08-01T00:00:00Z&#39;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#00a">AND</span><span style="color:#bbb"> </span><span style="color:#0aa">date</span><span style="color:#bbb"> </span>&lt;<span style="color:#bbb"> </span><span style="color:#a50">&#39;2010-08-01T00:00:00Z&#39;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span><span style="color:#00a">GROUP</span><span style="color:#bbb"> </span><span style="color:#00a">BY</span><span style="color:#bbb"> </span>winner,<span style="color:#bbb"> </span>abbrev,<span style="color:#bbb"> </span>name<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span><span style="color:#00a">ORDER</span><span style="color:#bbb"> </span><span style="color:#00a">BY</span><span style="color:#bbb"> </span><span style="color:#00a">count</span>(*)<span style="color:#bbb"> </span><span style="color:#00a">DESC</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#00a">LIMIT</span><span style="color:#bbb"> </span><span style="color:#099">5</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span>abbrev<span style="color:#bbb"> </span>|<span style="color:#bbb">        </span>name<span style="color:#bbb">        </span>|<span style="color:#bbb"> </span><span style="color:#00a">count</span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#aaa;font-style:italic">--------+--------------------+-------
</span></span></span><span style="display:flex;"><span><span style="color:#aaa;font-style:italic"></span><span style="color:#bbb"> </span>SAS<span style="color:#bbb">    </span>|<span style="color:#bbb"> </span>San<span style="color:#bbb"> </span>Antonio<span style="color:#bbb"> </span>Spurs<span style="color:#bbb">  </span>|<span style="color:#bbb">   </span><span style="color:#099">579</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span>DAL<span style="color:#bbb">    </span>|<span style="color:#bbb"> </span>Dallas<span style="color:#bbb"> </span>Mavericks<span style="color:#bbb">   </span>|<span style="color:#bbb">   </span><span style="color:#099">568</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span>LAL<span style="color:#bbb">    </span>|<span style="color:#bbb"> </span>Los<span style="color:#bbb"> </span>Angeles<span style="color:#bbb"> </span>Lakers<span style="color:#bbb"> </span>|<span style="color:#bbb">   </span><span style="color:#099">524</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span>PHO<span style="color:#bbb">    </span>|<span style="color:#bbb"> </span>Phoenix<span style="color:#bbb"> </span>Suns<span style="color:#bbb">       </span>|<span style="color:#bbb">   </span><span style="color:#099">495</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span>DET<span style="color:#bbb">    </span>|<span style="color:#bbb"> </span>Detroit<span style="color:#bbb"> </span>Pistons<span style="color:#bbb">    </span>|<span style="color:#bbb">   </span><span style="color:#099">489</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>(<span style="color:#099">5</span><span style="color:#bbb"> </span><span style="color:#00a">rows</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>Time:<span style="color:#bbb"> </span><span style="color:#099">24</span>.<span style="color:#099">713</span><span style="color:#bbb"> </span>ms<span style="color:#bbb">
</span></span></span></code></pre></div><h2 id="correlating-stats-with-wins">Correlating stats with wins</h2>
<p>The goal here is to compute how often a team wins when they record more
defensive rebounds than their opponent across the entire data set.</p>
<p>To be able to compute the percentage, we have to have a count of all
registered games, of course. Then we are going to count how many times the
winner team registered a greater
<em>team_stats.drb</em> than the loser, and
<em>count
how many times</em> in SQL is usually written as a
<code>sum(case when &lt;condition&gt; then 1 else 0 end)</code>, which is what we&rsquo;re doing here:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#00a">select</span><span style="color:#bbb"> </span><span style="color:#00a">count</span>(*)<span style="color:#bbb"> </span><span style="color:#00a">as</span><span style="color:#bbb"> </span>games,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">       </span><span style="color:#00a">sum</span>(<span style="color:#00a">case</span><span style="color:#bbb"> </span><span style="color:#00a">when</span><span style="color:#bbb"> </span>ws.drb<span style="color:#bbb"> </span>&gt;<span style="color:#bbb"> </span>ls.drb<span style="color:#bbb"> </span><span style="color:#00a">then</span><span style="color:#bbb"> </span><span style="color:#099">1</span><span style="color:#bbb"> </span><span style="color:#00a">else</span><span style="color:#bbb"> </span><span style="color:#099">0</span><span style="color:#bbb"> </span><span style="color:#00a">end</span>)<span style="color:#bbb"> </span><span style="color:#00a">as</span><span style="color:#bbb"> </span>drb,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">       </span><span style="color:#00a">sum</span>(<span style="color:#00a">case</span><span style="color:#bbb"> </span><span style="color:#00a">when</span><span style="color:#bbb"> </span>ws.drb<span style="color:#bbb"> </span>&gt;<span style="color:#bbb"> </span>ls.drb<span style="color:#bbb"> </span><span style="color:#00a">then</span><span style="color:#bbb"> </span><span style="color:#099">1</span><span style="color:#bbb"> </span><span style="color:#00a">else</span><span style="color:#bbb"> </span><span style="color:#099">0</span><span style="color:#bbb"> </span><span style="color:#00a">end</span>)::<span style="color:#0aa">float</span><span style="color:#bbb"> </span>/<span style="color:#bbb"> </span><span style="color:#00a">count</span>(*)<span style="color:#bbb"> </span>*<span style="color:#bbb"> </span><span style="color:#099">100</span><span style="color:#bbb"> </span><span style="color:#00a">as</span><span style="color:#bbb"> </span>pct<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#00a">from</span><span style="color:#bbb"> </span>winlose<span style="color:#bbb"> </span>wl<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">       </span><span style="color:#00a">join</span><span style="color:#bbb"> </span>team<span style="color:#bbb"> </span>w<span style="color:#bbb"> </span><span style="color:#00a">on</span><span style="color:#bbb"> </span>wl.winner<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>w.id<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">       </span><span style="color:#00a">join</span><span style="color:#bbb"> </span>team<span style="color:#bbb"> </span>l<span style="color:#bbb"> </span><span style="color:#00a">on</span><span style="color:#bbb"> </span>wl.loser<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>l.id<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">       </span><span style="color:#00a">join</span><span style="color:#bbb"> </span>team_stats<span style="color:#bbb"> </span>ws<span style="color:#bbb"> </span><span style="color:#00a">on</span><span style="color:#bbb"> </span>ws.game<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>wl.id<span style="color:#bbb"> </span><span style="color:#00a">and</span><span style="color:#bbb"> </span>ws.team<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>wl.winner<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">       </span><span style="color:#00a">join</span><span style="color:#bbb"> </span>team_stats<span style="color:#bbb"> </span>ls<span style="color:#bbb"> </span><span style="color:#00a">on</span><span style="color:#bbb"> </span>ls.game<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>wl.id<span style="color:#bbb"> </span><span style="color:#00a">and</span><span style="color:#bbb"> </span>ls.team<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>wl.loser;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span>games<span style="color:#bbb"> </span>|<span style="color:#bbb">  </span>drb<span style="color:#bbb">  </span>|<span style="color:#bbb">       </span>pct<span style="color:#bbb">        
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#aaa;font-style:italic">-------+-------+------------------
</span></span></span><span style="display:flex;"><span><span style="color:#aaa;font-style:italic"></span><span style="color:#bbb"> </span><span style="color:#099">31686</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#099">22292</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#099">70</span>.<span style="color:#099">3528372151739</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>(<span style="color:#099">1</span><span style="color:#bbb"> </span><span style="color:#00a">row</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>Time:<span style="color:#bbb"> </span><span style="color:#099">276</span>.<span style="color:#099">669</span><span style="color:#bbb"> </span>ms<span style="color:#bbb">
</span></span></span></code></pre></div><p>We note here than in the original MongoDB article the aggregation query is
short of computing the
<em>percentage</em> directly, apparently it&rsquo;s been done in the
client tool, maybe using a
<em>spreadsheet</em> application or something.</p>
<h2 id="defensive-rebounds-and-total-rebounds-versus-win-percentage">Defensive Rebounds and Total Rebounds Versus Win Percentage</h2>



<div class="figure fig25 right dim-margin" >
  
    <img class="fig-img" src="/img/old/DReboundsVandy.320.png" >
  
  
</div>

<p>Next, still following on our inspirational article
<a href="http://thecodebarbarian.wordpress.com/2014/02/14/crunching-30-years-of-nba-data-with-mongodb-aggregation/">Crunching 30 Years of NBA Data with MongoDB Aggregation</a>, we’re going to
compute what percentage of the time a team wins as a function of the number
of defensive rebounds they recorded.</p>
<p>I&rsquo;m not sure I understand what they achieve with averaging ones when a team
wins and zero when a team loses, so I couldn&rsquo;t quite reproduce their result.
Here&rsquo;s an approaching query tho:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#00a">with</span><span style="color:#bbb"> </span>game_stats<span style="color:#bbb"> </span><span style="color:#00a">as</span><span style="color:#bbb"> </span>(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#00a">select</span><span style="color:#bbb"> </span>t.id,<span style="color:#bbb"> </span><span style="color:#00a">count</span>(*)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#00a">from</span><span style="color:#bbb"> </span>team<span style="color:#bbb"> </span>t<span style="color:#bbb"> </span><span style="color:#00a">join</span><span style="color:#bbb"> </span>game<span style="color:#bbb"> </span><span style="color:#00a">on</span><span style="color:#bbb"> </span>game.<span style="color:#00a">host</span><span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>t.id<span style="color:#bbb"> </span><span style="color:#00a">or</span><span style="color:#bbb"> </span>game.guest<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>t.id<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">   </span><span style="color:#00a">group</span><span style="color:#bbb"> </span><span style="color:#00a">by</span><span style="color:#bbb"> </span>t.id<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#00a">select</span><span style="color:#bbb"> </span>ts.team,<span style="color:#bbb"> </span>round(<span style="color:#00a">avg</span>(drb),<span style="color:#bbb"> </span><span style="color:#099">2</span>)<span style="color:#bbb"> </span><span style="color:#00a">as</span><span style="color:#bbb"> </span>drb,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">       </span>round(<span style="color:#00a">count</span>(*)<span style="color:#bbb"> </span>/<span style="color:#bbb"> </span>gs.<span style="color:#00a">count</span>::<span style="color:#0aa">numeric</span><span style="color:#bbb"> </span>*<span style="color:#bbb"> </span><span style="color:#099">100</span>,<span style="color:#bbb"> </span><span style="color:#099">2</span>)<span style="color:#bbb"> </span><span style="color:#00a">as</span><span style="color:#bbb"> </span>winpct,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">       </span><span style="color:#00a">count</span>(*)<span style="color:#bbb"> </span><span style="color:#00a">as</span><span style="color:#bbb"> </span>wins,<span style="color:#bbb"> </span>gs.<span style="color:#00a">count</span><span style="color:#bbb"> </span><span style="color:#00a">as</span><span style="color:#bbb"> </span>games<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#00a">from</span><span style="color:#bbb"> </span>team_stats<span style="color:#bbb"> </span>ts<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">       </span><span style="color:#00a">join</span><span style="color:#bbb"> </span>game<span style="color:#bbb"> </span><span style="color:#00a">on</span><span style="color:#bbb"> </span>game.id<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>ts.game<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span><span style="color:#00a">and</span><span style="color:#bbb"> </span>game.<span style="color:#00a">host</span><span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>ts.team<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span><span style="color:#00a">and</span><span style="color:#bbb"> </span>game.host_score<span style="color:#bbb"> </span>&gt;<span style="color:#bbb"> </span>game.guest_score<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">       </span><span style="color:#00a">join</span><span style="color:#bbb"> </span>game_stats<span style="color:#bbb"> </span>gs<span style="color:#bbb"> </span><span style="color:#00a">on</span><span style="color:#bbb"> </span>gs.id<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>ts.team<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#00a">group</span><span style="color:#bbb"> </span><span style="color:#00a">by</span><span style="color:#bbb"> </span>ts.team,<span style="color:#bbb"> </span>gs.<span style="color:#00a">count</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span>team<span style="color:#bbb"> </span>|<span style="color:#bbb">  </span>drb<span style="color:#bbb">  </span>|<span style="color:#bbb"> </span>winpct<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>wins<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>games<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#aaa;font-style:italic">------+-------+--------+------+-------
</span></span></span><span style="display:flex;"><span><span style="color:#aaa;font-style:italic"></span><span style="color:#bbb">    </span><span style="color:#099">4</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#099">31</span>.<span style="color:#099">59</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#099">31</span>.<span style="color:#099">46</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#099">710</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#099">2257</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#099">7</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#099">32</span>.<span style="color:#099">55</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#099">31</span>.<span style="color:#099">89</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#099">720</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#099">2258</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">   </span><span style="color:#099">16</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#099">31</span>.<span style="color:#099">70</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#099">37</span>.<span style="color:#099">62</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#099">849</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#099">2257</span><span style="color:#bbb">
</span></span></span></code></pre></div><p>I only pasted the first few lines of the result because I&rsquo;m not sure how to
make sense of it, really.</p>
<h2 id="interesting-factoid">Interesting factoid</h2>
<p>What I find most interesting in the following
<em>factoid</em> proposed in the
MongoDB article is the complete lack of the query you need to run in order
to grab the matching data:</p>
<blockquote>
<p>An interesting factoid: the team that recorded the fewest defensive rebounds
in a win was the 1995-96 Toronto Raptors, who beat the Milwaukee Bucks 93-87
on 12/26/1995 despite recording only 14 defensive rebounds.</p>
</blockquote>
<p>When doing the necessary query in SQL, using a
<a href="http://www.postgresql.org/docs/current/static/queries-with.html">Common Table Expression</a> (the
<code>WITH</code> syntax) and a
<a href="http://www.postgresql.org/docs/9.3/static/tutorial-window.html">Window Function</a> for good measure, we get actually 4
different games with the minimum defensive rebounds in our history of NBA
games, 14:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#00a">with</span><span style="color:#bbb"> </span>stats(game,<span style="color:#bbb"> </span>team,<span style="color:#bbb"> </span>drb,<span style="color:#bbb"> </span><span style="color:#00a">min</span>)<span style="color:#bbb"> </span><span style="color:#00a">as</span><span style="color:#bbb"> </span>(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#00a">select</span><span style="color:#bbb"> </span>ts.game,<span style="color:#bbb"> </span>ts.team,<span style="color:#bbb"> </span>drb,<span style="color:#bbb"> </span><span style="color:#00a">min</span>(drb)<span style="color:#bbb"> </span>over<span style="color:#bbb"> </span>()<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#00a">from</span><span style="color:#bbb"> </span>team_stats<span style="color:#bbb"> </span>ts<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">           </span><span style="color:#00a">join</span><span style="color:#bbb"> </span>winners<span style="color:#bbb"> </span>w<span style="color:#bbb"> </span><span style="color:#00a">on</span><span style="color:#bbb"> </span>w.id<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>ts.game<span style="color:#bbb"> </span><span style="color:#00a">and</span><span style="color:#bbb"> </span>w.winner<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>ts.team<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#00a">select</span><span style="color:#bbb"> </span>game.<span style="color:#0aa">date</span>::<span style="color:#0aa">date</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">       </span><span style="color:#00a">host</span>.name<span style="color:#bbb"> </span>||<span style="color:#bbb"> </span><span style="color:#a50">&#39; -- &#39;</span><span style="color:#bbb"> </span>||<span style="color:#bbb"> </span>host_score<span style="color:#bbb"> </span><span style="color:#00a">as</span><span style="color:#bbb"> </span><span style="color:#00a">host</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">       </span>guest.name<span style="color:#bbb"> </span>||<span style="color:#bbb"> </span><span style="color:#a50">&#39; -- &#39;</span><span style="color:#bbb"> </span>||<span style="color:#bbb"> </span>guest_score<span style="color:#bbb"> </span><span style="color:#00a">as</span><span style="color:#bbb"> </span>guest,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">       </span>stats.drb<span style="color:#bbb"> </span><span style="color:#00a">as</span><span style="color:#bbb"> </span>winner_drb<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#00a">from</span><span style="color:#bbb"> </span>stats<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">       </span><span style="color:#00a">join</span><span style="color:#bbb"> </span>game<span style="color:#bbb"> </span><span style="color:#00a">on</span><span style="color:#bbb"> </span>game.id<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>stats.game<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">       </span><span style="color:#00a">join</span><span style="color:#bbb"> </span>team<span style="color:#bbb"> </span><span style="color:#00a">host</span><span style="color:#bbb"> </span><span style="color:#00a">on</span><span style="color:#bbb"> </span><span style="color:#00a">host</span>.id<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>game.<span style="color:#00a">host</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">       </span><span style="color:#00a">join</span><span style="color:#bbb"> </span>team<span style="color:#bbb"> </span>guest<span style="color:#bbb"> </span><span style="color:#00a">on</span><span style="color:#bbb"> </span>guest.id<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>game.guest<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span><span style="color:#00a">where</span><span style="color:#bbb"> </span>drb<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span><span style="color:#00a">min</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>-[<span style="color:#bbb"> </span>RECORD<span style="color:#bbb"> </span><span style="color:#099">1</span><span style="color:#bbb"> </span>]<span style="color:#aaa;font-style:italic">----------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#aaa;font-style:italic"></span><span style="color:#0aa">date</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#099">1995</span>-<span style="color:#099">12</span>-<span style="color:#099">26</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#00a">host</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span>Toronto<span style="color:#bbb"> </span>Raptors<span style="color:#bbb"> </span><span style="color:#aaa;font-style:italic">-- 93
</span></span></span><span style="display:flex;"><span><span style="color:#aaa;font-style:italic"></span>guest<span style="color:#bbb">      </span>|<span style="color:#bbb"> </span>Milwaukee<span style="color:#bbb"> </span>Bucks<span style="color:#bbb"> </span><span style="color:#aaa;font-style:italic">-- 87
</span></span></span><span style="display:flex;"><span><span style="color:#aaa;font-style:italic"></span>winner_drb<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#099">14</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>-[<span style="color:#bbb"> </span>RECORD<span style="color:#bbb"> </span><span style="color:#099">2</span><span style="color:#bbb"> </span>]<span style="color:#aaa;font-style:italic">----------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#aaa;font-style:italic"></span><span style="color:#0aa">date</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#099">1996</span>-<span style="color:#099">02</span>-<span style="color:#099">02</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#00a">host</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span>Golden<span style="color:#bbb"> </span><span style="color:#00a">State</span><span style="color:#bbb"> </span>Warriors<span style="color:#bbb"> </span><span style="color:#aaa;font-style:italic">-- 114
</span></span></span><span style="display:flex;"><span><span style="color:#aaa;font-style:italic"></span>guest<span style="color:#bbb">      </span>|<span style="color:#bbb"> </span>Toronto<span style="color:#bbb"> </span>Raptors<span style="color:#bbb"> </span><span style="color:#aaa;font-style:italic">-- 111
</span></span></span><span style="display:flex;"><span><span style="color:#aaa;font-style:italic"></span>winner_drb<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#099">14</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>-[<span style="color:#bbb"> </span>RECORD<span style="color:#bbb"> </span><span style="color:#099">3</span><span style="color:#bbb"> </span>]<span style="color:#aaa;font-style:italic">----------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#aaa;font-style:italic"></span><span style="color:#0aa">date</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#099">1998</span>-<span style="color:#099">03</span>-<span style="color:#099">31</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#00a">host</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span>Vancouver<span style="color:#bbb"> </span>Grizzlies<span style="color:#bbb"> </span><span style="color:#aaa;font-style:italic">-- 101
</span></span></span><span style="display:flex;"><span><span style="color:#aaa;font-style:italic"></span>guest<span style="color:#bbb">      </span>|<span style="color:#bbb"> </span>Dallas<span style="color:#bbb"> </span>Mavericks<span style="color:#bbb"> </span><span style="color:#aaa;font-style:italic">-- 104
</span></span></span><span style="display:flex;"><span><span style="color:#aaa;font-style:italic"></span>winner_drb<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#099">14</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>-[<span style="color:#bbb"> </span>RECORD<span style="color:#bbb"> </span><span style="color:#099">4</span><span style="color:#bbb"> </span>]<span style="color:#aaa;font-style:italic">----------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#aaa;font-style:italic"></span><span style="color:#0aa">date</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#099">2009</span>-<span style="color:#099">01</span>-<span style="color:#099">14</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#00a">host</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#00a">New</span><span style="color:#bbb"> </span>York<span style="color:#bbb"> </span>Knicks<span style="color:#bbb"> </span><span style="color:#aaa;font-style:italic">-- 128
</span></span></span><span style="display:flex;"><span><span style="color:#aaa;font-style:italic"></span>guest<span style="color:#bbb">      </span>|<span style="color:#bbb"> </span>Washington<span style="color:#bbb"> </span>Wizards<span style="color:#bbb"> </span><span style="color:#aaa;font-style:italic">-- 122
</span></span></span><span style="display:flex;"><span><span style="color:#aaa;font-style:italic"></span>winner_drb<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#099">14</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>Time:<span style="color:#bbb"> </span><span style="color:#099">126</span>.<span style="color:#099">276</span><span style="color:#bbb"> </span>ms<span style="color:#bbb">
</span></span></span></code></pre></div><p>To understand all there&rsquo;s to know about
<em>window functions</em>, have a look at my
article on the topic:
<a href="/blog/2013/08/20-Window-Functions">Understanding Window Functions</a>.</p>
<h2 id="total-rebounds-and-wins">Total rebounds and wins</h2>
<p>The next interesting aside is the following:</p>
<blockquote>
<p>As an aside, the Cleveland Cavaliers beat the New York Knicks 101-97 on
April 11, 1996, despite recording only 21 total rebounds. Inversely, the San
Antonio Spurs lost to the Houston Rockets, 112-110, on January 4, 1992
despite recording 75 total rebounds.</p>
</blockquote>
<p>Which we translate in SQL as the following query:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#00a">with</span><span style="color:#bbb"> </span>stats<span style="color:#bbb"> </span><span style="color:#00a">as</span><span style="color:#bbb"> </span>(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#00a">select</span><span style="color:#bbb"> </span>ts.game,<span style="color:#bbb"> </span>ts.team,<span style="color:#bbb"> </span>trb,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">           </span><span style="color:#00a">min</span>(trb)<span style="color:#bbb"> </span>over<span style="color:#bbb"> </span>()<span style="color:#bbb"> </span><span style="color:#00a">as</span><span style="color:#bbb"> </span><span style="color:#00a">min</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">           </span><span style="color:#00a">max</span>(trb)<span style="color:#bbb"> </span>over<span style="color:#bbb"> </span>()<span style="color:#bbb"> </span><span style="color:#00a">as</span><span style="color:#bbb"> </span><span style="color:#00a">max</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#00a">from</span><span style="color:#bbb"> </span>team_stats<span style="color:#bbb"> </span>ts<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">           </span><span style="color:#00a">join</span><span style="color:#bbb"> </span>winners<span style="color:#bbb"> </span>w<span style="color:#bbb"> </span><span style="color:#00a">on</span><span style="color:#bbb"> </span>w.id<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>ts.game<span style="color:#bbb"> </span><span style="color:#00a">and</span><span style="color:#bbb"> </span>w.winner<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>ts.team<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#00a">select</span><span style="color:#bbb"> </span>game.<span style="color:#0aa">date</span>::<span style="color:#0aa">date</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">       </span><span style="color:#00a">host</span>.name<span style="color:#bbb"> </span>||<span style="color:#bbb"> </span><span style="color:#a50">&#39; -- &#39;</span><span style="color:#bbb"> </span>||<span style="color:#bbb"> </span>host_score<span style="color:#bbb"> </span><span style="color:#00a">as</span><span style="color:#bbb"> </span><span style="color:#00a">host</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">       </span>guest.name<span style="color:#bbb"> </span>||<span style="color:#bbb"> </span><span style="color:#a50">&#39; -- &#39;</span><span style="color:#bbb"> </span>||<span style="color:#bbb"> </span>guest_score<span style="color:#bbb"> </span><span style="color:#00a">as</span><span style="color:#bbb"> </span>guest,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">       </span>stats.trb<span style="color:#bbb"> </span><span style="color:#00a">as</span><span style="color:#bbb"> </span>winner_trb<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#00a">from</span><span style="color:#bbb"> </span>stats<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">       </span><span style="color:#00a">join</span><span style="color:#bbb"> </span>game<span style="color:#bbb"> </span><span style="color:#00a">on</span><span style="color:#bbb"> </span>game.id<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>stats.game<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">       </span><span style="color:#00a">join</span><span style="color:#bbb"> </span>team<span style="color:#bbb"> </span><span style="color:#00a">host</span><span style="color:#bbb"> </span><span style="color:#00a">on</span><span style="color:#bbb"> </span><span style="color:#00a">host</span>.id<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>game.<span style="color:#00a">host</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">       </span><span style="color:#00a">join</span><span style="color:#bbb"> </span>team<span style="color:#bbb"> </span>guest<span style="color:#bbb"> </span><span style="color:#00a">on</span><span style="color:#bbb"> </span>guest.id<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>game.guest<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span><span style="color:#00a">where</span><span style="color:#bbb"> </span>trb<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span><span style="color:#00a">min</span><span style="color:#bbb"> </span><span style="color:#00a">or</span><span style="color:#bbb"> </span>trb<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span><span style="color:#00a">max</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>-[<span style="color:#bbb"> </span>RECORD<span style="color:#bbb"> </span><span style="color:#099">1</span><span style="color:#bbb"> </span>]<span style="color:#aaa;font-style:italic">--------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#aaa;font-style:italic"></span><span style="color:#0aa">date</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#099">1995</span>-<span style="color:#099">12</span>-<span style="color:#099">28</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#00a">host</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span>Dallas<span style="color:#bbb"> </span>Mavericks<span style="color:#bbb"> </span><span style="color:#aaa;font-style:italic">-- 103
</span></span></span><span style="display:flex;"><span><span style="color:#aaa;font-style:italic"></span>guest<span style="color:#bbb">      </span>|<span style="color:#bbb"> </span>Vancouver<span style="color:#bbb"> </span>Grizzlies<span style="color:#bbb"> </span><span style="color:#aaa;font-style:italic">-- 101
</span></span></span><span style="display:flex;"><span><span style="color:#aaa;font-style:italic"></span>winner_trb<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#099">76</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>-[<span style="color:#bbb"> </span>RECORD<span style="color:#bbb"> </span><span style="color:#099">2</span><span style="color:#bbb"> </span>]<span style="color:#aaa;font-style:italic">--------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#aaa;font-style:italic"></span><span style="color:#0aa">date</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#099">1996</span>-<span style="color:#099">04</span>-<span style="color:#099">11</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#00a">host</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#00a">New</span><span style="color:#bbb"> </span>York<span style="color:#bbb"> </span>Knicks<span style="color:#bbb"> </span><span style="color:#aaa;font-style:italic">-- 97
</span></span></span><span style="display:flex;"><span><span style="color:#aaa;font-style:italic"></span>guest<span style="color:#bbb">      </span>|<span style="color:#bbb"> </span>Cleveland<span style="color:#bbb"> </span>Cavaliers<span style="color:#bbb"> </span><span style="color:#aaa;font-style:italic">-- 101
</span></span></span><span style="display:flex;"><span><span style="color:#aaa;font-style:italic"></span>winner_trb<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#099">21</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>-[<span style="color:#bbb"> </span>RECORD<span style="color:#bbb"> </span><span style="color:#099">3</span><span style="color:#bbb"> </span>]<span style="color:#aaa;font-style:italic">--------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#aaa;font-style:italic"></span><span style="color:#0aa">date</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#099">2007</span>-<span style="color:#099">01</span>-<span style="color:#099">29</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#00a">host</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span>Utah<span style="color:#bbb"> </span>Jazz<span style="color:#bbb"> </span><span style="color:#aaa;font-style:italic">-- 115
</span></span></span><span style="display:flex;"><span><span style="color:#aaa;font-style:italic"></span>guest<span style="color:#bbb">      </span>|<span style="color:#bbb"> </span><span style="color:#00a">New</span><span style="color:#bbb"> </span>Jersey<span style="color:#bbb"> </span>Nets<span style="color:#bbb"> </span><span style="color:#aaa;font-style:italic">-- 116
</span></span></span><span style="display:flex;"><span><span style="color:#aaa;font-style:italic"></span>winner_trb<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#099">21</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>Time:<span style="color:#bbb"> </span><span style="color:#099">127</span>.<span style="color:#099">771</span><span style="color:#bbb"> </span>ms<span style="color:#bbb">
</span></span></span></code></pre></div><p>Again it&rsquo;s easy enough in SQL to have more details about the
<em>aside</em> presented
in our source article, and we get a slightly different story.</p>
<h2 id="conclusion">Conclusion</h2>
<p>It&rsquo;s quite hard for me to appreciate the work done in the
<em>MongoDB
aggregation framework</em> really, when we&rsquo;ve been enjoying advanced aggregation
and statistics in
<a href="http://www.postgresql.org/">PostgreSQL</a> for a very long time. With the addition of
<a href="http://www.postgresql.org/docs/9.3/static/tutorial-window.html">Window Functions</a> and
<a href="http://www.postgresql.org/docs/9.3/static/functions-aggregate.html#FUNCTIONS-AGGREGATE-STATISTICS-TABLE">Aggregate Functions for Statistics</a> it&rsquo;s possible to
implement advanced analysis right into your SQL queries.</p>



<div class="figure fig25 right dim-margin" >
  
    <img class="fig-img" src="/img/old/sql-logo.png"  alt="PostgreSQL is YeSQL">
  
   
    <span class="caption">PostgreSQL is YeSQL</span>
  
</div>

<p>In next PostgreSQL release the set of analytical functions is going to
expand again with the addition of both
<a href="http://www.postgresql.org/docs/devel/static/functions-aggregate.html#FUNCTIONS-ORDEREDSET-TABLE">Ordered-Set Aggregate Functions</a> (also
known as
<em>inverse distribution</em> functions) and
<a href="http://www.postgresql.org/docs/devel/static/functions-aggregate.html#FUNCTIONS-HYPOTHETICAL-TABLE">Hypothetical-Set Aggregate Functions</a> (also known as
<code>WITHIN GROUP</code>).</p>
<p>When the problem you have to solve involves analyzing data, one of the more
advanced tooling you can find around certainly is the SQL language, in
particular its implementation in PostgreSQL!</p>
              


            </div>
          </div>
          





<div style="margin-top: 1em;">
 <script async src="//tinder.thrivecart.com/embed/v1/thrivecart.js"></script>
 <a data-thrivecart-account="theartofpostgresql" data-thrivecart-tpl="v2" data-thrivecart-product="18" class="thrivecart-button ">
  <img src="https://spark.thrivecart.com/0x0/https%3A%2F%2Fthrivecart.s3.amazonaws.com%2Fuser_assets%2FNABJ5K7H%2Fproducts%2F18%2Ftaopg-cta-1661268188.jpg"
       style="width:90%; height: auto; margin-left: 5%"/>
 </a>
</div>

          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small"></span><br/>
                    
  <a class="tag tag--primary tag--small" href="/tags/postgresql/">PostgreSQL</a>

  <a class="tag tag--primary tag--small" href="/tags/mongodb/">MongoDB</a>

  <a class="tag tag--primary tag--small" href="/tags/yesql/">YeSQL</a>

  <a class="tag tag--primary tag--small" href="/tags/statistics/">Statistics</a>

                  </div>
                
              
            
            <div class="post-actions-wrap">
 <nav>
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="/blog/2014/02/postgresql-aggregates-and-histograms/" data-tooltip="PostgreSQL, Aggregates and Histograms">
          
            <i class="fa fa-angle-left"></i>
            <span class="hide-xs hide-sm text-small icon-ml"></span>
          </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="/blog/2014/02/postgresql-fosdem-conference/" data-tooltip="PostgreSQL FOSDEM Conference">
          
            <span class="hide-xs hide-sm text-small icon-mr"></span>
            <i class="fa fa-angle-right"></i>
          </a>
        </li>
      
    </ul>
  </nav>
  <ul class="post-actions post-action-share">
    
      <li class="post-action hide-lg hide-md hide-sm">
        <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
          <i class="fa fa-share-alt"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https%3a%2f%2ftapoueh.org%2fblog%2f2014%2f02%2faggregating-nba-data-postgresql-vs-mongodb%2f">
          <i class="fa fa-google-plus"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ftapoueh.org%2fblog%2f2014%2f02%2faggregating-nba-data-postgresql-vs-mongodb%2f">
          <i class="fa fa-facebook-official"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Aggregating%20NBA%20data%2c%20PostgreSQL%20vs%20MongoDB with @tapoueh: https%3a%2f%2ftapoueh.org%2fblog%2f2014%2f02%2faggregating-nba-data-postgresql-vs-mongodb%2f">
          <i class="fa fa-twitter"></i>
        </a>
      </li>
    
    
      <li class="post-action">
        <a class="post-action-btn btn btn--default" href="#disqus_thread">
          <i class="fa fa-comment-o"></i>
        </a>
      </li>
    
    <li class="post-action">
      
        <a class="post-action-btn btn btn--default" href="#table-of-contents">
      
        <i class="fa fa-list"></i>
      </a>
    </li>
  </ul>
</div>


            
              
                <div id="disqus_thread">
  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2022 Dimitri Fontaine. 
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
        <div class="post-actions-wrap">
 <nav>
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="/blog/2014/02/postgresql-aggregates-and-histograms/" data-tooltip="PostgreSQL, Aggregates and Histograms">
          
            <i class="fa fa-angle-left"></i>
            <span class="hide-xs hide-sm text-small icon-ml"></span>
          </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="/blog/2014/02/postgresql-fosdem-conference/" data-tooltip="PostgreSQL FOSDEM Conference">
          
            <span class="hide-xs hide-sm text-small icon-mr"></span>
            <i class="fa fa-angle-right"></i>
          </a>
        </li>
      
    </ul>
  </nav>
  <ul class="post-actions post-action-share">
    
      <li class="post-action hide-lg hide-md hide-sm">
        <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
          <i class="fa fa-share-alt"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https%3a%2f%2ftapoueh.org%2fblog%2f2014%2f02%2faggregating-nba-data-postgresql-vs-mongodb%2f">
          <i class="fa fa-google-plus"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ftapoueh.org%2fblog%2f2014%2f02%2faggregating-nba-data-postgresql-vs-mongodb%2f">
          <i class="fa fa-facebook-official"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Aggregating%20NBA%20data%2c%20PostgreSQL%20vs%20MongoDB with @tapoueh: https%3a%2f%2ftapoueh.org%2fblog%2f2014%2f02%2faggregating-nba-data-postgresql-vs-mongodb%2f">
          <i class="fa fa-twitter"></i>
        </a>
      </li>
    
    
      <li class="post-action">
        <a class="post-action-btn btn btn--default" href="#disqus_thread">
          <i class="fa fa-comment-o"></i>
        </a>
      </li>
    
    <li class="post-action">
      
        <a class="post-action-btn btn btn--default" href="#table-of-contents">
      
        <i class="fa fa-list"></i>
      </a>
    </li>
  </ul>
</div>


      </div>
      <div id="share-options-bar" class="share-options-bar" data-behavior="5">
  <ul class="share-options">
    <li class="share-option">
      <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=https%3a%2f%2ftapoueh.org%2fblog%2f2014%2f02%2faggregating-nba-data-postgresql-vs-mongodb%2f">
        <i class="fa fa-google-plus"></i><span></span>
      </a>
    </li>
    <li class="share-option">
      <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ftapoueh.org%2fblog%2f2014%2f02%2faggregating-nba-data-postgresql-vs-mongodb%2f">
        <i class="fa fa-facebook-official"></i><span></span>
      </a>
    </li>
    <li class="share-option">
      <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=Aggregating%20NBA%20data%2c%20PostgreSQL%20vs%20MongoDB with @tapoueh: https%3a%2f%2ftapoueh.org%2fblog%2f2014%2f02%2faggregating-nba-data-postgresql-vs-mongodb%2f">
        <i class="fa fa-twitter"></i><span></span>
      </a>
    </li>
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>

    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-times"></i>
    </div>
    
      <img id="about-card-picture" src="//www.gravatar.com/avatar/7b615d104c506aa0a49e17151fa94d9f?s=110" alt="" />
    
    <h4 id="about-card-name">Dimitri Fontaine</h4>
    
      <div id="about-card-bio">PostgreSQL Major Contributor</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Open Source Software Engineer
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker-alt"></i>
        <br/>
        France
      </div>
    
  </div>
</div>

    

    
  
    
      
      <div id="cover" style="background-image:url('https://tapoueh.org/images/mayan-calendar.jpg');"></div>
    
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/highlight.min.js" integrity="sha512-z+/WWfyD5tccCukM4VvONpEtLmbAm5LDu7eKiyMQJ9m7OfPEDL7gENyDRL3Yfe8XAuGsS2fS4xSMnl6d30kqGQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha512-uURl+ZXMBrF4AwGaWmEetzrd+J5/8NRkWAvJx5sbPSSuOb0bZLqf+tOzniObO00BjHa/dD7gub9oCGMLPQHtQA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


<script src="https://tapoueh.org/js/script-yqzy9wdlzix4lbbwdnzvwx3egsne77earqmn73v9uno8aupuph8wfguccut.min.js"></script>



<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight > code, pre > code').each(function(i, block) {
    if (!$(this).hasClass('codeblock')) {
      $(this).addClass('codeblock');
    }
    hljs.highlightBlock(block);
  });
});
</script>




    
  </body>
</html>

