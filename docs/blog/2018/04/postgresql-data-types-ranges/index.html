

  
    
  


  




  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Hugo 0.89.3">
    <meta name="theme" content="Tranquilpeak 0.3.1-BETA">
    <title>PostgreSQL Data Types: Ranges</title>
    <meta name="author" content="Dimitri Fontaine">
    <meta name="keywords" content="">

    <link rel="icon" href="/favicon.ico">
    

    
    <meta name="description" content="Continuing our series of PostgreSQL Data Types today
we&rsquo;re going to introduce the PostgreSQL ranges data type.
Range types are a unique feature of PostgreSQL, managing two dimensions of
data in a single column, and allowing advanced processing. The main example
is the daterange data type, which stores as a single value a lower and an
upper bound of the range as a single value. This allows PostgreSQL to
implement a concurrent safe check against overlapping ranges, as we&rsquo;re
going to see in this article.">
    <meta property="og:description" content="Continuing our series of PostgreSQL Data Types today
we&rsquo;re going to introduce the PostgreSQL ranges data type.
Range types are a unique feature of PostgreSQL, managing two dimensions of
data in a single column, and allowing advanced processing. The main example
is the daterange data type, which stores as a single value a lower and an
upper bound of the range as a single value. This allows PostgreSQL to
implement a concurrent safe check against overlapping ranges, as we&rsquo;re
going to see in this article.">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="PostgreSQL Data Types: Ranges">
    <meta property="og:url" content="https://tapoueh.org/blog/2018/04/postgresql-data-types-ranges/">
    <meta property="og:site_name" content="The Art of PostgreSQL">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="PostgreSQL Data Types: Ranges">
    <meta name="twitter:description" content="Continuing our series of PostgreSQL Data Types today
we&rsquo;re going to introduce the PostgreSQL ranges data type.
Range types are a unique feature of PostgreSQL, managing two dimensions of
data in a single column, and allowing advanced processing. The main example
is the daterange data type, which stores as a single value a lower and an
upper bound of the range as a single value. This allows PostgreSQL to
implement a concurrent safe check against overlapping ranges, as we&rsquo;re
going to see in this article.">
    
      <meta name="twitter:creator" content="@tapoueh">
    
    

    
    

    
      <meta property="og:image" content="//www.gravatar.com/avatar/7b615d104c506aa0a49e17151fa94d9f?s=640">
    

    
      <meta property="og:image" content="https://tapoueh.org/img/reloading-timer-clock-icon-by-vexels.png">
    
    
      <meta property="og:image" content="https://tapoueh.org/img/pulse-of-the-city-1-thumb-620x620-27919.jpg">
    
    

    

    
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.css" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" />
    
    
    <link rel="stylesheet" href="/css/style-jsjn0006wyhpyzivf6yceb31gvpjatbcs3qzjvlumobfnugccvobqwxnnaj8.min.css" />
    
    
      <link rel="stylesheet" href="https://tapoueh.org/css/dim.css">
    
      <link rel="stylesheet" href="https://tapoueh.org/css/nav.css">
    

    
      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-47059482-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="5">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="navbar-collapse collapse header-title" id="navigation">
    <ul class="nav navbar-nav navbar-right">
      
      <li class="dropdown">
        
        <a style="color: black;" href="/" alt="blog"><i class="sidebar-button-icon fa fa-lg fa-home"></i></a>
        
      </li>
      
      <li class="dropdown">
        
        <a style="color: black;" href="/conf/" alt="talks"><i class="sidebar-button-icon fa fa-lg fa-microphone"></i></a>
        
      </li>
      
      <li class="dropdown">
        
        <a style="color: black;" href="https://twitter.com/tapoueh" alt="Twitter"><i class="sidebar-button-icon fa fa-lg fa-twitter"></i></a>
        
      </li>
      
      <li class="dropdown">
        
        <a style="color: black;" href="http://theartofpostgresql.com" alt="The Art Of PostgreSQL"><i class="sidebar-button-icon fa fa-lg fa-book"></i></a>
        
      </li>
      
    </ul>
  </div>

  
    
      <a class="header-right-icon "
         href="https://theartofpostgresql.com/" target="_blank">
    
    
      <i class="fa fa-lg fa-book"></i>
    
    
    </a>
  
</header>

      <nav id="sidebar" data-behavior="5">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="/#about" aria-label="">
          <img class="sidebar-profile-picture" src="//www.gravatar.com/avatar/7b615d104c506aa0a49e17151fa94d9f?s=110" alt="" />
        </a>
        <h4 class="sidebar-profile-name">Dimitri Fontaine</h4>
        
          <h5 class="sidebar-profile-bio">PostgreSQL Major Contributor</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/" title="Blog">
    
      <i class="sidebar-button-icon fa fa-lg fa-pagelines"></i>
      
      <span class="sidebar-button-desc">Blog</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/about/" title="About">
    
      <i class="sidebar-button-icon fa fa-lg fa-beer"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/categories/yesql/" title="YeSQL">
    
      <i class="sidebar-button-icon fa fa-lg fa-database"></i>
      
      <span class="sidebar-button-desc">YeSQL</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://theartofpostgresql.com" target="_blank" rel="noopener" title="The Art of PostgreSQL">
    
      <i class="sidebar-button-icon fa fa-lg fa-book"></i>
      
      <span class="sidebar-button-desc">The Art of PostgreSQL</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/dimitri" target="_blank" rel="noopener" title="GitHub">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://twitter.com/tapoueh" target="_blank" rel="noopener" title="Twitter">
    
      <i class="sidebar-button-icon fa fa-lg fa-twitter"></i>
      
      <span class="sidebar-button-desc">Twitter</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/categories" title="Categories">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/index.xml" title="RSS">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      
  <div class="post-header-cover
              text-left
              post-header-cover--partial"
       style="background-image:url('/img/pulse-of-the-city-1-thumb-620x620-27919.jpg')"
       data-behavior="5">
    
      <div class="post-header main-content-wrap text-left">
  
    <h1 class="post-title">
      PostgreSQL Data Types: Ranges
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time itemprop="datePublished" datetime="2018-04-18T13:41:12&#43;02:00">
        <span style="float: left; width: 35%">
          <i class="fa fa-calendar"></i> 
  
  
  
  
    Wednesday 18 Apr 2018
  

        </span>
      </time>
    
    <span style="float: right; width: 65%">
      <i class="fa fa-clock-o"></i> 4 mins read
      
    </span>
    <span style="float: left; width: 35%">
      <i class="fa fa-bookmark"></i> 
  
  
    <span></span>
    
      <a class="category-link" href="/categories/postgresql">PostgreSQL</a>, 
    
      <a class="category-link" href="/categories/yesql">YeSQL</a>
    
  

    </span>
    <div>
      <p>
        
        
        
        
        
        
        <a href="/tags/data-types/">
          <i class="fa fa-tag"></i> Data Types
        </a>
        
        
        
        <a href="/tags/ranges/">
          <i class="fa fa-tag"></i> Ranges
        </a>
        
        
        
        <a href="/tags/date-ranges/">
          <i class="fa fa-tag"></i> Date Ranges
        </a>
        
        
      </p>
    </div>
  </div>


</div>
    
  </div>


      <div id="main" data-behavior="5"
        class="hasCover
               hasCoverMetaIn
               ">
        <article class="post" itemscope itemType="http://schema.org/BlogPosting">
          
          
          <div class="post-content markdown" itemprop="articleBody">
            <div class="main-content-wrap">
              <p>Continuing our series of <a href="/tags/data-types/">PostgreSQL Data Types</a> today
we&rsquo;re going to introduce the PostgreSQL ranges data type.</p>
<p>Range types are a unique feature of PostgreSQL, managing two dimensions of
data in a single column, and allowing advanced processing. The main example
is the <em>daterange</em> data type, which stores as a single value a lower and an
upper bound of the range as a single value. This allows PostgreSQL to
implement a concurrent safe check against <em>overlapping</em> ranges, as we&rsquo;re
going to see in this article.</p>
 




<div class="table-of-contents toc bd-callout">
    
    <h4 class="text-muted">Table of Contents</h4>
    
        
        
            
                
                
                
                    <ul class="toc-h1">
                
                
                
                
                <li>
                  <a href="/blog/2018/04/postgresql-data-types-ranges/#ranges">
                    Ranges
                  </a>
                </li>
                
                
                    </ul>
                
            
        
    
        
        
            
                
                
                
                    <ul class="toc-h1">
                
                
                
                
                <li>
                  <a href="/blog/2018/04/postgresql-data-types-ranges/#ranges-exclusion-constraints">
                    Ranges Exclusion Constraints
                  </a>
                </li>
                
                
                    </ul>
                
            
        
    
        
        
            
                
                
                
                    <ul class="toc-h1">
                
                
                
                
                <li>
                  <a href="/blog/2018/04/postgresql-data-types-ranges/#querying-ranges">
                    Querying Ranges
                  </a>
                </li>
                
                
                    </ul>
                
            
        
    
        
        
            
                
                
                
                    <ul class="toc-h1">
                
                
                
                
                <li>
                  <a href="/blog/2018/04/postgresql-data-types-ranges/#conclusion">
                    Conclusion
                  </a>
                </li>
                
                
                    </ul>
                
            
        
    
</div>


<h2 id="ranges">Ranges</h2>
<p>As usual, read the PostgreSQL documentation chapters with the titles <a href="https://www.postgresql.org/docs/current/static/rangetypes.html">Range
Types</a> and
<a href="https://www.postgresql.org/docs/current/static/functions-range.html">Range Functions and
Operators</a>
for complete information.</p>
<p>The <a href="http://www.imf.org/external/index.htm">International Monetary Fund</a>
publishes <a href="https://www.imf.org/external/np/fin/data/param_rms_mth.aspx">exchange rate archives by
month</a> for lots
of currencies. An exchange rate is relevant from its publication until the
next rate is published, which makes a very good use case for our PostgreSQL
range types.</p>
<p>The following SQL script is the main part of the <em>ELT</em> script that has been
used for my book <a href="https://theartofpostgresql.com">The Art of PostgreSQL</a>.
Only missing from this book&rsquo;s pages is the transformation script that pivots
the available <em>tsv</em> file into the more interesting format we use here:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#00a">begin</span>;<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#00a">create</span><span style="color:#bbb"> </span><span style="color:#00a">schema</span><span style="color:#bbb"> </span><span style="color:#00a">if</span><span style="color:#bbb"> </span><span style="color:#00a">not</span><span style="color:#bbb"> </span><span style="color:#00a">exists</span><span style="color:#bbb"> </span>raw;<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#aaa;font-style:italic">-- Must be run as a Super User in your database instance
</span><span style="color:#aaa;font-style:italic">-- create extension if not exists btree_gist;
</span><span style="color:#aaa;font-style:italic"></span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#00a">drop</span><span style="color:#bbb"> </span><span style="color:#00a">table</span><span style="color:#bbb"> </span><span style="color:#00a">if</span><span style="color:#bbb"> </span><span style="color:#00a">exists</span><span style="color:#bbb"> </span>raw.rates,<span style="color:#bbb"> </span>rates;<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#00a">create</span><span style="color:#bbb"> </span><span style="color:#00a">table</span><span style="color:#bbb"> </span>raw.rates<span style="color:#bbb">
</span><span style="color:#bbb"> </span>(<span style="color:#bbb">
</span><span style="color:#bbb">  </span>currency<span style="color:#bbb"> </span><span style="color:#0aa">text</span>,<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#0aa">date</span><span style="color:#bbb">     </span><span style="color:#0aa">date</span>,<span style="color:#bbb">
</span><span style="color:#bbb">  </span>rate<span style="color:#bbb">     </span><span style="color:#0aa">numeric</span><span style="color:#bbb">
</span><span style="color:#bbb"> </span>);<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#f00;background-color:#faa">\</span><span style="color:#00a">copy</span><span style="color:#bbb"> </span>raw.rates<span style="color:#bbb"> </span><span style="color:#00a">from</span><span style="color:#bbb"> </span><span style="color:#a50">&#39;rates.csv&#39;</span><span style="color:#bbb"> </span><span style="color:#00a">with</span><span style="color:#bbb"> </span>csv<span style="color:#bbb"> </span><span style="color:#00a">delimiter</span><span style="color:#bbb"> </span><span style="color:#a50">&#39;;&#39;</span><span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#00a">create</span><span style="color:#bbb"> </span><span style="color:#00a">table</span><span style="color:#bbb"> </span>rates<span style="color:#bbb">
</span><span style="color:#bbb"> </span>(<span style="color:#bbb">
</span><span style="color:#bbb">  </span>currency<span style="color:#bbb"> </span><span style="color:#0aa">text</span>,<span style="color:#bbb">
</span><span style="color:#bbb">  </span>validity<span style="color:#bbb"> </span>daterange,<span style="color:#bbb">
</span><span style="color:#bbb">  </span>rate<span style="color:#bbb">     </span><span style="color:#0aa">numeric</span>,<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>exclude<span style="color:#bbb"> </span><span style="color:#00a">using</span><span style="color:#bbb"> </span>gist<span style="color:#bbb"> </span>(currency<span style="color:#bbb"> </span><span style="color:#00a">with</span><span style="color:#bbb"> </span>=,<span style="color:#bbb">
</span><span style="color:#bbb">                      </span>validity<span style="color:#bbb"> </span><span style="color:#00a">with</span><span style="color:#bbb"> </span>&amp;&amp;)<span style="color:#bbb">
</span><span style="color:#bbb"> </span>);<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#00a">insert</span><span style="color:#bbb"> </span><span style="color:#00a">into</span><span style="color:#bbb"> </span>rates(currency,<span style="color:#bbb"> </span>validity,<span style="color:#bbb"> </span>rate)<span style="color:#bbb">
</span><span style="color:#bbb">     </span><span style="color:#00a">select</span><span style="color:#bbb"> </span>currency,<span style="color:#bbb">
</span><span style="color:#bbb">            </span>daterange(<span style="color:#0aa">date</span>,<span style="color:#bbb">
</span><span style="color:#bbb">                      </span>lead(<span style="color:#0aa">date</span>)<span style="color:#bbb"> </span>over(partition<span style="color:#bbb"> </span><span style="color:#00a">by</span><span style="color:#bbb"> </span>currency<span style="color:#bbb">
</span><span style="color:#bbb">                                          </span><span style="color:#00a">order</span><span style="color:#bbb"> </span><span style="color:#00a">by</span><span style="color:#bbb"> </span><span style="color:#0aa">date</span>),<span style="color:#bbb">
</span><span style="color:#bbb">                      </span><span style="color:#a50">&#39;[)&#39;</span><span style="color:#bbb">
</span><span style="color:#bbb">                     </span>)<span style="color:#bbb">
</span><span style="color:#bbb">            </span><span style="color:#00a">as</span><span style="color:#bbb"> </span>validity,<span style="color:#bbb">
</span><span style="color:#bbb">            </span>rate<span style="color:#bbb">
</span><span style="color:#bbb">       </span><span style="color:#00a">from</span><span style="color:#bbb"> </span>raw.rates<span style="color:#bbb">
</span><span style="color:#bbb">   </span><span style="color:#00a">order</span><span style="color:#bbb"> </span><span style="color:#00a">by</span><span style="color:#bbb"> </span><span style="color:#0aa">date</span>;<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#00a">commit</span>;<span style="color:#bbb">
</span></code></pre></div><p>In this SQL script, we first create a target table for loading the CSV file.
The file contains lines with a currency name, a date of publication, and a
rate as a <em>numeric</em> value. Once the data is loaded into this table, we can
transform it into something more interesting to work with from an
application, the <em>rates</em> table.</p>
<h2 id="ranges-exclusion-constraints">Ranges Exclusion Constraints</h2>
<p>The <em>rates</em> table registers the rate value for a currency and a <em>validity</em>
period, and uses an <a href="https://www.postgresql.org/docs/current/static/sql-createtable.html#SQL-CREATETABLE-EXCLUDE">exclusion
constraint</a>
that guarantees non-overlapping <em>validity</em> periods for any given <em>currency</em>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">exclude<span style="color:#bbb"> </span><span style="color:#00a">using</span><span style="color:#bbb"> </span>gist<span style="color:#bbb"> </span>(currency<span style="color:#bbb"> </span><span style="color:#00a">with</span><span style="color:#bbb"> </span>=,<span style="color:#bbb"> </span>validity<span style="color:#bbb"> </span><span style="color:#00a">with</span><span style="color:#bbb"> </span>&amp;&amp;)<span style="color:#bbb">
</span></code></pre></div><p>This expression reads: exclude any tuple where the currency is <em>=</em> to an
existing currency in our table <em>AND</em> where the <em>validity</em> is overlapping
with (<em>&amp;&amp;</em>) any existing validity in our table. This exclusion constraint is
implemented in PostgreSQL using a <em>GiST</em> index.</p>
<p>By default, <em>GiST</em> in PostgreSQL doesn&rsquo;t support one-dimensional data types
that are meant to be covered by <em>B-tree</em> indexes. With exclusion constraints
though, it&rsquo;s very interesting to extend <em>GiST</em> support for one-dimensional
data types, and so we install the <em>btree_gist</em> extension, provided in
PostgreSQL contrib package.</p>
<p>The script then fills in the <em>rates</em> table from the <em>raw.rates</em> we&rsquo;d been
importing in the previous step. The query uses the <em>lead()</em> window function
to implement the specification spelled out in English earlier: <em>an exchange
rate is relevant from its publication until the next rate is published</em>.</p>
<h2 id="querying-ranges">Querying Ranges</h2>
<p>Here&rsquo;s how the data looks, with the following query targeting Euro rates:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#bbb">  </span><span style="color:#00a">select</span><span style="color:#bbb"> </span>currency,<span style="color:#bbb"> </span>validity,<span style="color:#bbb"> </span>rate<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#00a">from</span><span style="color:#bbb"> </span>rates<span style="color:#bbb">
</span><span style="color:#bbb">   </span><span style="color:#00a">where</span><span style="color:#bbb"> </span>currency<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span><span style="color:#a50">&#39;Euro&#39;</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#00a">order</span><span style="color:#bbb"> </span><span style="color:#00a">by</span><span style="color:#bbb"> </span>validity<span style="color:#bbb">
</span><span style="color:#bbb">   </span><span style="color:#00a">limit</span><span style="color:#bbb"> </span><span style="color:#099">10</span>;<span style="color:#bbb">
</span></code></pre></div><p>We can see that the validity is a range of dates, and the standard output
for this type is a closed range which includes the first entry and excludes
the second one:</p>
<pre tabindex="0"><code class="language-psql" data-lang="psql"> currency │        validity         │   rate   
══════════╪═════════════════════════╪══════════
 Euro     │ [2017-05-02,2017-05-03) │ 1.254600
 Euro     │ [2017-05-03,2017-05-04) │ 1.254030
 Euro     │ [2017-05-04,2017-05-05) │ 1.252780
 Euro     │ [2017-05-05,2017-05-08) │ 1.250510
 Euro     │ [2017-05-08,2017-05-09) │ 1.252880
 Euro     │ [2017-05-09,2017-05-10) │ 1.255280
 Euro     │ [2017-05-10,2017-05-11) │ 1.255300
 Euro     │ [2017-05-11,2017-05-12) │ 1.257320
 Euro     │ [2017-05-12,2017-05-15) │ 1.255530
 Euro     │ [2017-05-15,2017-05-16) │ 1.248960
(10 rows)
</code></pre><p>Having this data set with the exclusion constraint means that we know we
have at most a single rate available at any point in time, which allows an
application needing the rate for a specific time to write the following
query:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#00a">select</span><span style="color:#bbb"> </span>rate<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#00a">from</span><span style="color:#bbb"> </span>rates<span style="color:#bbb">
</span><span style="color:#bbb"> </span><span style="color:#00a">where</span><span style="color:#bbb"> </span>currency<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span><span style="color:#a50">&#39;Euro&#39;</span><span style="color:#bbb"> 
</span><span style="color:#bbb">   </span><span style="color:#00a">and</span><span style="color:#bbb"> </span>validity<span style="color:#bbb"> </span>@&gt;<span style="color:#bbb"> </span><span style="color:#0aa">date</span><span style="color:#bbb"> </span><span style="color:#a50">&#39;2017-05-18&#39;</span>;<span style="color:#bbb">
</span></code></pre></div><p>The operator <em>@&gt;</em> reads <em>contains</em>, and PostgreSQL uses the exclusion
constraint&rsquo;s index to solve that query efficiently:</p>
<pre tabindex="0"><code class="language-psql" data-lang="psql">   rate   
══════════
 1.240740
(1 row)
</code></pre><h2 id="conclusion">Conclusion</h2>
<p>PostgreSQL has support for more than date ranges, ranges of numbers are also
suppored. While it&rsquo;s possible to manually manage the lower and upper bounds
of the ranges in one&rsquo;s own application code, it&rsquo;s almost impossible to deal
with the concurrency issues right when dealing with non-overlapping ranges.</p>
<p>Think about it that way: a user inserts a new value in you table, and its
lower and upper bounds are not overlapping any other value in your table, so
it&rsquo;s fine. But in between when you check for that, from the application
code, and when you INSERT your new entry, a concurrent user does the same
thing, with a range that overlapps the first one being inserted. As the
first user&rsquo;s new range is not inserted yet, the check passes. And now you
insert two overlapping ranges. Ooops.</p>
<p>Rather than having to serialize all write access to the data set, PostgreSQL
indexes are allowed special visibility rules in order to guarantee unicity
at all times, and EXCLUDE USING is an extension of the unicity constraint:
it benefits from this capacity and guarantee your data set even when dealing
with concurrency updates to it!</p>
<p>This article is an extract from my book <a href="https://theartofpostgresql.com">The Art of
PostgreSQL</a>, which teaches SQL to developers
so that they may replace thousands of lines of code with very simple
queries. The book has a full chapter about data types in PostgreSQL, check
it out!</p>
              


            </div>
          </div>
          <div style="margin-top: 1em;">
 <a href="https://theartofpostgresql.com" alt="The Art of PostgreSQL">
  <img src="/img/taopg-cta.jpg" style="width:90%; height: auto; margin-left: 5%">
 </a>
</div>

          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small"></span><br/>
                    
  <a class="tag tag--primary tag--small" href="/tags/postgresql/">PostgreSQL</a>

  <a class="tag tag--primary tag--small" href="/tags/yesql/">YeSQL</a>

  <a class="tag tag--primary tag--small" href="/tags/data-types/">Data Types</a>

  <a class="tag tag--primary tag--small" href="/tags/ranges/">Ranges</a>

  <a class="tag tag--primary tag--small" href="/tags/date-ranges/">Date Ranges</a>

                  </div>
                
              
            
            <div class="post-actions-wrap">
 <nav>
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="/blog/2018/04/postgresql-data-types-arrays/" data-tooltip="PostgreSQL Data Types: Arrays">
          
            <i class="fa fa-angle-left"></i>
            <span class="hide-xs hide-sm text-small icon-ml"></span>
          </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="/blog/2018/04/postgresql-data-types-network-addresses/" data-tooltip="PostgreSQL Data Types: Network Addresses">
          
            <span class="hide-xs hide-sm text-small icon-mr"></span>
            <i class="fa fa-angle-right"></i>
          </a>
        </li>
      
    </ul>
  </nav>
  <ul class="post-actions post-action-share">
    
      <li class="post-action hide-lg hide-md hide-sm">
        <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
          <i class="fa fa-share-alt"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https%3a%2f%2ftapoueh.org%2fblog%2f2018%2f04%2fpostgresql-data-types-ranges%2f">
          <i class="fa fa-google-plus"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ftapoueh.org%2fblog%2f2018%2f04%2fpostgresql-data-types-ranges%2f">
          <i class="fa fa-facebook-official"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=PostgreSQL%20Data%20Types%3a%20Ranges with @tapoueh: https%3a%2f%2ftapoueh.org%2fblog%2f2018%2f04%2fpostgresql-data-types-ranges%2f">
          <i class="fa fa-twitter"></i>
        </a>
      </li>
    
    
      <li class="post-action">
        <a class="post-action-btn btn btn--default" href="#disqus_thread">
          <i class="fa fa-comment-o"></i>
        </a>
      </li>
    
    <li class="post-action">
      
        <a class="post-action-btn btn btn--default" href="#table-of-contents">
      
        <i class="fa fa-list"></i>
      </a>
    </li>
  </ul>
</div>


            
              
                <div id="disqus_thread">
  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2021 Dimitri Fontaine. 
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
        <div class="post-actions-wrap">
 <nav>
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="/blog/2018/04/postgresql-data-types-arrays/" data-tooltip="PostgreSQL Data Types: Arrays">
          
            <i class="fa fa-angle-left"></i>
            <span class="hide-xs hide-sm text-small icon-ml"></span>
          </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="/blog/2018/04/postgresql-data-types-network-addresses/" data-tooltip="PostgreSQL Data Types: Network Addresses">
          
            <span class="hide-xs hide-sm text-small icon-mr"></span>
            <i class="fa fa-angle-right"></i>
          </a>
        </li>
      
    </ul>
  </nav>
  <ul class="post-actions post-action-share">
    
      <li class="post-action hide-lg hide-md hide-sm">
        <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
          <i class="fa fa-share-alt"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https%3a%2f%2ftapoueh.org%2fblog%2f2018%2f04%2fpostgresql-data-types-ranges%2f">
          <i class="fa fa-google-plus"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ftapoueh.org%2fblog%2f2018%2f04%2fpostgresql-data-types-ranges%2f">
          <i class="fa fa-facebook-official"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=PostgreSQL%20Data%20Types%3a%20Ranges with @tapoueh: https%3a%2f%2ftapoueh.org%2fblog%2f2018%2f04%2fpostgresql-data-types-ranges%2f">
          <i class="fa fa-twitter"></i>
        </a>
      </li>
    
    
      <li class="post-action">
        <a class="post-action-btn btn btn--default" href="#disqus_thread">
          <i class="fa fa-comment-o"></i>
        </a>
      </li>
    
    <li class="post-action">
      
        <a class="post-action-btn btn btn--default" href="#table-of-contents">
      
        <i class="fa fa-list"></i>
      </a>
    </li>
  </ul>
</div>


      </div>
      <div id="share-options-bar" class="share-options-bar" data-behavior="5">
  <ul class="share-options">
    <li class="share-option">
      <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=https%3a%2f%2ftapoueh.org%2fblog%2f2018%2f04%2fpostgresql-data-types-ranges%2f">
        <i class="fa fa-google-plus"></i><span></span>
      </a>
    </li>
    <li class="share-option">
      <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ftapoueh.org%2fblog%2f2018%2f04%2fpostgresql-data-types-ranges%2f">
        <i class="fa fa-facebook-official"></i><span></span>
      </a>
    </li>
    <li class="share-option">
      <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=PostgreSQL%20Data%20Types%3a%20Ranges with @tapoueh: https%3a%2f%2ftapoueh.org%2fblog%2f2018%2f04%2fpostgresql-data-types-ranges%2f">
        <i class="fa fa-twitter"></i><span></span>
      </a>
    </li>
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>

    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-times"></i>
    </div>
    
      <img id="about-card-picture" src="//www.gravatar.com/avatar/7b615d104c506aa0a49e17151fa94d9f?s=110" alt="" />
    
    <h4 id="about-card-name">Dimitri Fontaine</h4>
    
      <div id="about-card-bio">PostgreSQL Major Contributor</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Open Source Software Engineer
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker-alt"></i>
        <br/>
        France
      </div>
    
  </div>
</div>

    

    
  
    
      
      <div id="cover" style="background-image:url('https://tapoueh.org/images/mayan-calendar.jpg');"></div>
    
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/highlight.min.js" integrity="sha512-z+/WWfyD5tccCukM4VvONpEtLmbAm5LDu7eKiyMQJ9m7OfPEDL7gENyDRL3Yfe8XAuGsS2fS4xSMnl6d30kqGQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha512-uURl+ZXMBrF4AwGaWmEetzrd+J5/8NRkWAvJx5sbPSSuOb0bZLqf+tOzniObO00BjHa/dD7gub9oCGMLPQHtQA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


<script src="https://tapoueh.org/js/script-yqzy9wdlzix4lbbwdnzvwx3egsne77earqmn73v9uno8aupuph8wfguccut.min.js"></script>



<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight > code, pre > code').each(function(i, block) {
    if (!$(this).hasClass('codeblock')) {
      $(this).addClass('codeblock');
    }
    hljs.highlightBlock(block);
  });
});
</script>




    
  </body>
</html>

