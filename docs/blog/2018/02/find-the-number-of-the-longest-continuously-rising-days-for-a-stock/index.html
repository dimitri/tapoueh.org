

  
    
  


  




  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Hugo 0.31.1">
    <meta name="theme" content="Tranquilpeak 0.3.1-BETA">
    <title>Find the number of the longest continuously rising days for a stock</title>
    <meta name="author" content="Dimitri Fontaine">
    <meta name="keywords" content="">

    <link rel="icon" href="/favicon.ico">
    

    
    <meta name="description" content="Today I want to react to an article that claims that Relational Algebra Is
the Root of SQL
Problems
in which the author hand-waves the following position:


SQL becomes more a hindrance to data manipulation than an efficient tool.
SQL’s greatest problem isn’t in the implementation level, but at its
theory foundation. The problem can’t be solved by application
optimization. Relational algebra isn’t sophisticated enough for handling
the complicated data manipulation scenarios.


Then they go on to several arguments from authority to “prove” their
point. My reading of the article is that SQL is very hard when you didn&rsquo;t
care to learn it, as most technologies are.

In this article, we&rsquo;re going to look at the simple examples provided where
apparently SQL makes it so much harder to find a solution compared to
writing some Java or C&#43;&#43; code. Contrary to the original article, we go as
far as to actually writing both the SQL solution and a complete Python
solution, so that we can compare.

">
    <meta property="og:description" content="Today I want to react to an article that claims that Relational Algebra Is
the Root of SQL
Problems
in which the author hand-waves the following position:


SQL becomes more a hindrance to data manipulation than an efficient tool.
SQL’s greatest problem isn’t in the implementation level, but at its
theory foundation. The problem can’t be solved by application
optimization. Relational algebra isn’t sophisticated enough for handling
the complicated data manipulation scenarios.


Then they go on to several arguments from authority to “prove” their
point. My reading of the article is that SQL is very hard when you didn&rsquo;t
care to learn it, as most technologies are.

In this article, we&rsquo;re going to look at the simple examples provided where
apparently SQL makes it so much harder to find a solution compared to
writing some Java or C&#43;&#43; code. Contrary to the original article, we go as
far as to actually writing both the SQL solution and a complete Python
solution, so that we can compare.

">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Find the number of the longest continuously rising days for a stock">
    <meta property="og:url" content="/blog/2018/02/find-the-number-of-the-longest-continuously-rising-days-for-a-stock/">
    <meta property="og:site_name" content="Dimitri Fontaine, PostgreSQL Expert">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Find the number of the longest continuously rising days for a stock">
    <meta name="twitter:description" content="Today I want to react to an article that claims that Relational Algebra Is
the Root of SQL
Problems
in which the author hand-waves the following position:


SQL becomes more a hindrance to data manipulation than an efficient tool.
SQL’s greatest problem isn’t in the implementation level, but at its
theory foundation. The problem can’t be solved by application
optimization. Relational algebra isn’t sophisticated enough for handling
the complicated data manipulation scenarios.


Then they go on to several arguments from authority to “prove” their
point. My reading of the article is that SQL is very hard when you didn&rsquo;t
care to learn it, as most technologies are.

In this article, we&rsquo;re going to look at the simple examples provided where
apparently SQL makes it so much harder to find a solution compared to
writing some Java or C&#43;&#43; code. Contrary to the original article, we go as
far as to actually writing both the SQL solution and a complete Python
solution, so that we can compare.

">
    
      <meta name="twitter:creator" content="@tapoueh">
    
    

    
    

    
      <meta property="og:image" content="//www.gravatar.com/avatar/7b615d104c506aa0a49e17151fa94d9f?s=640">
    

    
      <meta property="og:image" content="https://tapoueh.org/img/growing-stock-icon.jpg">
    
    
      <meta property="og:image" content="https://tapoueh.org/img/stocks-on-the-rise.jpg">
    
    

    

    
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.css" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" />
    
    
    <link rel="stylesheet" href="/css/style-jsjn0006wyhpyzivf6yceb31gvpjatbcs3qzjvlumobfnugccvobqwxnnaj8.min.css" />
    
    
      <link rel="stylesheet" href="https://tapoueh.org/css/dim.css">
    
      <link rel="stylesheet" href="https://tapoueh.org/css/nav.css">
    

    
      
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-47059482-1', 'auto');
ga('send', 'pageview');
</script>

    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="5">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="navbar-collapse collapse header-title" id="navigation">
    <ul class="nav navbar-nav navbar-right">
      
      <li class="dropdown">
        
        <a href="/">blog</a>
        
      </li>
      
      <li class="dropdown">
        
        <a href="/conf/">talks</a>
        
      </li>
      
      <li class="dropdown">
        
        <a href="http://pgloader.io/">pgloader</a>
        
      </li>
      
      <li class="dropdown">
        
        <a href="http://masteringpostgresql.com/">Mastering PostgreSQL</a>
        
      </li>
      
    </ul>
  </div>

  
    
      <a class="header-right-icon "
         href="http://masteringpostgresql.com" target="_blank">
    
    
      <i class="fa fa-lg fa-book"></i>
    
    
    </a>
  
</header>

      <nav id="sidebar" data-behavior="5">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="/#about">
          <img class="sidebar-profile-picture" src="//www.gravatar.com/avatar/7b615d104c506aa0a49e17151fa94d9f?s=110" alt="" />
        </a>
        <h4 class="sidebar-profile-name">Dimitri Fontaine</h4>
        
          <h5 class="sidebar-profile-bio">PostgreSQL Major Contributor</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/">
    
      <i class="sidebar-button-icon fa fa-lg fa-pagelines"></i>
      
      <span class="sidebar-button-desc">Blog</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/about/">
    
      <i class="sidebar-button-icon fa fa-lg fa-beer"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/categories/yesql/">
    
      <i class="sidebar-button-icon fa fa-lg fa-database"></i>
      
      <span class="sidebar-button-desc">YeSQL</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="http://masteringpostgresql.com" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-book"></i>
      
      <span class="sidebar-button-desc">Mastering PostgreSQL</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/dimitri" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://twitter.com/tapoueh" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-twitter"></i>
      
      <span class="sidebar-button-desc">Twitter</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/categories">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      
  <div class="post-header-cover
              text-left
              post-header-cover--partial"
       style="background-image:url('/img/stocks-on-the-rise.jpg')"
       data-behavior="5">
    
      <div class="post-header main-content-wrap text-left">
  
    <h1 class="post-title" itemprop="headline">
      Find the number of the longest continuously rising days for a stock
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time itemprop="datePublished" datetime="2018-02-06T23:24:17&#43;01:00">
        
  
  
  
  
    Tuesday 06 Feb 2018
  

      </time>
    
    
  
  
    <span></span>
    
      <a class="category-link" href="/categories/postgresql">PostgreSQL</a>, 
    
      <a class="category-link" href="/categories/yesql">YeSQL</a>
    
  

  </div>

</div>
    
  </div>


      <div id="main" data-behavior="5"
        class="hasCover
               hasCoverMetaIn
               ">
        <article class="post" itemscope itemType="http://schema.org/BlogPosting">
          
          
          <div class="post-content markdown" itemprop="articleBody">
            <div class="main-content-wrap">
              <p>Today I want to react to an article that claims that <a href="https://www.datasciencecentral.com/profiles/blogs/relational-algebra-is-the-root-of-sql-problems">Relational Algebra Is
the Root of SQL
Problems</a>
in which the author hand-waves the following position:</p>

<blockquote>
<p>SQL becomes more a hindrance to data manipulation than an efficient tool.
SQL’s greatest problem isn’t in the implementation level, but at its
theory foundation. The problem can’t be solved by application
optimization. Relational algebra isn’t sophisticated enough for handling
the complicated data manipulation scenarios.</p>
</blockquote>

<p>Then they go on to several <em>arguments from authority</em> to “prove” their
point. My reading of the article is that SQL is very hard when you didn&rsquo;t
care to learn it, as most technologies are.</p>

<p>In this article, we&rsquo;re going to look at the <em>simple examples</em> provided where
apparently SQL makes it so much harder to find a solution compared to
writing some Java or C++ code. Contrary to the original article, we go as
far as to actually writing both the SQL solution and a complete Python
solution, so that we can compare.</p>

<p></p>

<p>Maybe SQL is even less forgiving than most other technologies in that it is
a <em>declarative</em> programming language. It&rsquo;s very hard in SQL to improvise a
query, you really need to understand both the data model under it and also
the business case. You need to be able to describe <strong>what</strong> you want to
achieve, without telling much to the system about <strong>how</strong> to do it. When
you&rsquo;re not used to it, this is hard.</p>

<p>The simple examples made in the article entitled <a href="https://www.datasciencecentral.com/profiles/blogs/relational-algebra-is-the-root-of-sql-problems">Relational Algebra Is the
Root of SQL
Problems</a>
are the following:</p>

<ol>
<li><p>Find the number of the longest continuously rising days for a stock.</p></li>

<li><p>Find the top 10 among one billion records.</p></li>
</ol>

<p>Here follows implementations in SQL and Python of those two simple examples,
so that you can compare them.</p>

<h1 id="table-of-contents"></h1><nav id="TableOfContents">
<ul>
<li><a href="#first-simple-example">First Simple Example</a>
<ul>
<li><a href="#having-some-data-to-play-with">Having some data to play with</a></li>
<li><a href="#sql-foundamentals-needed">SQL Foundamentals Needed</a></li>
<li><a href="#advanced-sql-with-full-details">Advanced SQL With Full Details</a></li>
<li><a href="#the-sql-solution">The SQL Solution</a></li>
<li><a href="#an-alternative-sql-implementation">An Alternative SQL Implementation</a></li>
<li><a href="#a-python-implementation">A Python Implementation</a></li>
</ul></li>
<li><a href="#second-simple-example">Second Simple Example</a>
<ul>
<li><a href="#the-sql-solution-1">The SQL Solution</a></li>
<li><a href="#a-python-implementation-1">A Python Implementation</a></li>
</ul></li>
<li><a href="#is-sql-that-bad-really">Is SQL That Bad Really?</a></li>
</ul>
</nav>

<h1 id="first-simple-example">First Simple Example</h1>

<p>Here&rsquo;s how the problem is described in the original article we are reacting
to here:</p>

<blockquote>
<p>It’s simple for Java or C++ programmers. They will create a counter whose
initial value is 0, sort records by date and traverse them all, add 1 to
the counter when the stock rises and reset it to 0 when it falls, and then
find the largest number the counter ever has.</p>

<p>The logic is natural, but it’s rather difficult to implement it in SQL.</p>

<p>Relational algebra inherits the mathematical concept of unordered sets,
which means the data sorting can only be performed at the output and the
order of traversal can’t be specified, making it difficult to implement
the logic in a natural way. Instead, programmers need to generate numbers
for the dates, create a group mark, group a rising day with the previous
day and put a falling day into another group, and then find the biggest
COUNT() value among the groups. The logic is difficult to grasp. That is
the issue of the translation of computing logic being more difficult than
the solution itself.</p>
</blockquote>

<p>Saying that the <em>logic is natural</em> without writing a single line of code is
an argument from authority in my book. Of course writing this quick recipe
without thinking about any level of details is always easy and simple, and
might even feel natural in somes cases. As <a href="https://en.wikiquote.org/wiki/Linus_Torvalds#2000-04">Linus Torvalds
said</a> once:</p>

<blockquote>
<p>Talk is cheap. Show me the code.</p>

<p><strong><em>Torvalds, Linus</em></strong> (2000-08-25), in a <a href="http://lkml.org/lkml/2000/8/25/132">message to linux-kernel mailing
list</a>.</p>
</blockquote>

<p>Saying then that <em>it&rsquo;s rather difficult to implement it in SQL</em> without even
trying is another argument from authority. And then the description of how
to write the SQL query focuses on <strong><em>how</em></strong> to retrieve the data rather than
<strong><em>what</em></strong> data we want to retrieve. That is going to make it really hard to
express in SQL.</p>

<p>Moreover, <em>the order of traversal can&rsquo;t be specified</em> sounds dubious. The
SQL standard cover the ORDER BY clause in the main query, in subqueries, as
an aggregate control, and in a window function frame definition. That&rsquo;s many
places where to specify the order of traversal, and SQL knows how to ORDER
BY date, thanks.</p>

<p>So, first thing first, we need a data model and a data set.</p>

<h2 id="having-some-data-to-play-with">Having some data to play with</h2>

<p><a href="https://www.nyse.com/">Intercontinental Exchange</a> provides a chart with
<a href="http://www.nyxdata.com/nysedata/asp/factbook/viewer_edition.asp?mode=table&amp;key=3141&amp;category=3">Daily NYSE Group Volume in NYSE Listed,
2017</a>.
We can fetch the <em>Excel</em> file which is actually a <em>CSV</em> file using <em>tab</em> as
a separator, remove the headings and load it into a PostgreSQL table.</p>


<figure class="right">
    <a href="https://masteringpostgresql.com">
        <img src="/img/MasteringPostgreSQLinAppDev-Cover-th.png" />
    </a>
    
</figure>


<p>I have used this data set previously both in my book <a href="https://masteringpostgresql.com">Mastering PostgreSQL
in Application Development</a> and in the
article <a href="https://opensource.com/article/17/12/python-and-postgresql">How to use PostgreSQL to streamline Python
code</a> published
at <a href="http://opensource.com">http://opensource.com</a>. Here&rsquo;s what the <code>factbook</code> table looks like:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#00a">table</span> factbook <span style="color:#00a">limit</span> <span style="color:#099">10</span>;</code></pre></div>
<p>The <code>TABLE</code> command is standard SQL and included in PostgreSQL of course,
and an easy way to quickly see what&rsquo;s a data model all about. In our case,
we have the <em>date</em> and <em>dollars</em> columns, and some more:</p>

<pre><code> year │    date    │   shares   │ trades  │   dollars   
══════╪════════════╪════════════╪═════════╪═════════════
 2010 │ 2010-01-04 │ 1425504460 │ 4628115 │ 38495460645
 2010 │ 2010-01-05 │ 1754011750 │ 5394016 │ 43932043406
 2010 │ 2010-01-06 │ 1655507953 │ 5494460 │ 43816749660
 2010 │ 2010-01-07 │ 1797810789 │ 5674297 │ 44104237184
 2010 │ 2010-01-08 │ 1545692647 │ 5008824 │ 40816677580
 2010 │ 2010-01-11 │ 1492666469 │ 4970320 │ 41341854839
 2010 │ 2010-01-12 │ 1685064003 │ 5600471 │ 45676531877
 2010 │ 2010-01-13 │ 1468586700 │ 4989082 │ 39877317621
 2010 │ 2010-01-14 │ 1357605480 │ 4552360 │ 36899505722
 2010 │ 2010-01-15 │ 1952486180 │ 5335459 │ 53482586973
(10 rows)
</code></pre>

<p>Given this data set, it&rsquo;s then possible to find the number of the longest
continuously rising days for a stock, by looking at the dollars column.</p>

<h2 id="sql-foundamentals-needed">SQL Foundamentals Needed</h2>

<p>The first thing we need to know in SQL here is how to determine if the stock
is rising. This involves comparing the current row&rsquo;s <em>dollars</em> with the next
row&rsquo;s <em>dollars</em>. That is easily done with a <a href="/tags/window-functions/">Window
Function</a> as in the following example:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">  <span style="color:#00a">select</span> <span style="color:#0aa">date</span>,
         to_char(
           lag(dollars, <span style="color:#099">1</span>) over(<span style="color:#00a">order</span> <span style="color:#00a">by</span> <span style="color:#0aa">date</span>),
           <span style="color:#a50">&#39;L99G999G999G999&#39;</span>
         ) <span style="color:#00a">as</span> <span style="color:#00a">&#34;dollars previous day&#34;</span>,

         to_char(dollars, <span style="color:#a50">&#39;L99G999G999G999&#39;</span>) <span style="color:#00a">as</span> dollars,

         <span style="color:#00a">case</span> <span style="color:#00a">when</span>   dollars
                   - lag(dollars, <span style="color:#099">1</span>) over(<span style="color:#00a">order</span> <span style="color:#00a">by</span> <span style="color:#0aa">date</span>)
                   &lt; <span style="color:#099">0</span>
              <span style="color:#00a">then</span> <span style="color:#a50">&#39;-&#39;</span>
              <span style="color:#00a">else</span> <span style="color:#a50">&#39;+&#39;</span>
          <span style="color:#00a">end</span> <span style="color:#00a">as</span> diff
    <span style="color:#00a">from</span> factbook
<span style="color:#00a">order</span> <span style="color:#00a">by</span> <span style="color:#0aa">date</span>
   <span style="color:#00a">limit</span> <span style="color:#099">5</span>;</code></pre></div>
<p>The <code>lag(dollars, 1) over(order by date)</code> SQL window function expression
gives us the amount of dollars for the previous day. It&rsquo;s then easy to
compare that number with the current&rsquo;s one and output a <code>+</code> if the stock is
rising, or a <code>-</code> if it&rsquo;s lowering:</p>

<pre><code>    date    │ dollars previous day │     dollars      │ diff 
════════════╪══════════════════════╪══════════════════╪══════
 2010-01-04 │ ¤                    │ $ 38,495,460,645 │ +
 2010-01-05 │ $ 38,495,460,645     │ $ 43,932,043,406 │ +
 2010-01-06 │ $ 43,932,043,406     │ $ 43,816,749,660 │ -
 2010-01-07 │ $ 43,816,749,660     │ $ 44,104,237,184 │ +
 2010-01-08 │ $ 44,104,237,184     │ $ 40,816,677,580 │ -
(5 rows)
</code></pre>

<p>Using that knowledge, we might be able to actually find our magic number,
right?</p>

<h2 id="advanced-sql-with-full-details">Advanced SQL With Full Details</h2>

<p>Once we have the <code>+</code> and <code>-</code> information computed from the data set, the
number of continuously raising days can be found by collecting all the <code>+</code>
that follow each-other in a row.</p>

<p>Another way to say that is to find the first following date for which the
computed <em>diff</em> column changes, either from <code>+</code> to <code>-</code> or the other way
around, from <code>-</code> to <code>+</code>. This kind of lookup to the next value is done with
a <em>self-join</em> in SQL, and can be implemented in the following way:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#00a">with</span> diffs <span style="color:#00a">as</span>
  (
     <span style="color:#aaa;font-style:italic">--
</span><span style="color:#aaa;font-style:italic"></span>     <span style="color:#aaa;font-style:italic">-- compute if the current stock is raising or lowering
</span><span style="color:#aaa;font-style:italic"></span>     <span style="color:#aaa;font-style:italic">--
</span><span style="color:#aaa;font-style:italic"></span>     <span style="color:#00a">select</span> <span style="color:#0aa">date</span>, dollars,
            <span style="color:#00a">case</span> <span style="color:#00a">when</span>   dollars
                      - lag(dollars, <span style="color:#099">1</span>) over(<span style="color:#00a">order</span> <span style="color:#00a">by</span> <span style="color:#0aa">date</span>)
                      &lt; <span style="color:#099">0</span>
                 <span style="color:#00a">then</span> <span style="color:#a50">&#39;-&#39;</span>
                 <span style="color:#00a">else</span> <span style="color:#a50">&#39;+&#39;</span>
             <span style="color:#00a">end</span> <span style="color:#00a">as</span> diff
          <span style="color:#00a">from</span> factbook
      <span style="color:#00a">where</span> <span style="color:#0aa">date</span> <span style="color:#00a">is</span> <span style="color:#00a">not</span> <span style="color:#00a">null</span>
   <span style="color:#00a">order</span> <span style="color:#00a">by</span> <span style="color:#0aa">date</span>
  )
<span style="color:#00a">select</span> diffs.diff,
       <span style="color:#00a">min</span>(diffs.<span style="color:#0aa">date</span>) <span style="color:#00a">as</span> <span style="color:#00a">start</span>,
       diff_change.<span style="color:#0aa">date</span> <span style="color:#00a">as</span> <span style="color:#00a">end</span>,
       <span style="color:#00a">count</span>(*) <span style="color:#00a">as</span> days

  <span style="color:#00a">from</span> diffs
       <span style="color:#00a">left</span> <span style="color:#00a">join</span> <span style="color:#00a">lateral</span>
       <span style="color:#aaa;font-style:italic">-- 
</span><span style="color:#aaa;font-style:italic"></span>       <span style="color:#aaa;font-style:italic">-- for each row of our &#34;diffs&#34; relation, compute the next
</span><span style="color:#aaa;font-style:italic"></span>       <span style="color:#aaa;font-style:italic">-- day at which the stock change direction is changing, that is
</span><span style="color:#aaa;font-style:italic"></span>       <span style="color:#aaa;font-style:italic">-- where a + becomes a - or the other way round
</span><span style="color:#aaa;font-style:italic"></span>       <span style="color:#aaa;font-style:italic">-- 
</span><span style="color:#aaa;font-style:italic"></span>       (
         <span style="color:#00a">select</span> <span style="color:#0aa">date</span>
           <span style="color:#00a">from</span> diffs d2
          <span style="color:#00a">where</span> d2.<span style="color:#0aa">date</span> &gt; diffs.<span style="color:#0aa">date</span>
            <span style="color:#00a">and</span> d2.diff &lt;&gt; diffs.diff
       <span style="color:#00a">order</span> <span style="color:#00a">by</span> <span style="color:#0aa">date</span>
          <span style="color:#00a">limit</span> <span style="color:#099">1</span>
       ) <span style="color:#00a">as</span> diff_change <span style="color:#00a">on</span> <span style="color:#00a">true</span>

<span style="color:#aaa;font-style:italic">--
</span><span style="color:#aaa;font-style:italic">-- we group by the date where the +/- change occurs
</span><span style="color:#aaa;font-style:italic">-- and count how many rows share that value
</span><span style="color:#aaa;font-style:italic">--
</span><span style="color:#aaa;font-style:italic"></span><span style="color:#00a">group</span> <span style="color:#00a">by</span> diffs.diff, diff_change.<span style="color:#0aa">date</span>
  <span style="color:#00a">having</span> <span style="color:#00a">count</span>(*) &gt; <span style="color:#099">4</span>
<span style="color:#00a">order</span> <span style="color:#00a">by</span> days <span style="color:#00a">desc</span>, <span style="color:#00a">start</span>;</code></pre></div>
<p>In this query, we first compute the differences in between the current and
the next row, as in the previous section of this article. Equiped with that
in the common table expression <em>diffs</em>, we may now find the previous date
when there&rsquo;s a change of direction in the stock value.</p>

<p>That lookup is implemented in the LEFT JOIN LATERAL subquery thanks to the
use of the ORDER BY and LIMIT clauses. Once we have found the date at which
the current trend changes, then we can compute how many days have been
having the same trend value thanks to a GROUP BY clause.</p>

<p>In order to make it easier to follow all the steps of writing the SQL query,
this query focuses on more than just the single result that&rsquo;s asked for: we
go to some lengths in order to display the following <em>debug</em> output, where
not only we have the maximum number of rising days for our stock, but also
the first and last day when it happened. Oh and we have both the rising and
lowering values too…</p>

<pre><code> diff │   start    │    end     │ days 
══════╪════════════╪════════════╪══════
 +    │ 2017-07-17 │ 2017-07-26 │    7
 -    │ 2014-08-07 │ 2014-08-15 │    6
 -    │ 2014-08-18 │ 2014-08-26 │    6
 +    │ 2015-07-21 │ 2015-07-29 │    6
 -    │ 2010-05-07 │ 2010-05-14 │    5
 -    │ 2010-07-30 │ 2010-08-06 │    5
 -    │ 2010-12-20 │ 2010-12-28 │    5
 +    │ 2011-08-02 │ 2011-08-09 │    5
 -    │ 2011-08-09 │ 2011-08-16 │    5
 -    │ 2011-11-18 │ 2011-11-28 │    5
 +    │ 2012-05-14 │ 2012-05-21 │    5
 +    │ 2016-10-25 │ 2016-11-01 │    5
 -    │ 2017-03-01 │ 2017-03-08 │    5
(13 rows)
</code></pre>

<p>The HAVING clause implements a restriction of the output to limit how many
rows we display, we could have been using a LIMIT clause instead if we
wanted to show a known number of rows in advance rather than only the
interesting values from the data set.</p>

<h2 id="the-sql-solution">The SQL Solution</h2>

<p>So, now that we have seen this <em>debug</em> oriented result set, we can write a
SQL query that answers the question we are tasked with in the first place:</p>

<blockquote>
<p>Find the number of the longest continuously rising days for a stock.</p>
</blockquote>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#00a">with</span> diffs <span style="color:#00a">as</span>
  (
     <span style="color:#aaa;font-style:italic">--
</span><span style="color:#aaa;font-style:italic"></span>     <span style="color:#aaa;font-style:italic">-- compute if the current stock is raising or lowering
</span><span style="color:#aaa;font-style:italic"></span>     <span style="color:#aaa;font-style:italic">--
</span><span style="color:#aaa;font-style:italic"></span>     <span style="color:#00a">select</span> <span style="color:#0aa">date</span>, dollars,
            <span style="color:#00a">case</span> <span style="color:#00a">when</span>   dollars
                      - lag(dollars, <span style="color:#099">1</span>) over(<span style="color:#00a">order</span> <span style="color:#00a">by</span> <span style="color:#0aa">date</span>)
                      &lt; <span style="color:#099">0</span>
                 <span style="color:#00a">then</span> <span style="color:#a50">&#39;-&#39;</span>
                 <span style="color:#00a">else</span> <span style="color:#a50">&#39;+&#39;</span>
             <span style="color:#00a">end</span> <span style="color:#00a">as</span> diff
       <span style="color:#00a">from</span> factbook
      <span style="color:#00a">where</span> <span style="color:#0aa">date</span> <span style="color:#00a">is</span> <span style="color:#00a">not</span> <span style="color:#00a">null</span>
   <span style="color:#00a">order</span> <span style="color:#00a">by</span> <span style="color:#0aa">date</span>
  )
<span style="color:#00a">select</span> <span style="color:#00a">count</span>(*) <span style="color:#00a">as</span> days

  <span style="color:#00a">from</span> diffs
       <span style="color:#00a">left</span> <span style="color:#00a">join</span> <span style="color:#00a">lateral</span>
       <span style="color:#aaa;font-style:italic">-- 
</span><span style="color:#aaa;font-style:italic"></span>       <span style="color:#aaa;font-style:italic">-- for each row of our &#34;diffs&#34; relation, compute the next
</span><span style="color:#aaa;font-style:italic"></span>       <span style="color:#aaa;font-style:italic">-- day at which the stock change direction is changing, that is
</span><span style="color:#aaa;font-style:italic"></span>       <span style="color:#aaa;font-style:italic">-- where a + becomes a - or the other way round
</span><span style="color:#aaa;font-style:italic"></span>       <span style="color:#aaa;font-style:italic">-- 
</span><span style="color:#aaa;font-style:italic"></span>       (
         <span style="color:#00a">select</span> <span style="color:#0aa">date</span>
           <span style="color:#00a">from</span> diffs d2
          <span style="color:#00a">where</span> d2.<span style="color:#0aa">date</span> &gt; diffs.<span style="color:#0aa">date</span>
            <span style="color:#00a">and</span> d2.diff &lt;&gt; diffs.diff
       <span style="color:#00a">order</span> <span style="color:#00a">by</span> <span style="color:#0aa">date</span>
          <span style="color:#00a">limit</span> <span style="color:#099">1</span>
       ) <span style="color:#00a">as</span> diff_change <span style="color:#00a">on</span> <span style="color:#00a">true</span>

 <span style="color:#00a">where</span> diffs.diff = <span style="color:#a50">&#39;+&#39;</span>

<span style="color:#aaa;font-style:italic">--
</span><span style="color:#aaa;font-style:italic">-- we group by the date where the +/- change occurs
</span><span style="color:#aaa;font-style:italic">-- and count how many rows share that value
</span><span style="color:#aaa;font-style:italic">--
</span><span style="color:#aaa;font-style:italic"></span><span style="color:#00a">group</span> <span style="color:#00a">by</span> diff_change.<span style="color:#0aa">date</span>

<span style="color:#aaa;font-style:italic">--
</span><span style="color:#aaa;font-style:italic">-- and we only keep the longest continuously rising number of days
</span><span style="color:#aaa;font-style:italic">--
</span><span style="color:#aaa;font-style:italic"></span><span style="color:#00a">order</span> <span style="color:#00a">by</span> days <span style="color:#00a">desc</span>
   <span style="color:#00a">limit</span> <span style="color:#099">1</span>;</code></pre></div>
<p>The answer is the following, straight to the point, without any extra
information:</p>

<pre><code> days 
══════
    7
(1 row)
</code></pre>

<p>Now is that query simple and its logic natural? It&rsquo;s easy enough to already
have an opinion on that, but we might also want to refrain until we have a
competing implementation (e.g. in Python) to actually think about it.</p>

<h2 id="an-alternative-sql-implementation">An Alternative SQL Implementation</h2>

<p>The same problem can be solved with using a recursive approach that looks
like the classic <a href="https://wiki.postgresql.org/wiki/Loose_indexscan">Loose Index
Scan</a> method. The idea is
to start with the last day from our table. That&rsquo;s easy enough.</p>

<p>Then we fetch the day before from there, and see if its sock has risen, in
which case we increment our computed <em>day</em> column to reflect the situation,
and repeat the operation as long as we have days:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#00a">with</span> <span style="color:#00a">recursive</span> raising <span style="color:#00a">as</span>
(
   (
       <span style="color:#aaa;font-style:italic">-- 
</span><span style="color:#aaa;font-style:italic"></span>       <span style="color:#aaa;font-style:italic">-- start with the most recent date in our dataset
</span><span style="color:#aaa;font-style:italic"></span>       <span style="color:#aaa;font-style:italic">-- and prepare our recursive computed data: series
</span><span style="color:#aaa;font-style:italic"></span>       <span style="color:#aaa;font-style:italic">-- of increasing dollars values and number of days 
</span><span style="color:#aaa;font-style:italic"></span>       <span style="color:#aaa;font-style:italic">-- in a row of seeing an increase
</span><span style="color:#aaa;font-style:italic"></span>       <span style="color:#aaa;font-style:italic">--
</span><span style="color:#aaa;font-style:italic"></span>   <span style="color:#00a">select</span> <span style="color:#0aa">date</span>, dollars, <span style="color:#0aa">array</span>[dollars] <span style="color:#00a">as</span> series, <span style="color:#099">0</span> <span style="color:#00a">as</span> days
     <span style="color:#00a">from</span> factbook
    <span style="color:#00a">where</span> <span style="color:#0aa">date</span> <span style="color:#00a">is</span> <span style="color:#00a">not</span> <span style="color:#00a">null</span>
 <span style="color:#00a">order</span> <span style="color:#00a">by</span> <span style="color:#0aa">date</span> <span style="color:#00a">desc</span>
    <span style="color:#00a">limit</span> <span style="color:#099">1</span>
   )
   
   <span style="color:#00a">union</span> <span style="color:#00a">all</span>
    
  (
         <span style="color:#aaa;font-style:italic">--
</span><span style="color:#aaa;font-style:italic"></span>         <span style="color:#aaa;font-style:italic">-- fetch the previous day of factbook data and compute
</span><span style="color:#aaa;font-style:italic"></span>         <span style="color:#aaa;font-style:italic">-- the new series/days values depending on the value of
</span><span style="color:#aaa;font-style:italic"></span>         <span style="color:#aaa;font-style:italic">-- the previous factbook day compared to the value of the
</span><span style="color:#aaa;font-style:italic"></span>         <span style="color:#aaa;font-style:italic">-- current day in raising
</span><span style="color:#aaa;font-style:italic"></span>         <span style="color:#aaa;font-style:italic">--
</span><span style="color:#aaa;font-style:italic"></span>     <span style="color:#00a">select</span> factbook.<span style="color:#0aa">date</span>,
            factbook.dollars,
            <span style="color:#00a">case</span> <span style="color:#00a">when</span> raising.dollars &gt; factbook.dollars
                 <span style="color:#00a">then</span> <span style="color:#0aa">array</span>[factbook.dollars] || raising.series
                 <span style="color:#00a">else</span> <span style="color:#0aa">array</span>[factbook.dollars]
             <span style="color:#00a">end</span> <span style="color:#00a">as</span> series,
            <span style="color:#00a">case</span> <span style="color:#00a">when</span> raising.dollars &gt; factbook.dollars
                 <span style="color:#00a">then</span> days + <span style="color:#099">1</span>
                 <span style="color:#00a">else</span> <span style="color:#099">0</span>
             <span style="color:#00a">end</span> <span style="color:#00a">as</span> days
       <span style="color:#00a">from</span> factbook <span style="color:#00a">join</span> raising <span style="color:#00a">on</span> factbook.<span style="color:#0aa">date</span> &lt; raising.<span style="color:#0aa">date</span>
   <span style="color:#00a">order</span> <span style="color:#00a">by</span> <span style="color:#0aa">date</span> <span style="color:#00a">desc</span>
      <span style="color:#00a">limit</span> <span style="color:#099">1</span>
  )
)
<span style="color:#aaa;font-style:italic">--
</span><span style="color:#aaa;font-style:italic">-- display only the interesting part of the recursive
</span><span style="color:#aaa;font-style:italic">-- query results:
</span><span style="color:#aaa;font-style:italic">--
</span><span style="color:#aaa;font-style:italic"></span>  <span style="color:#00a">select</span> days, <span style="color:#0aa">date</span>, series
    <span style="color:#00a">from</span> raising
   <span style="color:#00a">where</span> days &gt; <span style="color:#099">4</span>
<span style="color:#00a">order</span> <span style="color:#00a">by</span> days <span style="color:#00a">desc</span>;</code></pre></div>
<p>And the query shows interesting information that&rsquo;s not asked for, such as
the series of <em>dollars</em> values that have been registered to the number of
days we&rsquo;re looking for:</p>

<pre><code> days │    date    │                                              series                                               
══════╪════════════╪═══════════════════════════════════════════════════════════════════════════════════════════════════
    7 │ 2017-07-14 │ {32588362765,33760987656,35165369201,35297166209,39376330787,42470589106,42701120315,54039073558}
    6 │ 2015-07-20 │ {35853995657,39619794106,42664392961,43134509170,43590746301,45959161744,47026897118}
    6 │ 2017-07-17 │ {33760987656,35165369201,35297166209,39376330787,42470589106,42701120315,54039073558}
    5 │ 2012-05-11 │ {35089242038,35385171602,38619918965,39640166828,42001050587,50014530108}
    5 │ 2017-07-18 │ {35165369201,35297166209,39376330787,42470589106,42701120315,54039073558}
    5 │ 2011-08-01 │ {51752009908,56183343867,62257561258,80176338229,94797260297,101033041245}
    5 │ 2016-10-24 │ {37480090453,39682504757,41375471787,44843918730,45627849370,49351786965}
    5 │ 2015-07-21 │ {39619794106,42664392961,43134509170,43590746301,45959161744,47026897118}
(8 rows)
</code></pre>

<p>It&rsquo;s easy from there to change the last part of the query so that it would
only returns the number 7 that we want to find here.</p>

<h2 id="a-python-implementation">A Python Implementation</h2>

<p>A very classic implementation of the problem at hand in Python would look
like the following script:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python"><span style="color:#aaa;font-style:italic">#! /usr/bin/env python3</span>

<span style="color:#00a">import</span> <span style="color:#0aa">psycopg2</span>
<span style="color:#00a">from</span> <span style="color:#0aa">collections</span> <span style="color:#00a">import</span> namedtuple

Record = namedtuple(<span style="color:#a50"></span><span style="color:#a50">&#39;Record&#39;</span>, <span style="color:#a50"></span><span style="color:#a50">&#39;date days&#39;</span>)
PGCONNSTRING = <span style="color:#a50"></span><span style="color:#a50">&#34;dbname=appdev application_name=cont&#34;</span>

<span style="color:#00a">def</span> <span style="color:#0a0">cont</span>():
    <span style="color:#a50"></span><span style="color:#a50">&#34;Fetch data from the factbook table&#34;</span>

    conn = psycopg2.connect(PGCONNSTRING)
    curs = conn.cursor()
    sql = <span style="color:#a50"></span><span style="color:#a50">&#34;&#34;&#34;
</span><span style="color:#a50">  SELECT date, dollars
</span><span style="color:#a50">    FROM factbook
</span><span style="color:#a50">   WHERE date is not null
</span><span style="color:#a50">ORDER BY date
</span><span style="color:#a50">&#34;&#34;&#34;</span>
    curs.execute(sql)

    previous_date = None
    previous_dollars = None

    current = Record(date=None, days=<span style="color:#099">0</span>)
    best = Record(date=None, days=<span style="color:#099">0</span>)

    <span style="color:#00a">for</span> date, dollars <span style="color:#00a">in</span> curs.fetchall():
        <span style="color:#00a">if</span> previous_dollars:
            <span style="color:#00a">if</span> dollars &gt; previous_dollars:
                current = Record(current.date, current.days + <span style="color:#099">1</span>)
                <span style="color:#00a">if</span> current.days &gt; best.days:
                    best = Record(current.date, current.days)
            <span style="color:#00a">else</span>:
                current = Record(date, <span style="color:#099">0</span>)
        <span style="color:#00a">else</span>:
            current = Record(date, <span style="color:#099">0</span>)

        previous_date, previous_dollars = date, dollars

    <span style="color:#00a">return</span> best

<span style="color:#00a">if</span> __name__ == <span style="color:#a50"></span><span style="color:#a50">&#39;__main__&#39;</span>:
    rising = cont()

    <span style="color:#00a">print</span>(<span style="color:#a50"></span><span style="color:#a50">&#34;Continuously rising days: </span><span style="color:#a50">%d</span><span style="color:#a50"> days from </span><span style="color:#a50">%s</span><span style="color:#a50">&#34;</span> % (rising.days,
                                                         rising.date))</code></pre></div>
<p>Running the code gives us the following result, as expected:</p>

<pre><code>Continuously rising days: 7 days from 2017-07-14
</code></pre>

<p>The only bits that might be not the simplest possible implementation of the
problem set is that I chose to keep track of not only the number of days but
also the date when the rising series starts, and I&rsquo;ve been using a
<em>namedtuple</em> to keep track of that.</p>

<h1 id="second-simple-example">Second Simple Example</h1>

<p>The other simple example provided is to <em>find the top 10 among one billion
records</em>.</p>

<p>And the article&rsquo;s author goes on to mention that</p>

<blockquote>
<p>There’s no need to sort the one billion records to find the desired ones.
We create a 10-member empty set, and traverse data while keeping the set
contain the top 10 records of the traversed records. That way we just need
to perform one traversal with a very small memory space occupied and a
good computational performance.</p>

<p>Unfortunately as the relational algebra doesn’t define an explicit set
data type, SQL can’t express the algorithm.</p>
</blockquote>

<h2 id="the-sql-solution-1">The SQL Solution</h2>

<p>Well the way to express the algorithm in SQL is to describe the result we
are interested into, and for that here we can use the simple ORDER BY and
LIMIT clauses of the language:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#00a">explain</span> (<span style="color:#00a">analyze</span>, <span style="color:#00a">verbose</span>, buffers)

   <span style="color:#00a">select</span> <span style="color:#0aa">date</span>, dollars
     <span style="color:#00a">from</span> factbook
 <span style="color:#00a">order</span> <span style="color:#00a">by</span> dollars <span style="color:#00a">desc</span>
    <span style="color:#00a">limit</span> <span style="color:#099">10</span>;</code></pre></div>
<p>Now, we don&rsquo;t get to specify <strong>how</strong> the data is going to be retrieved by
our SQL engine. Of course, We can trust PostgreSQL to do the Right Thing™
here for us, as we can see in full details thanks to the previous EXPLAIN
(ANALYZE, VERBOSE, BUFFERS) command. It gives the following result:</p>

<pre><code> Limit  (cost=76.73..76.76 rows=10 width=12)
        (actual time=1.356..1.359 rows=10 loops=1)
   Output: date, dollars
   Buffers: shared hit=18
   -&gt;  Sort  (cost=76.73..81.62 rows=1953 width=12)
             (actual time=1.354..1.354 rows=10 loops=1)
         Output: date, dollars
         Sort Key: factbook.dollars DESC
         Sort Method: top-N heapsort  Memory: 25kB
         Buffers: shared hit=18
         -&gt;  Seq Scan on public.factbook
                   (cost=0.00..34.53 rows=1953 width=12)
                   (actual time=0.017..0.673 rows=1953 loops=1)
               Output: date, dollars
               Buffers: shared hit=15
 Planning time: 0.137 ms
 Execution time: 1.395 ms
(13 rows)
</code></pre>

<p>The mention of the <em>Top-N heapsort</em> that used exactly 25kB of memory is
exactly the suggested implementation. I don&rsquo;t suppose you could implement
that in 4 lines of your favorite programming language, but even if you
actually can, that&rsquo;s beyond the point. It is actually very simple to solve
that simple exercise in SQL, and that includes checking that the right
algorithm is in use.</p>

<p>The result of the query isn&rsquo;t very interesting, though we might want to
compare with the Python implementation of the Top-N algorithm:</p>

<pre><code>    date    │   dollars    
════════════╪══════════════
 2014-12-19 │ 124663932012
 2015-09-18 │ 118869806099
 2014-09-19 │ 118622863491
 2013-12-20 │ 117924997250
 2015-03-20 │ 115466468635
 2016-06-24 │ 112434567771
 2015-06-26 │ 110931465892
 2010-06-25 │ 110901889417
 2015-12-18 │ 110329938339
 2014-03-21 │ 107923489435
(10 rows)
</code></pre>

<h2 id="a-python-implementation-1">A Python Implementation</h2>

<p>In Python, implementing a Top-N heapsort can be done using the
<a href="https://docs.python.org/3/library/heapq.html">heapq</a> standard library, as
in the following code:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python"><span style="color:#aaa;font-style:italic">#! /usr/bin/env python3</span>

<span style="color:#00a">import</span> <span style="color:#0aa">psycopg2</span>
<span style="color:#00a">import</span> <span style="color:#0aa">heapq</span>
<span style="color:#00a">import</span> <span style="color:#0aa">sys</span>

PGCONNSTRING = <span style="color:#a50"></span><span style="color:#a50">&#34;dbname=appdev application_name=cont&#34;</span>


<span style="color:#00a">def</span> <span style="color:#0a0">top</span>(n):
    <span style="color:#a50"></span><span style="color:#a50">&#34;Fetch data from the factbook table&#34;</span>

    conn = psycopg2.connect(PGCONNSTRING)
    curs = conn.cursor()
    sql = <span style="color:#a50"></span><span style="color:#a50">&#34;&#34;&#34;
</span><span style="color:#a50">  SELECT date, dollars
</span><span style="color:#a50">    FROM factbook
</span><span style="color:#a50">   WHERE date is not null
</span><span style="color:#a50">&#34;&#34;&#34;</span>
    curs.execute(sql)

    topn = [(<span style="color:#099">0</span>, None) <span style="color:#00a">for</span> i <span style="color:#00a">in</span> <span style="color:#0aa">range</span>(n)]
    heapq.heapify(topn)

    <span style="color:#00a">for</span> date, dollars <span style="color:#00a">in</span> curs.fetchall():
        heapq.heappushpop(topn, (dollars, date))

    <span style="color:#00a">return</span> topn


<span style="color:#00a">if</span> __name__ == <span style="color:#a50"></span><span style="color:#a50">&#39;__main__&#39;</span>:
    n = <span style="color:#0aa">int</span>(sys.argv[<span style="color:#099">1</span>])
    topn = top(n)

    <span style="color:#00a">for</span> dollars, date <span style="color:#00a">in</span> heapq.nlargest(n, topn):
        <span style="color:#00a">print</span>(<span style="color:#a50"></span><span style="color:#a50">&#34;</span><span style="color:#a50">%s</span><span style="color:#a50">: </span><span style="color:#a50">%s</span><span style="color:#a50">&#34;</span> % (date, dollars))</code></pre></div>
<p>The implementation is pretty straightforward, with the trick of using the
Python function <code>heappushpop</code> that requires an that we initialize a dummy
top-n result structure before looping over the result set.</p>

<pre><code>2014-12-19: 124663932012
2015-09-18: 118869806099
2014-09-19: 118622863491
2013-12-20: 117924997250
2015-03-20: 115466468635
2016-06-24: 112434567771
2015-06-26: 110931465892
2010-06-25: 110901889417
2015-12-18: 110329938339
2014-03-21: 107923489435
</code></pre>

<p>The result is the same as before, of course.</p>

<h1 id="is-sql-that-bad-really">Is SQL That Bad Really?</h1>

<p>To conclude this article, I think that
<a href="https://twitter.com/ngollperrier">Nicolas</a> makes a very good point in his
tweet here:</p>

<p><center>
<blockquote class="twitter-tweet" data-conversation="none" data-lang="en"><p lang="en" dir="ltr">1/ I&#39;m not complaining about SQL, I&#39;m citing a point of view. For most data use cases it probably still is the best tool for the job. However, I find the dogmatic approach to try to solve every problem with it unsettling.</p>&mdash; Nicolas Goll-Perrier (@ngollperrier) <a href="https://twitter.com/ngollperrier/status/959404749283094528?ref_src=twsrc%5Etfw">February 2, 2018</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</center></p>

<p>So rather than being dogmatic about it, my suggestion is to be pragmatic:</p>

<ol>
<li><p>Know your SQL and what can be done with this powerful programming
 language, and when being declarative is a strength.</p></li>

<li><p>Remember that SQL and relational algebra are not exactly the same
 thing, as explained e.g. in <a href="http://www.cs.cornell.edu/projects/btr/bioinformaticsschool/slides/gehrke.pdf">Relational Algebra and
 SQL</a>
 from professor <a href="http://www.cs.cornell.edu/johannes/">Johannes Gehrke</a>
 from Cornell University.</p></li>

<li><p>Pick the right tool for the right job, thinking about several
 dimensions in which you&rsquo;re making trade-offs, most importantly the
 modularity violations you might be making and how to properly document
 them and maintain the resulting code-base in the long term.</p></li>
</ol>

<p>The trade-offs we make when choosing to solve problems in SQL or in
application code can be quite complex, and need proper thinking. My advice
is to first go with the more obvious solution in terms of architecture and
responsibility of the <em>modules</em> or <em>systems</em> you&rsquo;re using: make it obvious,
and only then, when you hit limitations that aren&rsquo;t compatible with your
constraints, then try and be clever about it, and maybe optimize by
violating your system&rsquo;s modularity.</p>

<p>It means that sometimes you will pick the SQL implementation even if it&rsquo;s
not so obvious and requires knowing about <em>lateral joins</em> and <em>window
functions</em>, and sometimes you&rsquo;ll be implementing it in the application
middleware or even in the front-end UI code because that&rsquo;s where it belongs,
and you&rsquo;ll bypass the database entirely, or use it a an dumb object store.</p>

<p>My opinion is that either choice is ok as long as you took a concious
decision. What I still often see in the field though, is developers who have
no idea about what can be done in SQL these days and are stuck in a kind of
<a href="https://en.wikipedia.org/wiki/Greenspun%27s_tenth_rule">Greenspun&rsquo;s tenth
rule</a> only applied
to SQL rather than Common-Lisp:</p>

<blockquote>
<p>Any sufficiently complicated C or Fortran program contains an ad-hoc,
informally-specified, bug-ridden, slow implementation of half of Common
Lisp.</p>
</blockquote>

<p>And PostgreSQL implements a very advanced version of SQL, so that&rsquo;s even
more the case when focusing on PostgreSQL, as I do.</p>


<figure class="right">
    <a href="https://masteringpostgresql.com">
        <img src="/img/MasteringPostgreSQLinAppDev-Cover-th.png" />
    </a>
    
</figure>


<p>The idea behing both this article and my book <a href="https://masteringpostgresql.com">Mastering PostgreSQL in
Application Development</a> is that as a
developer using some SQL in your application code, you should master it and
know what&rsquo;s possible to implement with the PostgreSQL system, so that you
can make the right choices in terms of your application&rsquo;s architecture.</p>
              
            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small"></span><br/>
                    
  <a class="tag tag--primary tag--small" href="/tags/postgresql/">PostgreSQL</a>

  <a class="tag tag--primary tag--small" href="/tags/yesql/">YeSQL</a>

  <a class="tag tag--primary tag--small" href="/tags/rising/">Rising</a>

  <a class="tag tag--primary tag--small" href="/tags/window-functions/">Window Functions</a>

  <a class="tag tag--primary tag--small" href="/tags/stock/">Stock</a>

  <a class="tag tag--primary tag--small" href="/tags/recursive/">Recursive</a>

                  </div>
                
              
            
            <div class="post-actions-wrap">
  <div class="post-footer-tags">
    
    <script async id="_ck_252762" src="https://forms.convertkit.com/252762?v=6"></script>
    
  </div>
  <nav>
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="/blog/2018/02/sustainable-open-source-development/" data-tooltip="Sustainable Open Source Development">
          
            <i class="fa fa-angle-left"></i>
            <span class="hide-xs hide-sm text-small icon-ml"></span>
          </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="/blog/2018/01/exporting-a-hierarchy-in-json-with-recursive-queries/" data-tooltip="Exporting a Hierarchy in JSON: with recursive queries">
          
            <span class="hide-xs hide-sm text-small icon-mr"></span>
            <i class="fa fa-angle-right"></i>
          </a>
        </li>
      
    </ul>
  </nav>
  <ul class="post-actions post-action-share">
    
      <li class="post-action hide-lg hide-md hide-sm">
        <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
          <i class="fa fa-share-alt"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https%3a%2f%2ftapoueh.org%2fblog%2f2018%2f02%2ffind-the-number-of-the-longest-continuously-rising-days-for-a-stock%2f">
          <i class="fa fa-google-plus"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ftapoueh.org%2fblog%2f2018%2f02%2ffind-the-number-of-the-longest-continuously-rising-days-for-a-stock%2f">
          <i class="fa fa-facebook-official"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Find%20the%20number%20of%20the%20longest%20continuously%20rising%20days%20for%20a%20stock with @tapoueh: https%3a%2f%2ftapoueh.org%2fblog%2f2018%2f02%2ffind-the-number-of-the-longest-continuously-rising-days-for-a-stock%2f">
          <i class="fa fa-twitter"></i>
        </a>
      </li>
    
    
      <li class="post-action">
        <a class="post-action-btn btn btn--default" href="#disqus_thread">
          <i class="fa fa-comment-o"></i>
        </a>
      </li>
    
    <li class="post-action">
      
        <a class="post-action-btn btn btn--default" href="#table-of-contents">
      
        <i class="fa fa-list"></i>
      </a>
    </li>
  </ul>
</div>


            
              
                <div id="disqus_thread">
  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2018 Dimitri Fontaine. 
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
        <div class="post-actions-wrap">
  <div class="post-footer-tags">
    
    <script async id="_ck_252762" src="https://forms.convertkit.com/252762?v=6"></script>
    
  </div>
  <nav>
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="/blog/2018/02/sustainable-open-source-development/" data-tooltip="Sustainable Open Source Development">
          
            <i class="fa fa-angle-left"></i>
            <span class="hide-xs hide-sm text-small icon-ml"></span>
          </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="/blog/2018/01/exporting-a-hierarchy-in-json-with-recursive-queries/" data-tooltip="Exporting a Hierarchy in JSON: with recursive queries">
          
            <span class="hide-xs hide-sm text-small icon-mr"></span>
            <i class="fa fa-angle-right"></i>
          </a>
        </li>
      
    </ul>
  </nav>
  <ul class="post-actions post-action-share">
    
      <li class="post-action hide-lg hide-md hide-sm">
        <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
          <i class="fa fa-share-alt"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https%3a%2f%2ftapoueh.org%2fblog%2f2018%2f02%2ffind-the-number-of-the-longest-continuously-rising-days-for-a-stock%2f">
          <i class="fa fa-google-plus"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ftapoueh.org%2fblog%2f2018%2f02%2ffind-the-number-of-the-longest-continuously-rising-days-for-a-stock%2f">
          <i class="fa fa-facebook-official"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Find%20the%20number%20of%20the%20longest%20continuously%20rising%20days%20for%20a%20stock with @tapoueh: https%3a%2f%2ftapoueh.org%2fblog%2f2018%2f02%2ffind-the-number-of-the-longest-continuously-rising-days-for-a-stock%2f">
          <i class="fa fa-twitter"></i>
        </a>
      </li>
    
    
      <li class="post-action">
        <a class="post-action-btn btn btn--default" href="#disqus_thread">
          <i class="fa fa-comment-o"></i>
        </a>
      </li>
    
    <li class="post-action">
      
        <a class="post-action-btn btn btn--default" href="#table-of-contents">
      
        <i class="fa fa-list"></i>
      </a>
    </li>
  </ul>
</div>


      </div>
      <div id="share-options-bar" class="share-options-bar" data-behavior="5">
  <ul class="share-options">
    <li class="share-option">
      <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=https%3a%2f%2ftapoueh.org%2fblog%2f2018%2f02%2ffind-the-number-of-the-longest-continuously-rising-days-for-a-stock%2f">
        <i class="fa fa-google-plus"></i><span></span>
      </a>
    </li>
    <li class="share-option">
      <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ftapoueh.org%2fblog%2f2018%2f02%2ffind-the-number-of-the-longest-continuously-rising-days-for-a-stock%2f">
        <i class="fa fa-facebook-official"></i><span></span>
      </a>
    </li>
    <li class="share-option">
      <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=Find%20the%20number%20of%20the%20longest%20continuously%20rising%20days%20for%20a%20stock with @tapoueh: https%3a%2f%2ftapoueh.org%2fblog%2f2018%2f02%2ffind-the-number-of-the-longest-continuously-rising-days-for-a-stock%2f">
        <i class="fa fa-twitter"></i><span></span>
      </a>
    </li>
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>

    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="//www.gravatar.com/avatar/7b615d104c506aa0a49e17151fa94d9f?s=110" alt="" />
    
    <h4 id="about-card-name">Dimitri Fontaine</h4>
    
      <div id="about-card-bio">PostgreSQL Major Contributor</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Open Source Software Engineer
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        France
      </div>
    
  </div>
</div>

    <div id="algolia-search-modal" class="modal-container">
  <div class="modal">
    <div class="modal-header">
      <span class="close-button"><i class="fa fa-close"></i></span>
      <a href="https://algolia.com" target="_blank" rel="noopener" class="searchby-algolia text-color-light link-unstyled">
        <span class="searchby-algolia-text text-color-light text-small">by</span>
        <img class="searchby-algolia-logo" src="https://www.algolia.com/static_assets/images/press/downloads/algolia-light.svg">
      </a>
      <i class="search-icon fa fa-search"></i>
      <form id="algolia-search-form">
        <input type="text" id="algolia-search-input" name="search"
          class="form-control input--large search-input" placeholder="" />
      </form>
    </div>
    <div class="modal-body">
      <div class="no-result text-color-light text-center"></div>
      <div class="results">
        
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://tapoueh.org/blog/2018/02/sustainable-open-source-development/">
                <h3 class="media-heading">Sustainable Open Source Development</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Feb 2, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>Current trend in software deployments is to rely on open source software for
entire production stacks. You can find open source software in the core
technical stacks of every startup out there, I&rsquo;m told. If you&rsquo;re using Cloud
based offerings, most of Cloud providers are running <a href="https://www.gnu.org/philosophy/floss-and-foss.en.html">Free/Libre Open Source
Software</a> as their
foundation.</p>

<p>This article is a deep dive into the economic models behind successful open
source projects and communities, and how as a professional, enterprise grade
user, you depend on the long-term sustainability of all the open source
projects you&rsquo;re using. And because you depend on the projects you&rsquo;re using
to be successful, how to contribute and guarantee their success.</p>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://tapoueh.org/blog/2018/02/find-the-number-of-the-longest-continuously-rising-days-for-a-stock/">
                <h3 class="media-heading">Find the number of the longest continuously rising days for a stock</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Feb 2, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>Today I want to react to an article that claims that <a href="https://www.datasciencecentral.com/profiles/blogs/relational-algebra-is-the-root-of-sql-problems">Relational Algebra Is
the Root of SQL
Problems</a>
in which the author hand-waves the following position:</p>

<blockquote>
<p>SQL becomes more a hindrance to data manipulation than an efficient tool.
SQL’s greatest problem isn’t in the implementation level, but at its
theory foundation. The problem can’t be solved by application
optimization. Relational algebra isn’t sophisticated enough for handling
the complicated data manipulation scenarios.</p>
</blockquote>

<p>Then they go on to several <em>arguments from authority</em> to “prove” their
point. My reading of the article is that SQL is very hard when you didn&rsquo;t
care to learn it, as most technologies are.</p>

<p>In this article, we&rsquo;re going to look at the <em>simple examples</em> provided where
apparently SQL makes it so much harder to find a solution compared to
writing some Java or C++ code. Contrary to the original article, we go as
far as to actually writing both the SQL solution and a complete Python
solution, so that we can compare.</p>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://tapoueh.org/blog/2018/01/exporting-a-hierarchy-in-json-with-recursive-queries/">
                <h3 class="media-heading">Exporting a Hierarchy in JSON: with recursive queries</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jan 1, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>In another article here, entitled <a href="/blog/2017/09/on-json-and-sql/">on JSON and
SQL</a>, we saw in great details how to import
a data set only available as a giant JSON file. Then we normalized the data
set, so as to be able to write SQL and process our data. This approach is
sometimes very useful and was a good way to learn some of the JSON functions
provided by PostgreSQL.</p>

<p>In this article, we&rsquo;re going to use SQL to export the data from our
relational model into a JSON document. The trick that makes it complex in
this example is that we have a recursive data model, with a notion of a
<em>parent</em> row that exists in the same table as the current one. That&rsquo;s a nice
excuse to learn more about the SQL construct <a href="https://www.postgresql.org/docs/current/static/queries-with.html">WITH
RECURSIVE</a>.</p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://tapoueh.org/blog/2018/01/a-year-in-review-most-read-articles-in-2017/">
                <h3 class="media-heading">A Year in Review: Most Read Articles in 2017</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jan 1, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>It seems to be usual nowadays to review the previous year, and readers
apparently like Top-N Lists — <em>that&rsquo;s you now, so let&rsquo;s hope that my
understanding works with you too</em>.</p>

<p>Of course 2018 will see its own amount of new and original content added to
this blog, with a continuous focus towards how to make the best out of the
SQL powerful programming language, and its advanced concurrency semantics.</p>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://tapoueh.org/blog/2018/01/working-at-citus-data/">
                <h3 class="media-heading">Working at Citus Data</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jan 1, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>You might have read it in the news already in Citus&rsquo; blog post by <a href="https://www.citusdata.com/about/team/">Sumedh
Pathak</a>: <a href="https://www.citusdata.com/blog/2018/01/12/dimitri-fontaine-postgresql-contributor-joins-citus-data/">PostgreSQL Expert Dimitri
Fontaine joins Citus
Data</a>.
I am very happy to join a talented team here at Citus, and excited to work
on an Open Source solution for distributed SQL on-top of PostgreSQL! In this
article I&rsquo;m going to cover my first technical contributions to Citus
database, as it happens that a few patches of mine made it to the main
source tree already.</p>

<p><strong>TL;DR</strong> It&rsquo;s good to be working on PostgreSQL related source code again,
and to have the opportunity to solve PostgreSQL related problems at scale!</p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://tapoueh.org/blog/2018/01/migrating-to-postgresql-the-white-paper/">
                <h3 class="media-heading">Migrating to PostgreSQL, the White Paper</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jan 1, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>After having been involved in many migration projects over the last 10
years, I decided to publish the following <a href="https://pgloader.io/white-paper">White
Paper</a> in order to share my learnings.</p>

<p>The paper is titled <a href="https://pgloader.io/white-paper">Migrating to PostgreSQL, Tools and
Methodology</a> and details the <a href="https://pgloader.io/blog/continuous-migration/">Continuous
Migration</a> approach. It
describes how to migrate from another relational database server technology
to PostgreSQL. The reasons to do so are many, and first among them is often
the licensing model.</p>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://tapoueh.org/blog/2017/12/submit-a-talk-to-pgday-paris-today/">
                <h3 class="media-heading">Submit a Talk to pgDay Paris Today!</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Dec 12, 2017
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p><a href="https://2018.pgday.paris">pgDay Paris</a> 4th edition happens March 15, 2018!
And the <a href="https://2018.pgday.paris/callforpapers/">Call for Papers</a> is still
open, as it closes with the year: <em>the submission deadline is December 31st,
2017</em>.</p>

<p>As I&rsquo;ve been organizing the first edition of <em>pgDay Paris</em> back in 2015,
this very conference is special to me! It&rsquo;s been an amazing experience
launching a new <a href="https://www.postgresql.org">PostgreSQL</a> conference…</p>

<p>Hats off to <a href="https://www.hagander.net">Magnus</a> without whom the first
edition would never have happened, and to
<a href="https://twitter.com/pg_xocolatl">Vik</a> of course, who took over the
organisation of the conference!</p>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://tapoueh.org/blog/2017/12/setting-up-psql-the-postgresql-cli/">
                <h3 class="media-heading">Setting up psql, the PostgreSQL CLI</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Dec 12, 2017
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>PostgreSQL ships with an interactive console with the command line tool
named <a href="https://www.postgresql.org/docs/current/static/app-psql.html">psql</a>.
It can be used both for scripting and interactive usage and is moreover
quite a powerful tool. Interactive features includes <em>autocompletion</em>,
<em>readline</em> support (history searches, modern keyboard movements, etc), input
and output redirection, formatted output, and more.</p>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://tapoueh.org/blog/2017/12/mastering-postgresql-a-readers-interview/">
                <h3 class="media-heading">Mastering PostgreSQL: a reader&#39;s interview</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Dec 12, 2017
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p><strong><em>Florent Fourcot</em></strong> has read <a href="http://masteringpostgresql.com">Mastering PostgreSQL in Application
Development</a> and has seen tremendous
inprovements in his production setup from reading the first chapters and
applying the book advices to his use case.</p>

<p>Here&rsquo;s an interview run with Florent where he explains the context in which
such improvements has been made!</p>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://tapoueh.org/blog/2017/12/mastering-postgresql-more-about-the-docker-image/">
                <h3 class="media-heading">Mastering PostgreSQL: more about the docker image</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Dec 12, 2017
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>The Enterprise Edition of <a href="https://masteringpostgresql.com">Mastering PostgreSQL in Application
Development</a> ships with a docker image that
hosts both a PostgreSQL server instance with a pre-loaded database, the one
that&rsquo;s used throughout the book examples, and also with a Jupyter Network
notebook that hosts SQL queries thanks to the
<a href="https://github.com/pivotal/sql_magic">sql_magic</a> plugin.</p>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
      </div>
    </div>
    <div class="modal-footer">
      <p class="results-count text-medium"
         data-message-zero=""
         data-message-one=""
         data-message-other="">
         258 posts found
      </p>
    </div>
  </div>
</div>
    
  
    
    <div id="cover" style="background-image:url('https://tapoueh.org/images/mayan-calendar.jpg');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.7/js/jquery.fancybox.min.js" integrity="sha256-GEAnjcTqVP+vBp3SSc8bEDQqvWAZMiHyUSIorrWwH50=" crossorigin="anonymous"></script>


<script src="/js/script-qi9wbxp2ya2j6p7wx1i6tgavftewndznf4v0hy2gvivk1rxgc3lm7njqb6bz.min.js"></script>



<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight > code, pre > code').each(function(i, block) {
    if (!$(this).hasClass('codeblock')) {
      $(this).addClass('codeblock');
    }
    hljs.highlightBlock(block);
  });
});
</script>


  
    
      <script>
        var disqus_config = function () {
          this.page.url = 'https:\/\/tapoueh.org\/blog\/2018\/02\/find-the-number-of-the-longest-continuously-rising-days-for-a-stock\/';
          
            this.page.identifier = '\/blog\/2018\/02\/find-the-number-of-the-longest-continuously-rising-days-for-a-stock\/'
          
        };
        (function() {
          
          
          if (window.location.hostname == "localhost") {
            return;
          }
          var d = document, s = d.createElement('script');
          var disqus_shortname = 'tapoueh';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    
  



    
  </body>
</html>

