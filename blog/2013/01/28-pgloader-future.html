<!DOCTYPE HTML>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta charset=utf-8 /> 
    <meta name=viewport content="width=device-width" /> 
    <meta name="generator" content="Emacs Muse Blog" /> 
    <meta description="blog de Dimitri Fontaine, Expert PostgreSQL - 2ndQuadrant France" />
    <meta property="og:title" content="tapoueh.org"/>
    <meta property="og:type" content="non_profit"/>
    <meta property="og:url" content="http://tapoueh.org/blog/2013/01/28-pgloader-future"/>
    <meta property="og:image" content="http://tapoueh.org/static/2ndQuadrant-cross.png"/>
    <meta property="og:site_name" content="Tapoueh"/>
    <meta property="fb:admins" content="545062436"/>

    <title>Expertise PostgreSQL</title>
    <link rel='stylesheet' type='text/css' media='all' href='/static/styles.css' />

    <link href="/static/bootstrap/css/bootstrap.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="/static/FontAwesome/css/font-awesome.min.css"/>
    <link rel="stylesheet" href="/static/highlight.js/styles/sunburst.css">
    <script src="/static/highlight.js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <script src="/static/jquery-1.9.1.min.js"></script>
    <link rel="stylesheet" type="text/css" href="/static/jqcloud.css" />
    <script type="text/javascript" src="/static/jqcloud-1.0.4.min.js"></script>

    <script type="text/javascript" src="http://apis.google.com/js/plusone.js">{lang: 'fr'}</script>
    
  </head>
  <body>

   <div id="wrap">

    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="nav-collapse collapse">
	<p class="pull-right">
	  <a href="http://2ndquadrant.com">
	    <img alt="logo" src="/static/2ndQuadrant-cross.png"
		 style="margin-right: 8px; margin-top: 4px; height: 32px;"/>
	  </a>
	</p>
	<div class="navbar-inner">
	 <a class="brand" style="margin-left: 0.2em; margin-top: -4px;"
	    href="http://expert-postgresql.fr/">
	  <img src="/static/expert-postgresql.png"></a>
	 <ul class="nav">
	  <li><a href="/blog"><i class="icon-book"></i> blog</a></li>
	  <li><a href="/projects"><i class="icon-suitcase"></i> projects</a></li>
	  <li><a href="/conferences"><i class="icon-plane"></i> confs</a></li>
	  <li><a href="/about"><i class="icon-beer"></i> about</a></li>
	  <li><a href="/rss/tapoueh.xml"><i class="icon-rss"></i> rss</a></li>
	 </ul>
	</div>
      </div>
    </div>

    <div class="container">
      <div class="row">
	<div class="span4">
	  <div><ul class='breadcrumb'><li><span class='divider'><i class='icon-sitemap'></i></span></li><li><a href='/'>/dev/dim</a><span class='divider'>/</span></li><li><a href='/blog'>blog</a><span class='divider'>/</span></li><li><a href='/blog/2013'>2013</a><span class='divider'>/</span></li><li><a href='/blog/2013/01'>01</a></li></ul></div>
	  <div class='date'>Monday, January 28 2013 <i class='icon-calendar'></i></div>
	  <div style='text-align: right;'><span><a href='/tags/postgresql'>PostgreSQL</a>, <a href='/tags/common-lisp'>Common-Lisp</a>, <a href='/tags/python'>Python</a>, <a href='/tags/pgloader'>pgloader</a>, <a href='/tags/lparallel'>lparallel</a></span> <i class='icon-tags'></i></div>
	  

	  <div style="margin-top: 1em;">
	    <div class='span2 pull-left'><a class='thumbnail' href='/tags/pgloader'><img class='img-polaroid' style='width: 160px; height: 120px;' src='/thumbnails/toy-loader.320.jpg' /></a></div>
	    <div id='social' class='span1 pull-right social'><ul><li><g:plusone size='tall' href='http://tapoueh.org/blog/2013/01/28-pgloader-future'></g:plusone></li><li><a href='http://twitter.com/share' class='twitter-share-button' data-via='tapoueh' data-count='vertical'>Tweet</a><script type='text/javascript' src='http://platform.twitter.com/widgets.js'></script></li></ul></div>
	  </div>

	  <div id="prevnext">
	    <h3 class='prevnext'>Recent Articles</h3>
	    <div><a class='previous' href='/blog/2013/01/17-pgloader-auto-setup'>« Automated Setup for pgloader</a></div>
	    <div><a class='next pull-right' href='/blog/2013/01/29-FOSDEM-2013'>FOSDEM 2013 »</a></div>
	  </div>
	  
	  <div>
	    <div id="left-tag-cloud" class="jqcloud"
		 style="width: 300px; height: 650px; position: absolute; top: 475px;">
	    </div>
            <script>
            var word_list;
            
            $.ajax({
                type: 'GET',
                url: '/cloud.json',
                dataType: 'json',
                success: function(response) { word_list = response; },
                data: {},
                async: false
            });
             
            $(document).ready(function() {
               $("#left-tag-cloud").jQCloud(word_list,
	                {shape: "rectangular",
	                 removeOverflowing: false});
            });
            </script>
	  </div>

	</div>

	<div id="title" class="span8">
	  <h1>pgloader: what's next?</h1>
	</div>
	
	<div id="content" class="span8">
<p><a href='../../../pgsql/pgloader.html'>pgloader</a> is a tool to help loading data into 
<a href='http://www.postgresql.org/'>PostgreSQL</a>, adding some error
management to the 
<a href='http://www.postgresql.org/docs/9.2/interactive/sql-copy.html'>COPY</a> command. 
<code>COPY</code> is the fast way of loading data into
PostgreSQL and is transaction safe. That means that if a single error
appears within your bulk of data, you will have loaded none of it. 
<code>pgloader</code>
will submit the data again in smaller chunks until it's able to isolate the
bad from the good, and then the good is loaded in.
</p><center><img src='../../../images/PDL_Adapter-250.png' /></center><center><em>Not quite this kind of data loader</em></center><p>In a recent migration project where we freed data from MySQL into
PostgreSQL, we used 
<code>pgloader</code> again. But the loading time was not fast enough
for the service downtime window that we had here. Indeed 
<a href='http://www.python.org/'>Python</a> is not known
for being the fastest solution around. It's easy to use and to ship to
production, but sometimes you not only want to be able to be efficient when
writing code, you also need the code to actually run fast too.
</p><h2>Faster data loading</h2><p>So I began writing a little dedicated tool for that migration in 
<a href='http://cliki.net/'>Common Lisp</a>
which is growing on me as my personal answer to the burning question: 
<em>python
2 or python 3</em>? I find 
<em>Common Lisp</em> to offer an even more dynamic programming
environment, an easier language to use, and the result often has
performances characteristics way beyond what I can get with python. Between
<a href='http://tapoueh.org/blog/2012/07/10-solving-sudoku.html'>5 times faster</a> and 
<a href='http://tapoueh.org/blog/2012/08/20-performance-the-easiest-way.html'>121 times faster</a> in some quite stupid benchmark.
</p><p>Here, with real data, my one shot attempt has been running more than 
<em>twice
as fast</em> as the python version, after about a day of programming.
</p><center><img src='../../../images/lisp-python.png' /></center><center><em>See what's happening now?</em></center><p>The other thing here is that I've tempted to get 
<code>pgloader</code> work in parallel,
but at the time I didn't know about the 
<a href='http://docs.python.org/3/c-api/init.html#threads'>Global Interpreter Lock</a> that they
didn't find how to remove in Python 3 still, by the way. So my threading
attempts at making 
<code>pgloader</code> work in parallel are pretty useless.
</p><p>Whereas in 
<em>Common Lisp</em> I can just use the 
<a href='http://lparallel.org/'>lparallel</a> lib, which exposes
threading facilities and some 
<em>queueing</em> facilities as a mean to communicate
data in between workers, and have my code easily work in parallel for real.
</p><h2>Compatibility</h2><p>The only drawback that I can see here is that if you've been writing your
own 
<em>reformating modules</em> in python for 
<code>pgloader</code> (yes you can
<a href='http://tapoueh.org/pgsql/pgloader.html#sec21'>implement your own reformating module for pgloader</a>), then you would have to
port it to 
<em>Common Lisp</em>. Shout me an email if that's your case.
</p><h2>Next version</h2><p>So, I think we're going to have a 
<em>pgloader 3</em> someday, that will be way
faster than the current one, and bundle some more features: real parallel
behavior, ability to fetch non local data (connecting to MySQL directly, or
HTTP, S3, etc); and I'm thinking about offering a 
<code>COPY</code> like syntax to drive
the loading too, while at it. Also, the ability to discover the set of data
to load all by itself when you want to load a whole database: think of it as
a special 
<em>Migration</em> mode of operations.
</p><p>Some feature requests can't be solved easily when keeping the old 
<code>.INI</code>
syntax cruft, so it's high time to implement some kind of a real command
language. I have several ideas about those, in between the 
<code>COPY</code> syntax and
the 
<code>SQL*Loader</code> configuration format, which is both clunky and quite
powerful, too.
</p><p>After a beginning in 
<code>TCL</code> and a complete rewrite in python in 
<code>2005</code>, it looks
like 
<code>2013</code> is going to be the year of 
<em>pgloader 3</em>, in 
<em>Common Lisp</em>!
</p>  </div>
  </div>
  </div>
  <div id="push"></div>
  </div>

<footer>
  <p>
    <small>Unless otherwise specified, the contents of
    <a href=/index.html>this website</a> are Copyright
    &#169;&#160; 2008-2013 <a href=/about>Dimitri Fontaine</a>, and are
    licensed for use under
    <a href=http://creativecommons.org/licenses/by-sa/3.0/
    rel=license><abbr title="Creative
    Commons">CC</abbr>&#160;<abbr title=Attribution>BY</abbr>-<abbr title=Share-Alike>SA</abbr>&#160;3.0</a>.</small>
  </p> 
</footer> 

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-47059482-1', 'tapoueh.org');
  ga('send', 'pageview');

</script>

</body>
</html>
